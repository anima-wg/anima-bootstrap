<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,nofollow" />
    <meta name="creator" content="rfcmarkup version 1.96" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />

    <link rel="icon" href="" type="image/png" />
    <link rel="shortcut icon" href="" type="image/png" />
    <title>file:dtbootstrap-anima-keyinfra.txt - Bootstrapping Remote Secure Key Infrastructures (BRSKI)</title>
    
    
    <style type="text/css">
	body {
	    margin: 0px 8px;
            font-size: 1em;
	}
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 10.5pt;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>          <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>            <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>    <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>     <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td><td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td><td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard:</td>   <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>         <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>         <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo "
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>

<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
ANIMA WG                                                     M. Pritikin
Internet-Draft                                                     Cisco
Intended status: Informational                             M. Richardson
Expires: August 7, 2017                                              SSW
                                                            M. Behringer
                                                            S. Bjarnason
                                                                   Cisco
                                                               K. Watsen
                                                        Juniper Networks
                                                        February 3, 2017


        <span class="h1">Bootstrapping Remote Secure Key Infrastructures (BRSKI)</span>
            <span class="h1">draft-ietf-anima-bootstrapping-keyinfra-05-pre1</span>

Abstract

   This document specifies automated bootstrapping of a remote secure
   key infrastructure (BRSKI) using vendor installed X.509 certificate,
   in combination with a vendor's authorizing service, both online the
   Internet, and offline.  Bootstrapping a new device can occur using a
   routable address and a cloud service, or using only link-local
   connectivity, or on limited/disconnected networks.  Support for lower
   security models, including devices with minimal identity, is
   described for legacy reasons but not encouraged.  Bootstrapping is
   complete when the cryptographic identity of the new key
   infrastructure is successfully deployed to the device but the
   established secure connection can be used to deploy a locally issued
   certificate to the device as well.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="./rfcmarkup.sh?bcp=78">BCP 78</a> and <a href="./rfcmarkup.sh?bcp=79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on August 7, 2017.





<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 1]</span>
</pre><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="./rfcmarkup.sh?bcp=78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.1">1.1</a>.  Secure Imprinting without Vouchers  . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-1.2">1.2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-1.3">1.3</a>.  Scope of solution . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-2">2</a>.  Architectural Overview  . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-2.1">2.1</a>.  Secure Imprinting without Vouchers  . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-2.2">2.2</a>.  Secure Imprinting using Vouchers  . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-3">3</a>.  Functional Overview . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-3.1">3.1</a>.  Behavior of a Pledge  . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
       <a href="#section-3.1.1">3.1.1</a>.  Discovery . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
       <a href="#section-3.1.2">3.1.2</a>.  Identity  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
       <a href="#section-3.1.3">3.1.3</a>.  Request Join  . . . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
       <a href="#section-3.1.4">3.1.4</a>.  Imprint . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
       <a href="#section-3.1.5">3.1.5</a>.  Lack of realtime clock  . . . . . . . . . . . . . . .  <a href="#page-20">20</a>
       <a href="#section-3.1.6">3.1.6</a>.  Enrollment  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-21">21</a>
       <a href="#section-3.1.7">3.1.7</a>.  Being Managed . . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
     <a href="#section-3.2">3.2</a>.  Behavior of a Proxy . . . . . . . . . . . . . . . . . . .  <a href="#page-22">22</a>
       <a href="#section-3.2.1">3.2.1</a>.  CoAP connection to Registrar  . . . . . . . . . . . .  <a href="#page-23">23</a>
       <a href="#section-3.2.2">3.2.2</a>.  HTTPS proxy connection to Registrar . . . . . . . . .  <a href="#page-23">23</a>
     <a href="#section-3.3">3.3</a>.  Behavior of the Registrar . . . . . . . . . . . . . . . .  <a href="#page-24">24</a>
       <a href="#section-3.3.1">3.3.1</a>.  Pledge Authentication . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-3.3.2">3.3.2</a>.  Pledge Authorization  . . . . . . . . . . . . . . . .  <a href="#page-25">25</a>
       <a href="#section-3.3.3">3.3.3</a>.  Claiming the New Entity . . . . . . . . . . . . . . .  <a href="#page-26">26</a>
       <a href="#section-3.3.4">3.3.4</a>.  Log Verification  . . . . . . . . . . . . . . . . . .  <a href="#page-27">27</a>
     <a href="#section-3.4">3.4</a>.  Behavior of the MASA Service  . . . . . . . . . . . . . .  <a href="#page-27">27</a>
       <a href="#section-3.4.1">3.4.1</a>.  Issue Audit Voucher and Log the event . . . . . . . .  <a href="#page-27">27</a>
       <a href="#section-3.4.2">3.4.2</a>.  Retrieve Audit Entries from Log . . . . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-3.5">3.5</a>.  Leveraging the new key infrastructure / next steps  . . .  <a href="#page-28">28</a>
       <a href="#section-3.5.1">3.5.1</a>.  Network boundaries  . . . . . . . . . . . . . . . . .  <a href="#page-28">28</a>
     <a href="#section-3.6">3.6</a>.  Interactions with Network Access Control  . . . . . . . .  <a href="#page-28">28</a>
   <a href="#section-4">4</a>.  Domain Operator Activities  . . . . . . . . . . . . . . . . .  <a href="#page-29">29</a>



<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 2]</span>
</pre><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


     <a href="#section-4.1">4.1</a>.  Instantiating the Domain Certification Authority  . . . .  <a href="#page-29">29</a>
     <a href="#section-4.2">4.2</a>.  Instantiating the Registrar . . . . . . . . . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-4.3">4.3</a>.  Accepting New Entities  . . . . . . . . . . . . . . . . .  <a href="#page-29">29</a>
     <a href="#section-4.4">4.4</a>.  Automatic Enrollment of Devices . . . . . . . . . . . . .  <a href="#page-30">30</a>
     <a href="#section-4.5">4.5</a>.  Secure Network Operations . . . . . . . . . . . . . . . .  <a href="#page-31">31</a>
   <a href="#section-5">5</a>.  Proxy Discovery Protocol Details  . . . . . . . . . . . . . .  <a href="#page-31">31</a>
   <a href="#section-6">6</a>.  Registrar Discovery Protocol Details  . . . . . . . . . . . .  <a href="#page-31">31</a>
   <a href="#section-7">7</a>.  Protocol Details  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-32">32</a>
     <a href="#section-7.1">7.1</a>.  Request Voucher from the Registrar  . . . . . . . . . . .  <a href="#page-34">34</a>
     <a href="#section-7.2">7.2</a>.  Request Voucher from MASA . . . . . . . . . . . . . . . .  <a href="#page-36">36</a>
     <a href="#section-7.3">7.3</a>.  Audit Voucher Response  . . . . . . . . . . . . . . . . .  <a href="#page-37">37</a>
       7.3.1.  Completing authentication of Provisional TLS
               connection  . . . . . . . . . . . . . . . . . . . . .  <a href="#page-38">38</a>
     <a href="#section-7.4">7.4</a>.  Voucher Status Telemetry  . . . . . . . . . . . . . . . .  <a href="#page-39">39</a>
     <a href="#section-7.5">7.5</a>.  MASA authorization log Request  . . . . . . . . . . . . .  <a href="#page-40">40</a>
     <a href="#section-7.6">7.6</a>.  MASA authorization log Response . . . . . . . . . . . . .  <a href="#page-40">40</a>
     <a href="#section-7.7">7.7</a>.  EST Integration for PKI bootstrapping . . . . . . . . . .  <a href="#page-41">41</a>
       <a href="#section-7.7.1">7.7.1</a>.  EST Distribution of CA Certificates . . . . . . . . .  <a href="#page-41">41</a>
       <a href="#section-7.7.2">7.7.2</a>.  EST CSR Attributes  . . . . . . . . . . . . . . . . .  <a href="#page-41">41</a>
       <a href="#section-7.7.3">7.7.3</a>.  EST Client Certificate Request  . . . . . . . . . . .  <a href="#page-42">42</a>
       <a href="#section-7.7.4">7.7.4</a>.  Enrollment Status Telemetry . . . . . . . . . . . . .  <a href="#page-42">42</a>
       <a href="#section-7.7.5">7.7.5</a>.  EST over CoAP . . . . . . . . . . . . . . . . . . . .  <a href="#page-43">43</a>
   <a href="#section-8">8</a>.  Reduced security operational modes  . . . . . . . . . . . . .  <a href="#page-44">44</a>
     <a href="#section-8.1">8.1</a>.  Trust Model . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-44">44</a>
     <a href="#section-8.2">8.2</a>.  New Entity security reductions  . . . . . . . . . . . . .  <a href="#page-44">44</a>
     <a href="#section-8.3">8.3</a>.  Registrar security reductions . . . . . . . . . . . . . .  <a href="#page-45">45</a>
     <a href="#section-8.4">8.4</a>.  MASA security reductions  . . . . . . . . . . . . . . . .  <a href="#page-46">46</a>
   <a href="#section-9">9</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-46">46</a>
     <a href="#section-9.1">9.1</a>.  Pledge Privacy Considerations . . . . . . . . . . . . . .  <a href="#page-47">47</a>
     <a href="#section-9.2">9.2</a>.  Network Privacy Considerations  . . . . . . . . . . . . .  <a href="#page-47">47</a>
   <a href="#section-10">10</a>. Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-47">47</a>
     <a href="#section-10.1">10.1</a>.  Security concerns with discovery process . . . . . . . .  <a href="#page-48">48</a>
       <a href="#section-10.1.1">10.1.1</a>.  Discovery of Registrar by Proxy  . . . . . . . . . .  <a href="#page-48">48</a>
       <a href="#section-10.1.2">10.1.2</a>.  Discovery of Proxy by New Entity . . . . . . . . . .  <a href="#page-48">48</a>
   <a href="#section-11">11</a>. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-49">49</a>
   <a href="#section-12">12</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-49">49</a>
     <a href="#section-12.1">12.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-49">49</a>
     <a href="#section-12.2">12.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-50">50</a>
   <a href="#appendix-A">Appendix A</a>.  IPv4 operations  . . . . . . . . . . . . . . . . . .  <a href="#page-52">52</a>
     <a href="#appendix-A.1">A.1</a>.  IPv4 Link Local addresses . . . . . . . . . . . . . . . .  <a href="#page-52">52</a>
     <a href="#appendix-A.2">A.2</a>.  Use of DHCPv4 . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-52">52</a>
   <a href="#appendix-B">Appendix B</a>.  mDNS / DNSSD proxy discovery options . . . . . . . .  <a href="#page-52">52</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-53">53</a>








<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 3]</span>
</pre><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h2"><a name="section-1">1</a>.  Introduction</span>

   To literally "pull yourself up by the bootstraps" is an impossible
   action.  Similarly the secure establishment of a key infrastructure
   without external help is also an impossibility.  Today it is commonly
   accepted that the initial connections between nodes are insecure,
   until key distribution is complete, or that domain-specific keying
   material is pre-provisioned on each new device in a costly and non-
   scalable manner.  These existing mechanisms are known as non-secured
   'Trust on First Use' (TOFU) [<a href="./rfcmarkup.sh?rfc=7435" title='"Opportunistic Security: Some Protection Most of the Time"'>RFC7435</a>], 'resurrecting duckling'
   [<a href="#ref-Stajano99theresurrecting">Stajano99theresurrecting</a>] or 'pre-staging'.

   This document describes a zero-touch approach to bootstrapping that
   secures the initial distribution of key material between an
   unconfigured and untouched device called a "Pledge" and the
   "Registrar" device that is a member of an established network domain.
   The bootstrapping process provides a foundation to securely answer
   the following questions:

   o  Registrar authenticating the Pledge: "Who is this device?  What is
      its identity?"

   o  Registrar authorization the Pledge: "Is it mine?  Do I want it?
      What are the chances it has been compromised?"

   o  Pledge authenticating the Registrar/Domain: "What is this domain's
      identity?"

   o  Pledge authorization the Registrar: "Should I join it?"

   This document details protocols and messages to the endpoints to
   answer the above questions.  The Registrar actions derive from Pledge
   identity, third party cloud service communications, and local access
   control lists.  The Pledge actions derive from a cryptographically
   protected "voucher" message delivered through the Registrar.
   Multiple forms of "vouchers" are described to support a variety of
   use cases.

   The syntactic details of vouchers are described in detail in
   [<a href="#ref-I-D.ietf-anima-voucher">I-D.ietf-anima-voucher</a>], but relevant semantics of voucher creation
   for use in ANIMA are described in this document.

   The result of bootstrapping is that a security association between
   the Pledge and the Registrar is established.  A method of leveraging
   this association to optimize PKI enrollment is described.






<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 4]</span>
</pre><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The described system is agile enough to support bootstrapping
   alternative key infrastructures, such as a symmetric key solutions,
   but no such system is described.

<span class="h3"><a name="section-1.1">1.1</a>.  Secure Imprinting without Vouchers</span>

   There are pre-existing methods available for establishing initial
   trust.  For example the enrollment protocol EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] details a
   set of non-autonomic bootstrapping methods such as:

   o  using the Implicit Trust Anchor database (not an autonomic
      solution because the URL must be securely distributed),

   o  engaging a human user to authorize the CA certificate using out-
      of-band data (not an autonomic solution because the human user is
      involved),

   o  using a configured Explicit TA database (not an autonomic solution
      because the distribution of an explicit TA database is not
      autonomic),

   o  and using a Certificate-Less TLS mutual authentication method (not
      an autonomic solution because the distribution of symmetric key
      material is not autonomic).

   These "touch" methods do not meet the requirements for zero-touch.

   There are "call home" technologies where the Pledge first establishes
   a connection to a well known vendor service using a common client-
   server authentication model.  After mutual authentication appropriate
   credentials to authenticate the target domain are transfered to the
   Pledge.  This creates serveral problems and limitations:

   o  the pledge requires realtime connectivity to the vendor service,

   o  the domain identity is exposed to the vendor service (this is a
      privacy concern),

   o  the vendor is responsible for making the authorization decisions
      (this is a liability concern),

   BRSKI addresses these issues by introducting an authorization layer
   via "vouchers".  The additional complexity provides for significant
   flexibility.







<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 5]</span>
</pre><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h3"><a name="section-1.2">1.2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   [<a href="./rfcmarkup.sh?rfc=2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

   The following terms are defined for clarity:

   DomainID:  The domain identity is the 160-bit SHA-1 hash of the BIT
      STRING of the subjectPublicKey of the domain trust anchor that is
      stored by the Domain CA.  This is consistent with the
      Certification Authority subject key identifier (<a href="./rfcmarkup.sh?rfc=5280#section-4.2.1.2">Section&nbsp;4.2.1.2
      [RFC5280]</a>) of the Domain CA's self signed root certificate.  (A
      string value bound to the Domain CA's self signed root certificate
      subject and issuer fields is often colloquially used as a
      humanized identity value but during protocol discussions the more
      exact term as defined here is used).

   drop ship:  The physical distribution of equipment containing the
      "factory default" configuration to a final destination.  In zero-
      touch scenarios there is no staging or pre-configuration during
      drop-ship.

   imprint:  The process where a device obtains the cryptographic key
      material to identify and trust future interactions with a network.
      This term is taken from Konrad Lorenz's work in biology with new
      ducklings: during a critical period, the duckling would assume
      that anything that looks like a mother duck is in fact their
      mother.  An equivalent for a device is to obtain the fingerprint
      of the network's root certification authority certificate.  A
      device that imprints on an attacker suffers a similar fate to a
      duckling that imprints on a hungry wolf.  Securely imprinting is a
      primary focus of this document.[<a href="#ref-imprinting">imprinting</a>].  The analogy to
      Lorenz's work was first noted in [<a href="#ref-Stajano99theresurrecting">Stajano99theresurrecting</a>].

   enrollment:  The process where a device presents key material to a
      network and acquires a network specific identity.  For example
      when a certificate signing request is presented to a certification
      authority and a certificate is obtained in response.

   Pledge:  The prospective device, which has an identity installed by a
      third-party (e.g., vendor, manufacturer or integrator).

   Voucher  A signed statement from the MASA service that indicates to a
      Pledge the cryptographic identity of the Registrar it should
      trust.  There are different types of vouchers depending on how




<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 6]</span>
</pre><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


      that trust asserted.  Multiple voucher types are defined in
      [<a href="#ref-I-D.ietf-anima-voucher">I-D.ietf-anima-voucher</a>]

   Domain:  The set of entities that trust a common key infrastructure
      trust anchor.  This includes the Proxy, Registrar, Domain
      Certificate Authority, Management components and any existing
      entity that is already a member of the domain.

   Domain CA:  The domain Certification Authority (CA) provides
      certification functionalities to the domain.  At a minimum it
      provides certification functionalities to a Registrar and stores
      the trust anchor that defines the domain.  Optionally, it
      certifies all elements.

   Join Registrar:  A representative of the domain that is configured,
      perhaps autonomically, to decide whether a new device is allowed
      to join the domain.  The administrator of the domain interfaces
      with a Join Registrar to control this process.  Typically a Join
      Registrar is "inside" its domain.  For simplicity this document
      often refers to this as "Registrar".

   Proxy:  A domain entity that helps the pledge join the domain.  A
      Proxy facilitates communication for devices that find themselves
      in an environment where they are not provided connectivity until
      after they are validated as members of the domain.  The pledge is
      unaware that they are communicating with a proxy rather than
      directly with a Registrar.

   MASA Service:  A third-party Manufacturer Authorized Signing
      Authority (MASA) service on the global Internet.  The MASA signs
      vouchers.  It also provides a repository for audit log information
      of privacy protected bootstrapping events.  It does not track
      ownership.

   Ownership Tracker:  An Ownership Tracker service on the global
      internet.  The Ownership Tracker uses business processes to
      accurately track ownership of all devices shipped against domains
      that have purchased them.  Although optional this component allows
      vendors to provide additional value in cases where their sales and
      distribution channels allow for accurately tracking of such
      ownership.  Ownership tracking information is indicated in
      vouchers as described in [<a href="#ref-I-D.ietf-anima-voucher">I-D.ietf-anima-voucher</a>]

   IDevID:  An Initial Device Identity X.509 certificate installed by
      the vendor on new equipment.  The [<a href="#ref-IDevID" title='"IEEE 802.1AR Secure Device Identifier"'>IDevID</a>] certificate format is
      the primary example.  In particular the X.509 certificate needs to
      contain the device's serial number in a well known location in
      order for the Join Registrar to perform white list operations and



<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 7]</span>
</pre><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


      in order to extract it for inclusion in messages to the MASA
      service.  The subject field's DN encoding MUST include the
      "serialNumber" attribute with the device's unique serial number.

   TOFU:  Trust on First Use. Used similarly to [<a href="./rfcmarkup.sh?rfc=7435" title='"Opportunistic Security: Some Protection Most of the Time"'>RFC7435</a>].  This is
      where a Pledge device makes no security decisions but rather
      simply trusts the first Registrar it is contacted by.  This is
      also known as the "resurrecting duckling" model.

<span class="h3"><a name="section-1.3">1.3</a>.  Scope of solution</span>

   Questions have been posed as to whether this solution is suitable in
   general for Internet of Things (IoT) networks.  This depends on the
   capabilities of the devices in question.  The terminology of
   [<a href="./rfcmarkup.sh?rfc=7228" title='"Terminology for Constrained-Node Networks"'>RFC7228</a>] is best used to describe the boundaries.

   The solution described in this document is aimed in general at non-
   constrained (i.e. class 2+) devices operating on a non-Challenged
   network.  The entire solution as described here is not intended to be
   useable as-is by constrained devices operating on challenged networks
   (such as 802.15.4 LLNs).

   There are a number of optional mechanisms in BRSKI.  These mechanisms
   are not mandatory to implement for the core applicability to ANIMA.
   These mechanisms have been moved out of the main flow of the document
   to appendices to emphasis that they are not considered normative,
   mandatory to implement, while making it easier for another document
   to normatively reference them.

   In many target applications, the systems involved are large router
   platforms with multi-gigabit inter-connections, mounted in controlled
   access data centers.  But this solution is not exclusive to the
   large, it is intended to scale to thousands of devices located in
   hostile environments, such as ISP provided CPE devices which are
   drop-shipped to the end user.  The situation where an order is
   fulfilled from distributed warehouse from a common stock and shipped
   directly to the target location at the request of the domain owner is
   explicitly supported.  That stock ("SKU") could be provided to a
   number of potential domain owners, and the eventual domain owner will
   not know a-priori which device will go to which location.

   The bootstrapping process can take minutes to complete depending on
   the network infrastructure and device processing speed.  The network
   communication itself is not optimized for speed; for privacy reasons,
   the discovery process allows for the Pledge to avoid announcing it's
   presence through broadcasting.  This protocol is not intended for low
   latency handoffs.  In networks requiring such things, the pledge
   SHOULD already have been enrolled.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 8]</span>
</pre><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   Specifically, there are protocol aspects described here which might
   result in congestion collapse or energy-exhaustion of intermediate
   battery powered routers in an LLN.  Those types of networks SHOULD
   NOT use this solution.  These limitations are predominately related
   to the large credential and key sizes required for device
   authentication.  Defining symmetric key techniques that meet the
   operational requirements is out-of-scope but the underlying protocol
   operations (TLS handshake and signing structures) have sufficient
   algorithm agility to support such techniques when defined.

   The imprint protocol described here could, however, be used by non-
   energy constrained devices joining a non-constrained network (for
   instance, smart light bulbs are usually mains powered, and speak
   802.11).  It could also be used by non-constrained devices across a
   non-energy constrained, but challenged network (such as 802.15.4).

   The use of an IDevID that is consistant with [<a href="#ref-IDevID" title='"IEEE 802.1AR Secure Device Identifier"'>IDevID</a>] allows for
   alignment with 802.1X network access control methods which could need
   to complete before bootstrapping can be initiated.  This document
   presumes that network access control has either already occurred, is
   not required, or is integrated by the proxy and registrar in such a
   way that the device itself does not need to be aware of the details.
   Further integration is not in scope.

   Some aspects are in scope for constrained devices on challenged
   networks: the certificate contents, and the process by which the four
   questions above are resolved is in scope.  It is simply the actual
   on-the-wire imprint protocol which is likely inappropriate.

<span class="h2"><a name="section-2">2</a>.  Architectural Overview</span>

   The logical elements of the bootstrapping framework are described in
   this section.  Figure 1 provides a simplified overview of the
   components.  Each component is logical and may be combined with other
   components as necessary.
















<span class="grey">Pritikin, et al.         Expires August 7, 2017                 [Page 9]</span>
</pre><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


                                             .
                                             .+------------------------+
      +--------------Drop Ship--------------&gt;.| Vendor Service         |
      |                                      .+------------------------+
      |                                      .| M anufacturer|         |
      |                                      .| A uthorized  |Ownership|
      |                                      .| S igning     |Tracker  |
      |                                      .| A uthority   |         |
      |                                      .+--------------+---------+
      |                                      ..............  ^
      V                                                      |
   +-------+     ............................................|...
   |       |     .                                           |  .
   |       |     .  +------------+       +-----------+       |  .
   |       |     .  |            |       |           |       |  .
   |Pledge |     .  |   Circuit  |       | Domain    &lt;-------+  .
   |       |     .  |   Proxy    |       | Registrar |          .
   |       &lt;--------&gt;            &lt;-------&gt;           |          .
   |       |     .  |            |       |           |          .
   |       |     .  +------------+       +-----+-----+          .
   |       |     .                             |                .
   |       |     .           +-----------------+----------+     .
   |       |     .           | Domain Certification       |     .
   |       |     .           | Authority                  |     .
   +-------+     .           | Management and etc         |     .
                 .           +----------------------------+     .
                 .                                              .
                 ................................................
                               "Domain" components


   Figure 1

   We assume a multi-vendor network.  In such an environment there could
   be a Vendor Service for each vendor that supports devices following
   this document's specification, or an integrator could provide a
   generic service authorized by multiple vendors.  It is unlikely that
   an integrator could provide Ownership Tracking services for multiple
   vendors due to the required sales channel integrations necessary to
   track ownership.

   The domain is the managed network infrastructure the Pledge is
   managed by.  The a domain provides initial device connectivity
   minimally sufficient for bootstrapping through the Circuit Proxy.
   The Domain registrar makes authorization decisions and handles
   connectivity to the vendor services and authenticates the Pledge.
   Optional cryptographic credential and configuration management
   systems are expected.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 10]</span>
</pre><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   This document describes a secure zero-touch approach to bootstrapping
   a remote key infrastructure.  Secure bootstrapping requires
   mitigating the threat of an attacker domain establishing a management
   role over the pledge device.  In a "trust on first use" model, where
   this threat is ignored, the attacker has an opportunity to install a
   persistent malware component.  This document uses Vouchers to address
   the threat while maintaining a significant level of flexibility.

<span class="h3"><a name="section-2.1">2.1</a>.  Secure Imprinting without Vouchers</span>

   There are pre-existing methods available for establishing initial
   trust.  For example the enrollment protocol EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] details a
   set of non-autonomic bootstrapping methods such as:

   o  using the Implicit Trust Anchor database (not an autonomic
      solution because the URL must be securely distributed),

   o  engaging a human user to authorize the CA certificate using out-
      of-band data (not an autonomic solution because the human user is
      involved),

   o  using a configured Explicit TA database (not an autonomic solution
      because the distribution of an explicit TA database is not
      autonomic),

   o  and using a Certificate-Less TLS mutual authentication method (not
      an autonomic solution because the distribution of symmetric key
      material is not autonomic).

   These "touch" methods do not meet the requirements for zero-touch.

   There are "call home" technologies where the Pledge first establishes
   a connection to a well known vendor service using a common client-
   server authentication model.  After mutual authentication appropriate
   credentials to authenticate the target domain are transfered to the
   Pledge.  This creates serveral problems and limitations:

   o  the pledge requires realtime connectivity to the vendor service,

   o  the domain identity is exposed to the vendor service (this is a
      privacy concern),

   o  the vendor is responsible for making the authorization decisions
      (this is a liability concern),

   BRSKI addresses these issues by introducting an authorization layer
   via "vouchers".  The additional complexity provides for significant
   flexibility.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 11]</span>
</pre><pre class='newpage'><a name="page-12" id="page-12" href="#page-12" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h3"><a name="section-2.2">2.2</a>.  Secure Imprinting using Vouchers</span>

   A voucher is a cryptographically protected statement to the Pledge
   device indicating authorizing a zero-touch imprint on the Registrar
   domain.

   The format and cryptographic mechanism of vouchers is described in
   detail in [<a href="#ref-I-D.ietf-anima-voucher">I-D.ietf-anima-voucher</a>].  [[EDNOTE: more of this will
   move]].  This section details the semantics as they apply to the
   ANIMA focused BRSKI protocol.

   Generically the voucher imparts the following information to the
   Pledge:

   Assertion Basis  Indicates the method that protects the imprint.
      This might include discrete ownership verification, assured
      logging operation or reliance on Pledge endpoint behavior such as
      secure root of trust of measurement.  Only some methods are
      normatively defined in this document.  Other methods are left for
      future work.

   Registrar Authentication  Indicates how the Pledge can authenticate
      the Registrar.  This might include an indication of the PKIX trust
      anchor used by the Registrar, or an indication of shared PKIX
      trust anchor and additional CN-ID or DNS-ID information to
      complete authentication.  Symmetric key or other methods are left
      for future work.

   Anti-Replay Protections  Time or nonce based information constrain
      vouchers to time periods or bootstrap attempts.

   A number of boostrapping scenarios can be met using differing
   combinations of this information.  All scenarios address the primary
   threat of a MiTM Registrar gaining control over the Pledge device.
   The difference combinations are named here for the purpose of
   discussion, even though some are considered too inappropriate.  The
   primary voucher combinations are referred to within this document by
   name:













<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 12]</span>
</pre><pre class='newpage'><a name="page-13" id="page-13" href="#page-13" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


                |Assertion   |Registrar ID    |Pledge ID | Validity    |
                |Log-|Veri-  |Trust  |CN-ID or|serial    | RTC | Nonce |
                | ged|  fied |Anchor |DNS-ID  |number    |     |       |
   --------------------------------------------------------------------|
   Audit        |  X |       | X     |        | X        |     | X     |
   -------------|----|-------|-------|--------|----------|-----|-------|
   Nonceless    |  X |       | X     |        | X        |     |       |
   Audit        |    |       |       |        |          |     |       |
   -------------|----|-------|-------|--------|----------|-----|-------|
   Owner Audit  |  X |   X   | X     |        | X        |     | X     |
   -------------|----|-------|-------|--------|----------|-----|-------|
   Owner ID     |    |   X   | ?     |  X     | X        | X   |       |
   -------------|----|-------|----------------|----------|-------------|
   BearerVoucher|  X |       |   wildcard     | X        | ?           |
   -------------|----|-------|----------------|----------|-------------|
   MasterVoucher|    |       |   wildcard     | wildcard | X   |       |
   -------------|------------|----------------|----------|-----|-------|


   Audit Voucher  An Audit Voucher is named after the logging assertion
      mechanisms that the Registrar then "audits" to enforce local
      policy.  The Registrar mitigates a MiTM Registrar by auditing that
      an unknown MiTM registrar does not appear in the log entries.
      This does not directly prevent the MiTM from occuring.  A MiTM
      that claims a device and never returns it appears to the real
      owner as a straight theft: it is as if the device never was turned
      on.  This mechanism provides a response mechanism that ensures a
      MiTM whose purpose is to install malware and then turn the device
      over to the real owner is unsuccessful.  This advantage is that
      detailed ownership knowledge is not required on the MASA service.

   Nonceless Audit Voucher  An Audit Voucher without a validity period
      statement.  Fundamentally the same as an Audit Voucher except that
      it can be issued in advance to support network partions or to
      provide a permanent voucher for remote deployments.  If more than
      one nonceless voucher is issued to different owners, the lack of
      time in them means that it is not possible to determine which
      voucher is newer.

   Ownership Audit Voucher  An Audit Voucher where the MASA service has
      verified the Registrar as the authorized owner.  The MASA service
      mitigates a MiTM Registrar by refusing to generate Audit Voucher's
      for unauthorized Registrars.  The Registrar uses audit techniques
      to suppliment the MASA.  This provides an ideal sharing of policy
      decisions and enforcement between the vendor and the owner.

   Ownership ID Voucher  An Ownership ID Voucher is named after
      inclusion of the Pledge's CN-ID or DNS-ID within the voucher.  An



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 13]</span>
</pre><pre class='newpage'><a name="page-14" id="page-14" href="#page-14" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


      example Ownership Voucher is defined in
      [<a href="#ref-I-D.ietf-netconf-zerotouch">I-D.ietf-netconf-zerotouch</a>].  The MASA service prevents a MiTM
      Registrar from being accepted by identifying the specific
      Registrar authorized to own the Pledge.

   Bearer Voucher  A Bearer Voucher is named after the inclusion of a
      Registrar ID wildcard.  Because the Registrar is not specifically
      identified this voucher type must be treated as a secret and
      protected from exposure as any 'bearer' of the voucher can claim
      the Pledge device.  Theoretically "nonced" and "nonceless" bearer
      vouches can exist.  Publishing a nonceless bearer voucher
      effectively turns the specified Pledge into a "TOFU" device with
      minimal mitigation against MiTM Registrars.

   Master Voucher  A Master Voucher is named after the inclusion of a
      Pledge ID wildcard.  Because the Pledge is not specifically
      identified publishing a nonceless Master Voucher would turn all
      Pledges that trust the MASA into TOFU devices.  This would be a
      significant security consideration as it puts too much power in
      the hands of the vendor MASA service.  Wildcard Pledge IDs MUST
      NOT be accepted.

   [[EDNOTE: Exact definitions of Assertion, ID and Validity methods
   come from the voucher document.  Included are normative statements on
   how Registrar and Pledge operate on these informations after
   verifying the voucher]]

<span class="h2"><a name="section-3">3</a>.  Functional Overview</span>

   Entities behave in an autonomic fashion.  They discover each other
   and autonomically bootstrap into a key infrastructure delineating the
   autonomic domain.  See [<a href="./rfcmarkup.sh?rfc=7575" title='"Autonomic Networking: Definitions and Design Goals"'>RFC7575</a>] for more information.

   This section details the state machine and operational flow for each
   of the main three entities.  The pledge, the domain (primarily a
   Registrar) and the MASA service.

   A representative flow is shown in Figure 2:

     +--------+         +---------+    +------------+     +------------+
     | Pledge |         | Circuit |    | Domain     |     | Vendor     |
     |        |         | Proxy   |    | Registrar  |     | Service    |
     |        |         |         |    |            |     | (Internet  |
     +--------+         +---------+    +------------+     +------------+
      |                     |                   |                    |
      |&lt;-RFC3927 IPv4 adr   | <a href="#appendix-A">Appendix A</a>        |                    |
    or|&lt;-RFC4862 IPv6 adr   |                   |                    |
      |                     |                   |                    |



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 14]</span>
</pre><pre class='newpage'><a name="page-15" id="page-15" href="#page-15" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


      |--------------------&gt;|                   |                    |
      | optional: mDNS query| <a href="#appendix-B">Appendix B</a>        |                    |
      | <a href="./rfcmarkup.sh?rfc=6763">RFC6763</a>/RFC6762     |                   |                    |
      |                     |                   |                    |
      |&lt;--------------------|                   |                    |
      | GRASP M_FLOOD       |                   |                    |
      |   periodic broadcast|                   |                    |
      |                     |                   |                    |
      |&lt;-------------------&gt;C&lt;-----------------&gt;|                    |
      |            TLS via the Circuit Proxy    |                    |
      |&lt;--Registrar TLS server authentication---|                    |
  [PROVISIONAL accept of server cert]           |                    |
      P---X.509 client authentication----------&gt;|                    |
      P                     |                   |                    |
      P---Request Voucher (include nonce)------&gt;|                    |
      P                     |                   |                    |
      P                     |       /---&gt;       |                    |
      P                     |       |      [accept device?]          |
      P                     |       |      [contact Vendor]          |
      P                     |       |           |--Pledge ID--------&gt;|
      P                     |       |           |--Domain ID--------&gt;|
      P                     |       |           |--optional:nonce---&gt;|
      P                     |       |           |     [extract DomainID]
      P                     |       |           |                    |
      P                     |    optional:      |     [update audit log]
      P                     |       |can        |                    |
      P                     |       |occur      |                    |
      P                     |       |in         |                    |
      P                     |       |advance    |                    |
      P                     |       |           |                    |
      P                     |       |           |&lt;-device audit log--|
      P                     |       |           |&lt;- voucher ---------|
      P                     |       \----&gt;      |                    |
      P                     |                   |                    |
      P                     |       [verify audit log and voucher]   |
      P                     |                   |                    |
      P&lt;------voucher---------------------------|                    |
  [verify voucher ]         |                   |                    |
  [verify provisional cert ]|                   |                    |
      |                     |                   |                    |
      |----------------------------------------&gt;|                    |
      | Continue with <a href="./rfcmarkup.sh?rfc=7030">RFC7030</a> enrollment        |                    |
      | using now bidirectionally authenticated |                    |
      | TLS session.        |                   |                    |
      |                     |                   |                    |
      |                     |                   |                    |
      |                     |                   |                    |




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 15]</span>
</pre><pre class='newpage'><a name="page-16" id="page-16" href="#page-16" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   Figure 2

<span class="h3"><a name="section-3.1">3.1</a>.  Behavior of a Pledge</span>

   A pledge that has not yet been bootstrapped attempts to find a local
   domain and join it.  A pledge MUST NOT automatically initiate
   bootstrapping if it has already been configured or is in the process
   of being configured.

   States of a pledge are as follows:









































<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 16]</span>
</pre><pre class='newpage'><a name="page-17" id="page-17" href="#page-17" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


                +--------------+
                |   Start      |
                |              |
                +------+-------+
                       |
                +------v-------+
                |  Discover    |
   +------------&gt;              |
   |            +------+-------+
   |                   |
   |            +------v-------+
   |            |  Identity    |
   ^------------+              |
   | rejected   +------+-------+
   |                   |
   |            +------v-------+
   |            | Request      |
   |            | Join         |
   |            +------+-------+
   |                   |
   |            +------v-------+
   |            |  Imprint     |   Optional
   ^------------+              &lt;--+Manual input
   | Bad Vendor +------+-------+
   | response          |
   |            +------v-------+
   |            |  Enroll      |
   ^------------+              |
   | Enroll     +------+-------+
   | Failure           |
   |            +------v-------+
   |            |  Being       |
   ^------------+  Managed     |
    Factory     +--------------+
    reset


   Figure 3

   State descriptions for the pledge are as follows:

   1.  Discover a communication channel to a Registrar.

   2.  Identify itself.  This is done by presenting an IDevID X.509
       credential to the discovered Registrar (via the Proxy) in a TLS
       handshake.  (The Registrar credentials are only provisionally
       accepted at this time).




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 17]</span>
</pre><pre class='newpage'><a name="page-18" id="page-18" href="#page-18" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   3.  Requests to Join the discovered Registrar.  A unique nonce is
       included ensuring that any responses can be associated with this
       particular bootstrapping attempt.

   4.  Imprint on the Registrar.  This requires verification of the
       vendor service provided "Audit" or "Ownership" Voucher.  Either
       of these responses contains sufficient information for the pledge
       to complete authentication of a Registrar.  (The pledge can now
       finish authentication of the Registrar TLS server certificate)

   5.  Enroll by accepting the domain specific information from a
       Registrar, and by obtaining a domain certificate from a Registrar
       using a standard enrollment protocol, e.g.  Enrollment over
       Secure Transport (EST) [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>].

   6.  The Pledge is now a member of, and can be managed by, the domain
       and will only repeat the discovery aspects of bootstrapping if it
       is returned to factory default settings.

   The following sections describe each of these steps in more detail.

<span class="h4"><a name="section-3.1.1">3.1.1</a>.  Discovery</span>

   The result of discovery is a logical communication with a Registrar,
   through a Proxy.  The Proxy is transparent to the Pledge but is
   always assumed to exist.

   To discover the Registrar the Pledge performs the following actions:

   a.  MUST: Obtains a local address using IPv6 methods as described in
       [<a href="./rfcmarkup.sh?rfc=4862" title='"IPv6 Stateless Address Autoconfiguration"'>RFC4862</a>] IPv6 Stateless Address AutoConfiguration.  [<a href="./rfcmarkup.sh?rfc=7217" title='"A Method for Generating Semantically Opaque Interface Identifiers with IPv6 Stateless Address Autoconfiguration (SLAAC)"'>RFC7217</a>] is
       encouraged, but see <a href="#section-9">Section 9</a>.  IPv4 methods are described in
       <a href="#appendix-A">Appendix A</a>

   b.  MUST: Listen for GRASP M_FLOOD ([<a href="#ref-I-D.ietf-anima-grasp">I-D.ietf-anima-grasp</a>])
       announcements of the objective: "ACP+Proxy".  See section
       <a href="#section-5">Section 5</a> for the details of the the objective.  The Pledge may
       listen concurrently for other sources of information, see
       <a href="#appendix-B">Appendix B</a>.

   Once a proxy is discovered the Pledge communicates with a Registrar
   through the proxy using the bootstrapping protocol defined in
   <a href="#section-7">Section 7</a>.

   Each discovery method attempted SHOULD exponentially back-off
   attempts (to a maximum of one hour) to avoid overloading the network
   infrastructure with discovery.  The back-off timer for each method
   MUST be independent of other methods.  Methods SHOULD be run in



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 18]</span>
</pre><pre class='newpage'><a name="page-19" id="page-19" href="#page-19" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   parallel to avoid head of queue problems.  Once a connection to a
   Registrar is established (e.g. establishment of a TLS session key)
   there are expectations of more timely responses, see <a href="#section-7.1">Section 7.1</a>.

   Once all discovered services are attempted the device SHOULD return
   to listening for GRASP M_FLOOD.  It should periodically retry the
   vendor specific mechanisms.  The Pledge MAY prioritize selection
   order as appropriate for the anticipated environment.

<span class="h4"><a name="section-3.1.2">3.1.2</a>.  Identity</span>

   The Pledge identifies itself during the communication protocol
   handshake.  If the client identity is rejected (that is, the TLS
   handshake does not complete) the Pledge repeats the Identity process
   using the next proxy or discovery method available.

   The bootstrapping protocol server is not initially authenticated.
   Thus the connection is provisional and all data received is untrusted
   until sufficiently validated even though it is over a TLS connection.
   This is aligned with the existing provisional mode of EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>]
   during s4.1.1 "Bootstrap Distribution of CA Certificates".  See
   <a href="#section-7.3">Section 7.3</a> for more information about when the TLS connection
   authentication is completed.

   All security associations established are between the new device and
   the Bootstrapping server regardless of proxy operations.

<span class="h5"><a name="section-3.1.2.1">3.1.2.1</a>.  Concurrent attempts to join</span>

   The Pledge MAY attempt multiple mechanisms concurrently, but if it
   does so, it MUST wait in the provisional state until all mechanisms
   have either succeeded or failed, and then MUST proceed with the
   highest priority mechanism which has succeed.  To proceed beyond this
   point, specifically, to provide a nonce, could result in the MASA
   gratuitously auditing a connection.

<span class="h4"><a name="section-3.1.3">3.1.3</a>.  Request Join</span>

   The Pledge POSTs a request to join the domain to the Bootstrapping
   server.  This request contains a Pledge generated nonce and informs
   the Bootstrapping server which imprint methods the Pledge will
   accept.

   The nonce ensures the Pledge can verify that responses are specific
   to this bootstrapping attempt.  This minimizes the use of global time
   and provides a substantial benefit for devices without a valid clock.





<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 19]</span>
</pre><pre class='newpage'><a name="page-20" id="page-20" href="#page-20" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h5"><a name="section-3.1.3.1">3.1.3.1</a>.  Redirects during the Join Process</span>

   EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] describes situations where the bootstrapping server MAY
   redirect the client to an alternate server via a 3xx status code.
   Such redirects MAY be accepted if the pledge has used the methods
   described in <a href="#appendix-B">Appendix B</a>, in combination with an implicit trust
   anchor.  Redirects during the provisional period are otherwise
   unstrusted, and MUST cause a failure.

<span class="h4"><a name="section-3.1.4">3.1.4</a>.  Imprint</span>

   The Pledge validates the voucher and accepts the Registrar ID.  The
   provisional TLS connection is validated using the Registrar ID from
   the voucher.

<span class="h4"><a name="section-3.1.5">3.1.5</a>.  Lack of realtime clock</span>

   Many devices when bootstrapping do not have knowledge of the current
   time.  Mechanisms like Network Time Protocols can not be secured
   until bootstrapping is complete.  Therefore bootstrapping is defined
   in a method that does not require knowledge of the current time.

   Unfortunately there are moments during bootstrapping when
   certificates are verified, such as during the TLS handshake, where
   validity periods are confirmed.  This paradoxical "catch-22" is
   resolved by the Pledge maintaining a concept of the current "window"
   of presumed time validity that is continually refined throughout the
   bootstrapping process as follows:

   o  Initially the Pledge does not know the current time.

   o  During Pledge authentiation by the Registrar a realtime clock can
      be used by the Registrar.  This bullet expands on a closely
      related issue regarding Pledge lifetimes.  <a href="./rfcmarkup.sh?rfc=5280">RFC5280</a> indicates that
      long lived Pledge certifiates "SHOULD be assigned the
      GeneralizedTime value of 99991231235959Z" [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] so the
      Registrar MUST support such lifetimes and SHOULD support ignoring
      Pledge lifetimes if they did not follow the <a href="./rfcmarkup.sh?rfc=5280">RFC5280</a>
      recommendations.

   o  Once the Audit Voucher is accepted the validity period of the
      domainCAcert in the voucher (see <a href="#section-7.3">Section 7.3</a>) now describes a
      valid time window.  Any subsequent certificate validity periods
      checked during <a href="./rfcmarkup.sh?rfc=5280">RFC5280</a> path validation MUST occur within this
      window.

   o  When accepting an enrollment certificate the validity period
      within the new certificate is assumed to be valid by the Pledge.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 20]</span>
</pre><pre class='newpage'><a name="page-21" id="page-21" href="#page-21" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


      The Pledge is now willing to use this credential for client
      authentication.

   Once in this state the Pledge has a valid trust anchor with the local
   domain and has a locally issued credential.  These MAY be used to
   secure distribution of more accurate time information although
   specification of such a protocol is out-of-scope of this document.

   The nonce included in join attempts provides an alternate mechanism
   for the Pledge to ensure Audit Voucher responses are associated with
   a particular bootstrapping attempt.  Nonceless Audit Vouchers from
   the MASA server are always valid and thus time is not needed.

   Ownership Vouchers include time information and MUST be validated
   using a realtime clock.

<span class="h4"><a name="section-3.1.6">3.1.6</a>.  Enrollment</span>

   As the final step of bootstrapping a Registrar helps to issue a
   domain specific credential to the Pledge.  For simplicity in this
   document, a Registrar primarily facilitates issuing a credential by
   acting as an <a href="./rfcmarkup.sh?rfc=5280">RFC5280</a> Registration Authority for the Domain
   Certification Authority.

   Enrollment proceeds as described in [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>].  Authentication of the
   EST server is done using the Voucher rather than the methods defined
   in EST.

   Once the Audit or Ownership Voucher is received, as specified in this
   document, the client has sufficient information to leverage the
   existing communication channel with a Registrar to continue an EST
   <a href="./rfcmarkup.sh?rfc=7030">RFC7030</a> enrollment.  Enrollment picks up at <a href="./rfcmarkup.sh?rfc=7030#section-4.1.1">RFC7030 section&nbsp;4.1.1</a>.
   bootstrapping where the Audit Voucher provides the "out-of-band" CA
   certificate fingerprint (in this case the full CA certificate) such
   that the client can now complete the TLS server authentication.  At
   this point the client continues with EST enrollment operations
   including "CA Certificates Request", "CSR Attributes" and "Client
   Certificate Request" or "Server-Side Key Generation".

   For the purposes of creating the ANIMA Autonomic Control Plane, the
   contents of the new certificate MUST be carefully specified.
   [<a href="#ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>] <a href="#section-5.1.1">section 5.1.1</a> contains
   details.  The Registrar MUST provide the the correct ACP information
   to populate the subjectAltName / rfc822Name field in the "CSR
   Attributes" step, which is therefore mandatory.






<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 21]</span>
</pre><pre class='newpage'><a name="page-22" id="page-22" href="#page-22" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h4"><a name="section-3.1.7">3.1.7</a>.  Being Managed</span>

   Functionality to provide generic "configuration" information is
   supported.  The parsing of this data and any subsequent use of the
   data, for example communications with a Network Management System is
   out of scope but is expected to occur after bootstrapping enrollment
   is complete.  This ensures that all communications with management
   systems which can divulge local security information (e.g. network
   topology or raw key material) is secured using the local credentials
   issued during enrollment.

   The Pledge uses bootstrapping to join only one domain.  Management by
   multiple domains is out-of-scope of bootstrapping.  After the device
   has successfully joined a domain and is being managed it is plausible
   that the domain can insert credentials for other domains depending on
   the device capabilities.

   See <a href="#section-3.5">Section 3.5</a>.

<span class="h3"><a name="section-3.2">3.2</a>.  Behavior of a Proxy</span>

   The role of the Proxy is to facilitate communications.  The Proxy
   forwards packets between the Pledge and a Registrar that has been
   configured on the Proxy.  The Proxy does not terminate the TLS
   handshake.  A Proxy is always assumed even if it is directly
   integrated into a Registrar.  (In a completely autonomic network, the
   Registrar MUST provide proxy functionality so that it can be
   discovered, and the network can grow concentrically around the
   Registrar)

   As a result of the Proxy Discovery process in section <a href="#section-3.1.1">Section 3.1.1</a>,
   the port number exposed by the proxy does not need to be well known,
   or require an IANA allocation.

   If the Proxy joins an Autonomic Control Plane
   ([<a href="#ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>]) it SHOULD use Autonomic
   Control Plane secured GRASP ([<a href="#ref-I-D.ietf-anima-grasp">I-D.ietf-anima-grasp</a>]) to discovery the
   Registrar address and port.  For the IPIP encapsulation methods, the
   port announced by the Proxy MUST be the same as on the registrar in
   order for the proxy to remain stateless.

   In order to permit the proxy functionality to be implemented on the
   maximum variety of devices the chosen mechanism SHOULD use the
   minimum amount of state on the proxy device.  While many devices in
   the ANIMA target space will be rather large routers, the proxy
   function is likely to be implemented in the control plane CPU of such
   a device, with available capabilities for the proxy function similar
   to many class 2 IoT devices.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 22]</span>
</pre><pre class='newpage'><a name="page-23" id="page-23" href="#page-23" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The document [<a href="#ref-I-D.richardson-anima-state-for-joinrouter">I-D.richardson-anima-state-for-joinrouter</a>] provides a
   more extensive analysis of the alternative proxy methods.

<span class="h4"><a name="section-3.2.1">3.2.1</a>.  CoAP connection to Registrar</span>

   The proxy MUST implement an IPIP (protocol 41) encapsulation function
   for CoAP traffic to the configured UDP port on the registrar.  The
   proxy does not terminate the CoAP DTLS connection.  [[EDNOTE: The
   choice of CoAP as the mandatory to implement protocol rather than
   HTTP maximizes code reuse on the smallest of devices.  Unfortunately
   this means this document will have to include the EST over CoAP
   details as additional sections.  The alternative is to make 'HTTPS
   proxy' method the mandatory to implement and provide a less friendly
   environment for the smallest of devices.  This is a decision we'll
   have to see addressed by the broader team.]]

   The IPIP encapsulation allows the proxy to forward traffic which is
   otherwise not to be forwarded, as the traffic between New Node and
   Proxy use IPv6 Link Local addresses.

   If the Proxy device has more than one interface on which it offers
   the proxy function, then it must select a unique (ACP) IP address per
   interface in order so that the proxy can stateless return the (link-
   local) reply packets to the correct link.  The IPIP tunnel between
   the Proxy and the Registrar essentially extend the connectivity of
   the Registar such that it appears to be directly connected on the
   link.

<span class="h4"><a name="section-3.2.2">3.2.2</a>.  HTTPS proxy connection to Registrar</span>

   The proxy SHOULD also provide one of: an IPIP encapsulation of HTTP
   traffic on TCP port TBD to the registrar, or a TCP circuit proxy that
   connects the Pledge to a Registrar.

   When the Proxy provides a circuit proxy to a Registrar the Registrar
   MUST accept HTTPS connections.

   When the Proxy provides a stateless IPIP encapsulation to a
   Registrar, then the Registrar will have to perform IPIP
   decapsulation, remembering the originating outer IPIP source address
   in order to qualify the inner link-local address.  This is a kind of
   encapsulation and processing which is similar in many ways to how
   mobile IP works.

   Being able to connect a TCP (HTTP) or UDP (CoAP) socket to a link-
   local address with an encapsulated IPIP header requires API
   extensions beyond [<a href="./rfcmarkup.sh?rfc=3542" title='"Advanced Sockets Application Program Interface (API) for IPv6"'>RFC3542</a>] for UDP use, and requires a form of
   connection latching (see <a href="./rfcmarkup.sh?rfc=5386#section-4.1">section&nbsp;4.1 of [RFC5386]</a> and all of



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 23]</span>
</pre><pre class='newpage'><a name="page-24" id="page-24" href="#page-24" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   [<a href="./rfcmarkup.sh?rfc=5660" title='"IPsec Channels: Connection Latching"'>RFC5660</a>], except that a simple IPIP tunnel is used rather than an
   IPsec tunnel).

<span class="h3"><a name="section-3.3">3.3</a>.  Behavior of the Registrar</span>

   A Registrar listens for Pledges and determines if they can join the
   domain.  A Registrar obtains a Voucher from the MASA service and
   delivers them to the Pledge as well as facilitating enrollment with
   the domain PKI.

   A Registrar is typically configured manually.  When the Registrar
   joins an Autonomic Control Plane
   ([<a href="#ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>]) it MUST respond to GRASP
   ([<a href="#ref-I-D.ietf-anima-grasp">I-D.ietf-anima-grasp</a>]) M_DISCOVERY message.  See <a href="#section-6">Section 6</a>

   Registrar behavior is as follows:

   Contacted by Pledge
           +
           |
   +-------v----------+
   | Entity           | fail?
   | Authentication   +---------+
   +-------+----------+         |
           |                    |
   +-------v----------+         |
   | Entity           | fail?   |
   | Authorization    +---------&gt;
   +-------+----------+         |
           |                    |
   +-------v----------+         |
   | Claiming the     | fail?   |
   | Entity           +---------&gt;
   +-------+----------+         |
           |                    |
   +-------v----------+         |
   | Log Verification | fail?   |
   |                  +---------&gt;
   +-------+----------+         |
           |                    |
   +-------v----------+    +----v-------+
   | Forward          |    |            |
   | Audit            |    | Reject     |
   | voucher + config |    | Device     |
   | to the Entity    |    |            |
   +------------------+    +------------+

   Figure 4



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 24]</span>
</pre><pre class='newpage'><a name="page-25" id="page-25" href="#page-25" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h4"><a name="section-3.3.1">3.3.1</a>.  Pledge Authentication</span>

   The applicable authentication methods detailed in EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] are:

   o  the use of an IDevID X.509 credential during the TLS client
      authentication,

   o  or the use of a secret that is transmitted out of band between the
      Pledge and a Registrar (this use case is not autonomic).

   In order to validate the IDevID X.509 credential a Registrar
   maintains a database of vendor trust anchors (e.g. vendor root
   certificates or keyIdentifiers for vendor root public keys).  For
   user interface purposes this database can be mapped to colloquial
   vendor names.  Registrars can be shipped with the trust anchors of a
   significant number of third-party vendors within the target market.

<span class="h4"><a name="section-3.3.2">3.3.2</a>.  Pledge Authorization</span>

   In a fully automated network all devices must be securely identified
   and authorized to join the domain.

   A Registrar accepts or declines a request to join the domain, based
   on the authenticated identity presented.  Automated acceptance
   criteria include:

   o  allow any device of a specific type (as determined by the X.509
      IDevID),

   o  allow any device from a specific vendor (as determined by the
      X.509 IDevID),

   o  allow a specific device from a vendor (as determined by the X.509
      IDevID) against a domain white list.  (The mechanism for checking
      a shared white list potentially used by multiple Registrars is out
      of scope).

   To look the Pledge up in a domain white list a consistent method for
   extracting device identity from the X.509 certificate is required.
   <a href="./rfcmarkup.sh?rfc=6125">RFC6125</a> describes Domain-Based Application Service identity but here
   we require Vendor Device-Based identity.  The subject field's DN
   encoding MUST include the "serialNumber" attribute with the device's
   unique serial number.  In the language of <a href="./rfcmarkup.sh?rfc=6125">RFC6125</a> this provides for a
   SERIALNUM-ID category of identifier that can be included in a
   certificate and therefore that can also be used for matching
   purposes.  The SERIALNUM-ID whitelist is collated according to vendor
   trust anchor since serial numbers are not globally unique.




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 25]</span>
</pre><pre class='newpage'><a name="page-26" id="page-26" href="#page-26" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   Since all Pledges accept Audit Vouchers a Registrar MUST use the
   vendor provided MASA service to verify that the device's history log
   does not include unexpected Registrars.  If a device had previously
   registered with another domain, a Registrar of that domain would show
   in the log.

   If a Pledge is accepted into the domain, it is expected to request a
   domain certificate through a certificate enrollment process.  The
   result is a common trust anchor and device certificates for all
   autonomic devices in a domain (these certificates can be used for
   other methods, for example boundary detection, auto-securing
   protocols, etc.).  The authorization performed during this phase is
   used for EST enrollment requests.

<span class="h4"><a name="section-3.3.3">3.3.3</a>.  Claiming the New Entity</span>

   Claiming an entity establishes an audit log at the MASA server and
   provides a Registrar with proof, in the form of a MASA Audit Voucher,
   that the log entry has been inserted.  As indicated in <a href="#section-3.1.4">Section 3.1.4</a>
   a Pledge will only proceed with bootstrapping if a validated MASA
   Audit Voucher has been received.  The Pledge therefore enforces that
   bootstrapping only occurs if the claim has been logged.  There is no
   requirement for the vendor to definitively know that the device is
   owned by the Registrar.

   Registrar's obtain the Vendor URI via static configuration or by
   extracting it from the X.509 IDevID credential.  The imprint method
   supported by the Pledge is known from the X.509 IDevID credential.
   [[EDNOTE: An appropriate extension for indicating the Vendor URI and
   imprint method could be defined using the methods described in
   [<a href="#ref-I-D.lear-mud-framework">I-D.lear-mud-framework</a>]]].

   During initial bootstrapping the Pledge provides a nonce specific to
   the particular bootstrapping attempt.  The Registrar SHOULD include
   this nonce when claiming the Pledge from the MASA service.  Claims
   from an unauthenticated Registrar are only serviced by the MASA
   resource if a nonce is provided.

   The Registrar can claim a Pledge that is not online by forming the
   request using the entities unique identifier and not including a
   nonce in the claim request.  Audit Voucher obtained in this way do
   not have a lifetime and they provide a permanent method for the
   domain to claim the device.  Evidence of such a claim is provided in
   the audit log entries available to any future Registrar.  Such claims
   reduce the ability for future domains to secure bootstrapping and
   therefore the Registrar MUST be authenticated by the MASA service
   although no requirement is implied that the MASA associates this
   authentication with ownership.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 26]</span>
</pre><pre class='newpage'><a name="page-27" id="page-27" href="#page-27" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   An Ownership Voucher requires the vendor to definitively know that a
   device is owned by a specific domain.  The method used to "claim"
   this are out-of-scope.  A MASA ignores or reports failures when an
   attempt is made to claim a device that has a an Ownership Voucher.

<span class="h4"><a name="section-3.3.4">3.3.4</a>.  Log Verification</span>

   A Registrar requests the log information for the Pledge from the MASA
   service.  The log is verified to confirm that the following is true
   to the satisfaction of a Registrar's configured policy:

   o  Any nonceless entries in the log are associated with domainIDs
      recognized by the registrar.

   o  Any nonce'd entries are older than when the domain is known to
      have physical possession of the Pledge or that the domainIDs are
      recognized by the registrar.

   If any of these criteria are unacceptable to a Registrar the entity
   is rejected.  A Registrar MAY be configured to ignore the history of
   the device but it is RECOMMENDED that this only be configured if
   hardware assisted NEA [<a href="./rfcmarkup.sh?rfc=5209">RFC5209</a>] is supported.

   This document specifies a simple log format as provided by the MASA
   service to the registar.  This format could be improved by
   distributed consensus technologies that integrate the Audit Voucher
   with a current technologies such as block-chain or hash trees or the
   like.  Doing so is out of the scope of this document but are
   anticipated improvements for future work.

<span class="h3"><a name="section-3.4">3.4</a>.  Behavior of the MASA Service</span>

   The MASA service is provided by the Factory provider on the global
   Internet.  The URI of this service is well known.  The URI SHOULD
   also be provided as an X.509 IDevID extension (a "MASA Audit Voucher
   Distribution Point" extension).

   The MASA service provides the following functionalities to
   Registrars:

<span class="h4"><a name="section-3.4.1">3.4.1</a>.  Issue Audit Voucher and Log the event</span>

   A Registrar POSTs a claim message optionally containing the bootstrap
   nonce to the MASA server.

   If a nonce is provided the MASA service responds to all requests.
   The MASA service verifies the Registrar is representative of the
   domain and generates a privacy protected log entry before responding



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 27]</span>
</pre><pre class='newpage'><a name="page-28" id="page-28" href="#page-28" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   with the Audit Voucher.  For the simple log format defined in this
   document using the DomainID is considered sufficient privacy.  Future
   work to improve the logging mechanism could include additional
   privacy protections.

   If a nonce is not provided then the MASA service MUST authenticate
   the Registrar as a valid customer.  This prevents denial of service
   attacks.

<span class="h4"><a name="section-3.4.2">3.4.2</a>.  Retrieve Audit Entries from Log</span>

   When determining if a Pledge should be accepted into a domain the
   Registrar retrieves a copy of the audit log from the MASA service.
   This contains a list of privacy protected domain identities that have
   previously claimed the device.  Included in the list is an indication
   of the time the entry was made and if the nonce was included.

<span class="h3"><a name="section-3.5">3.5</a>.  Leveraging the new key infrastructure / next steps</span>

   As the devices have a common trust anchor, device identity can be
   securely established, making it possible to automatically deploy
   services across the domain in a secure manner.

   Examples of services:

   o  Device management.

   o  Routing authentication.

   o  Service discovery.

<span class="h4"><a name="section-3.5.1">3.5.1</a>.  Network boundaries</span>

   When a device has joined the domain, it can validate the domain
   membership of other devices.  This makes it possible to create trust
   boundaries where domain members have higher level of trusted than
   external devices.  Using the autonomic User Interface, specific
   devices can be grouped into to sub domains and specific trust levels
   can be implemented between those.

<span class="h3"><a name="section-3.6">3.6</a>.  Interactions with Network Access Control</span>

   The assumption is that Network Access Control (NAC) completes using
   the Pledge 's X.509 IDevID credentials and results in the device
   having sufficient connectivity to discovery and communicate with the
   proxy.  Any additional connectivity or quarantine behavior by the NAC
   infrastructure is out-of-scope.  After the devices has completed




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 28]</span>
</pre><pre class='newpage'><a name="page-29" id="page-29" href="#page-29" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   bootstrapping the mechanism to trigger NAC to re-authenticate the
   device and provide updated network privileges is also out-of-scope.

   This achieves the goal of a bootstrap architecture that can integrate
   with NAC but does not require NAC within the network where it wasn't
   previously required.  Future optimizations can be achieved by
   integrating the bootstrapping protocol directly into an initial EAP
   exchange.

<span class="h2"><a name="section-4">4</a>.  Domain Operator Activities</span>

   This section describes how an operator interacts with a domain that
   supports the bootstrapping as described in this document.

<span class="h3"><a name="section-4.1">4.1</a>.  Instantiating the Domain Certification Authority</span>

   This is a one time step by the domain administrator.  This is an "off
   the shelf" CA with the exception that it is designed to work as an
   integrated part of the security solution.  This precludes the use of
   3rd party certification authority services that do not provide
   support for delegation of certificate issuance decisions to a domain
   managed Registration Authority.

<span class="h3"><a name="section-4.2">4.2</a>.  Instantiating the Registrar</span>

   This is a one time step by the domain administrator.  One or more
   devices in the domain are configured take on a Registrar function.

   A device can be configured to act as a Registrar or a device can
   auto-select itself to take on this function, using a detection
   mechanism to resolve potential conflicts and setup communication with
   the Domain Certification Authority.  Automated Registrar selection is
   outside scope for this document.

<span class="h3"><a name="section-4.3">4.3</a>.  Accepting New Entities</span>

   For each Pledge the Registrar is informed of the unique identifier
   (e.g. serial number) along with the manufacturer's identifying
   information (e.g. manufacturer root certificate).  This can happen in
   different ways:

   1.  Default acceptance: In the simplest case, the new device asserts
       its unique identity to a Registrar.  The registrar accepts all
       devices without authorization checks.  This mode does not provide
       security against intruders and is not recommended.

   2.  Per device acceptance: The new device asserts its unique identity
       to a Registrar.  A non-technical human validates the identity,



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 29]</span>
</pre><pre class='newpage'><a name="page-30" id="page-30" href="#page-30" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


       for example by comparing the identity displayed by the registrar
       (for example using a smartphone app) with the identity shown on
       the packaging of the device.  Acceptance may be triggered by a
       click on a smartphone app "accept this device", or by other forms
       of pairing.  See also [<a href="#ref-I-D.behringer-homenet-trust-bootstrap">I-D.behringer-homenet-trust-bootstrap</a>] for
       how the approach could work in a homenet.

   3.  Whitelist acceptance: In larger networks, neither of the previous
       approaches is acceptable.  Default acceptance is not secure, and
       a manual per device methods do not scale.  Here, the registrar is
       provided a priori with a list of identifiers of devices that
       belong to the network.  This list can be extracted from an
       inventory database, or sales records.  If a device is detected
       that is not on the list of known devices, it can still be
       manually accepted using the per device acceptance methods.

   4.  Automated Whitelist: an automated process that builds the
       necessary whitelists and inserts them into the larger network
       domain infrastructure is plausible.  Once set up, no human
       intervention is required in this process.  Defining the exact
       mechanisms for this is out of scope although the registrar
       authorization checks is identified as the logical integration
       point of any future work in this area.

   None of these approaches require the network to have permanent
   Internet connectivity.  Even when the Internet based MASA service is
   used, it is possible to pre-fetch the required information from the
   MASA a priori, for example at time of purchase such that devices can
   enroll later.  This supports use cases where the domain network may
   be entirely isolated during device deployment.

   Additional policy can be stored for future authorization decisions.
   For example an expected deployment time window or that a certain
   Proxy must be used.

<span class="h3"><a name="section-4.4">4.4</a>.  Automatic Enrollment of Devices</span>

   The approach outlined in this document provides a secure zero-touch
   method to enroll new devices without any pre-staged configuration.
   New devices communicate with already enrolled devices of the domain,
   which proxy between the new device and a Registrar.  As a result of
   this completely automatic operation, all devices obtain a domain
   based certificate.








<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 30]</span>
</pre><pre class='newpage'><a name="page-31" id="page-31" href="#page-31" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h3"><a name="section-4.5">4.5</a>.  Secure Network Operations</span>

   The certificate installed in the previous step can be used for all
   subsequent operations.  For example, to determine the boundaries of
   the domain: If a neighbor has a certificate from the same trust
   anchor it can be assumed "inside" the same organization; if not, as
   outside.  See also <a href="#section-3.5.1">Section 3.5.1</a>.  The certificate can also be used
   to securely establish a connection between devices and central
   control functions.  Also autonomic transactions can use the domain
   certificates to authenticate and/or encrypt direct interactions
   between devices.  The usage of the domain certificates is outside
   scope for this document.

<span class="h2"><a name="section-5">5</a>.  Proxy Discovery Protocol Details</span>

   The proxy uses the GRASP M_FLOOD mechanism to announce itself.  This
   announcement is done with the same message as the ACP announcement
   detailed in [<a href="#ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>].

     proxy-objective = ["Proxy", [ O_IPv6_LOCATOR, ipv6-address,
                                   transport-proto, port-number ] ]

     ipv6-address       - the v6 LL of the proxy
     transport-proto    - 6, for TCP 17 for UDP
     port-number        - the TCP or UDP port number to find the proxy

   Figure 5

<span class="h2"><a name="section-6">6</a>.  Registrar Discovery Protocol Details</span>

   The registrar responds to discovery messages from the proxy (or GRASP
   caches between them) as follows:

   objective         = ["AN_registrar", F_DISC, 255 ]
   discovery-message = [M_DISCOVERY, session-id, initiator, objective]

   Figure 6: Registrar Discovery

   The response from the registrar (or cache) will be a M_RESPONSE with
   the following parameters:











<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 31]</span>
</pre><pre class='newpage'><a name="page-32" id="page-32" href="#page-32" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   response-message = [M_RESPONSE, session-id, initiator, ttl,
                      (+locator-option // divert-option), ?objective)]
   initiator = ACP address of Registrar
   locator1  = [O_IPv6_LOCATOR, fe80::1234, 6,  443]
   locator2  = [O_IPv6_LOCATOR, fe80::1234, 17, 5683]
   locator3  = [O_IPv6_LOCATOR, fe80::1234, 41, nil]

   Figure 7: Registrar Response

<span class="h2"><a name="section-7">7</a>.  Protocol Details</span>

   A bootstrapping protocol could be implemented as an independent
   protocol from EST, but for simplicity and to reduce the number of TLS
   connections and crypto operations required on the Pledge, it is
   described specifically as extensions to EST.  These extensions MUST
   be supported by the Registrar EST server within the same .well-known
   URI tree as the existing EST URIs as described in EST <a href="./rfcmarkup.sh?rfc=7030#section-3.2.2">[RFC7030]
   section&nbsp;3.2.2</a>.

   The Pledge establishes a TLS connection with the Registrar through
   the circuit proxy (see <a href="#section-3.2">Section 3.2</a>) but the TLS connection is with
   the Registar; so for this section the "Pledge" is the TLS client and
   the "Registrar" is the TLS server.

   Establishment of the TLS connection for bootstrapping is as specified
   for EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>].  In particular server identity and client identity
   are as described in EST <a href="./rfcmarkup.sh?rfc=7030#section-3.3">[RFC7030] section&nbsp;3.3</a>.  In EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>]
   provisional server authentication for bootstrapping is described in
   <a href="#section-4.1.1">section 4.1.1</a> wherein EST clients can "engage a human user to
   authorize the CA certificate using out-of-band data such as a CA
   certificate" or wherein a human user configures the URI of the EST
   server for Implicit TA based authentication.  As described in this
   document, <a href="#section-7.3.1">Section 7.3.1</a>, a new method of bootstrapping now provides a
   completely automating method of bootstrapping PKI.

   The extensions for the Pledge client are as follows:

   o  The Pledge provisionally accept the EST server certificate during
      the TLS handshake as detailed in <a href="#section-7.3.1">Section 7.3.1</a>.

   o  The Pledge requests and validates the Audit Voucher as described
      below.  At this point the Pledge has sufficient information to
      validate domain credentials.

   o  The Pledge calls the EST defined /cacerts method to obtain the
      current CA certificate.  These are validated using the Audit
      Voucher.




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 32]</span>
</pre><pre class='newpage'><a name="page-33" id="page-33" href="#page-33" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   o  The Pledge completes bootstrapping as detailed in EST <a href="#section-4.1.1">section</a>
      <a href="#section-4.1.1">4.1.1</a>.

   In order to obtain a validated Audit Voucher and Audit Log a
   Registrar contacts the MASA service Service using REST calls:

              +-----------+ +----------+ +-----------+ +----------+
              | New       | | Circuit  | |           | |          |
              | Entity    | | Proxy    | | Registrar | | Vendor   |
              |           | |          | |           | |          |
              ++----------+ +--+-------+ +-----+-----+ +--------+-+
               |               |               |                |
               |               |               |                |
               |   TLS hello   |  TLS hello    |                |
   Establish   +---------------C---------------&gt;                |
   TLS         |               |               |                |
   connection  |               | Server Cert   |                |
               &lt;---------------C---------------+                |
               | Client Cert   |               |                |
               +---------------C---------------&gt;                |
               |               |               |                |
   HTTP REST   | POST /requestvoucher          |                |
   Data        +--------------------nonce------&gt;                |
               |               .               | /requestvoucher|
               |               .               +----------------&gt;
               |                               &lt;----------------+
               |                               | /requestlog    |
               |                               +----------------&gt;
               |            voucher            &lt;----------------+
               &lt;-------------------------------+                |
               | (optional config information) |                |
               |               .               |                |
               |               .               |                |

   Figure 8

   In some use cases the Registrar may need to contact the Vendor in
   advanced, for example when the target network is air-gapped.  The
   nonceless request format is provided for this and the resulting flow
   is slightly different.  The security differences associated with not
   knowing the nonce are discussed below:










<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 33]</span>
</pre><pre class='newpage'><a name="page-34" id="page-34" href="#page-34" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


              +-----------+ +----------+ +-----------+ +----------+
              | New       | | Circuit  | |           | |          |
              | Entity    | | Proxy    | | Registrar | | Vendor   |
              |           | |          | |           | |          |
              ++----------+ +--+-------+ +-----+-----+ +--------+-+
               |               |               |                |
               |               |               |                |
               |               |               | /requestvoucher|
               |               |  (nonce       +----------------&gt;
               |               |  unknown)     &lt;----------------+
               |               |               | /requestlog    |
               |               |               +----------------&gt;
               |               |               &lt;----------------+
               |   TLS hello   |  TLS hello    |                |
   Establish   +---------------C---------------&gt;                |
   TLS         |               |               |                |
   connection  |               | Server Cert   |                |
               &lt;---------------C---------------+                |
               | Client Cert   |               |                |
               |               |               |                |
   HTTP REST   | POST /requestvoucher          |                |
   Data        +----------------------nonce----&gt;   (discard     |
               |            voucher            |   nonce)       |
               &lt;-------------------------------+                |
               | (optional config information) |                |
               |               .               |                |
               |               .               |                |

   Figure 9

   The extensions for a Registrar server are as follows:

   o  The Registrar requests and validates the Audit Voucher from the
      vendor authorized MASA service.

   o  The Registrar forwards the Audit Voucher to the Pledge when
      requested.

   o  The Registar performs log verifications in addition to local
      authorization checks before accepting the Pledge device.

<span class="h3"><a name="section-7.1">7.1</a>.  Request Voucher from the Registrar</span>

   When the Pledge bootstraps it makes a request for a Voucher from a
   Registrar.

   This is done with an HTTPS POST using the operation path value of
   "/requestvoucher".



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 34]</span>
</pre><pre class='newpage'><a name="page-35" id="page-35" href="#page-35" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The request format is JSON object containing a 64bit nonce generated
   by the client for each request.  This nonce MUST be a
   cryptographically strong random or pseudo-random number that can not
   be easily predicted.  The nonce MUST NOT be reused for multiple
   attempts to join a network domain.  The nonce assures the Pledge that
   the Audit Voucher response is associated with this bootstrapping
   attempt and is not a replay.

   Request media type: application/auditnonce

   Request format: a JSON file with the following:

   {
    "version":"1",
    "nonce":"&lt;64bit nonce value&gt;",
   }

   [[EDNOTE: Even if the nonce was signed it would provide no defense
   against rogue registrars; although it would assure the MASA that a
   certified Pledge exists.  To protect against rogue registrars a nonce
   component generated by the MASA (a new round trip) would be
   required).  Instead this is addressed by requiring MASA &amp; Registrar
   authentications but it is worth exploring additional protections.
   This to be explored more at IETF96.]]

   The Registrar validates the client identity as described in EST
   <a href="./rfcmarkup.sh?rfc=7030#section-3.3.2">[RFC7030] section&nbsp;3.3.2</a>.  The registrar performs authorization as
   detailed in <a href="#section-3.3.2">Section 3.3.2</a>.  If authorization is successful the
   Registrar obtains an Voucher from the MASA service (see <a href="#section-5.2">Section 5.2</a>).

   The received Voucher is forwarded to the Pledge.

   As indicated in EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] the bootstrapping server can redirect
   the client to an alternate server.  If the Pledge authenticated a
   Registrar using the well known URI method then the Pledge MUST follow
   the redirect automatically and authenticate the new Registrar against
   the redirect URI provided.  If the Pledge had not yet authenticated a
   Registrar because it was discovered and was not a known-to-be-valid
   URI then the new Registrar must be authenticated using one of the two
   autonomic methods described in this document.  Similarly the Registar
   MAY respond with an HTTP 202 ("the request has been accepted for
   processing, but the processing has not been completed") as described
   in EST <a href="./rfcmarkup.sh?rfc=7030#section-4.2.3">[RFC7030] section&nbsp;4.2.3</a>.

   Recall that during this communication with the Registar the TLS
   authentication is only provisional.  The Pledge client MUST handle
   all data from the Registrar with upmost care.  In particular the
   Pledge MUST only allow a single redirection and MUST only support a



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 35]</span>
</pre><pre class='newpage'><a name="page-36" id="page-36" href="#page-36" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   delay of five seconds before declaring the Registrar a failure and
   moving on to the next discovered Registrar.  As detailed in
   <a href="#section-3.1.1">Section 3.1.1</a> if no suitable Registrar is found the Pledge restarts
   the state machine and tries again.  So a Registrar that is unable to
   complete the transaction the first time will have future chances.

<span class="h3"><a name="section-7.2">7.2</a>.  Request Voucher from MASA</span>

   A Registrar requests a Voucher from the MASA service using a REST
   interface.  For simplicity this is defined as an optional EST message
   between a Registrar and an EST server running on the MASA service
   although the Registrar is not required to make use of any other EST
   functionality when communicating with the MASA service.  (The MASA
   service MUST properly reject any EST functionality requests it does
   not wish to service; a requirement that holds for any REST
   interface).

   This is done with an HTTP POST using the operation path value of
   "/requestvoucher".

   The request format is a JSON object optionally containing the nonce
   value (as obtained from the bootstrap request) and the X.509 IDevID
   extracted serial number (the full certificate is not needed and no
   proof-of-possession information for the device identity is included).
   The AuthorityKeyIdentifier value from the certificate is included to
   ensure a statistically unique identity.  The Pledge's serial number
   is extracted from the X.509 IDevID subject name id-at-serialNumber or
   it is the base64 encoded <a href="./rfcmarkup.sh?rfc=4108">RFC4108</a> hardwareModuleName hwSerialNum:

   {
    "version":"1",
    "nonce":"&lt;64bit nonce value&gt;",
    "IDevIDAuthorityKeyIdentifier":"&lt;base64 encoded keyIdentifier"&gt;,
    "DevIDSerialNumber":"&lt;id-at-serialNumber or base64 encoded
                          hardwareModuleName hwSerialNum&gt;",
   }

   A Registrar MAY exclude the nonce from the request.  Doing so allows
   the Registrar to request a Voucher when the Pledge is not online, or
   when the target bootstrapping environment is not on the same network
   as the MASA server (this requires the Registrar to learn the
   appropriate DevIDSerialNumber field from the physical device labeling
   or from the sales channel -- how this occurs is out-of-scope of this
   document).  If a nonce is not provided the MASA server MUST
   authenticate the client as described in EST <a href="./rfcmarkup.sh?rfc=7030#section-3.3.2">[RFC7030] section&nbsp;3.3.2</a>
   to reduce the risk of DDoS attacks.  A Registrar performs
   authorization as detailed in <a href="#section-3.3.2">Section 3.3.2</a>.  If authorization is




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 36]</span>
</pre><pre class='newpage'><a name="page-37" id="page-37" href="#page-37" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   successful the Registrar obtains an Voucher from the MASA service
   (see <a href="#section-7.2">Section 7.2</a>).

   The JSON message information is encapsulated in a [<a href="./rfcmarkup.sh?rfc=5652" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>] Signed-
   data that is signed by the Registrar.  The entire certificate chain,
   up to and including the Domain CA, MUST be included in the
   CertificateSet structure.  The MASA service checks the internal
   consistency of the CMS but does not authenticate the domain identity
   information.  The domain is not know to the MASA server in advance
   and a shared trust anchor is not implied.  The MASA server MUST
   verify that the CMS is signed by a Registrar certificate (by checking
   for the cmc-idRA field) that was issued by a the root certificate
   included in the CMS.  This ensures that the Registrar making the
   claim is an authorized Registrar of the unauthenticated domain.  The
   EST style client authentication (TLS and HTTP) is used to provide a
   DDoS prevention strategy.

   The root certificate is extracted and used to populate the Audit
   Voucher.  The domain ID (e.g. hash of the public key of the domain)
   is extracted from the root certificate and is used to update the
   audit log.

<span class="h3"><a name="section-7.3">7.3</a>.  Audit Voucher Response</span>

   The voucher response to requests from the device and requests from a
   Registrar are in the same format.  A Registrar either caches prior
   MASA responses or dynamically requests a new Voucher based on local
   policy.

   If the the join operation is successful, the server response MUST
   contain an HTTP 200 response code with a content-type of
   "application/authorizationvoucher".  The server MUST answer with a
   suitable 4xx or 5xx HTTP [<a href="./rfcmarkup.sh?rfc=2616">RFC2616</a>] error code when a problem occurs.
   The response data from the MASA server MUST be a plaintext human-
   readable error message containing explanatory information describing
   why the request was rejected.

   The Audit Voucher consists of the nonce, if supplied, the serial
   number information identifying the device and the domain CA
   certificate extracted from the request:

   {
    "version":"1",
    "nonce":"&lt;64bit nonce value&gt;",
    "IDevIDAuthorityKeyIdentifier":"&lt;base64 encoded keyIdentifier&gt;",
    "DevIDSerialNumber":"&lt;id-at-serialNumber&gt;",
    "domainCAcert":"&lt;the base64 encoded domain CA's certificate&gt;"
   }



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 37]</span>
</pre><pre class='newpage'><a name="page-38" id="page-38" href="#page-38" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The Audit Voucher response is encapsulated in a [<a href="./rfcmarkup.sh?rfc=5652" title='"Cryptographic Message Syntax (CMS)"'>RFC5652</a>] Signed-data
   that is signed by the MASA server.  The Pledge verifies this signed
   message using the manufacturer installed trust anchor associated with
   the X.509 IDevID.  [[EDNOTE: As detailed in netconf-zerotouch this
   might be a distinct trust anchor rather than re-using the trust
   anchor for the IDevID.  This concept will need to be detailed in this
   document as well.]]

   [[EDNOTE: Using CMS is consistent with the alignment of this
   bootstrapping document with EST, a PKIX enrollment protocol that
   includes Certificate Management over CMS.  An alternative format
   would be the <a href="./rfcmarkup.sh?rfc=7515">RFC7515</a> JSON Web Signature (JWS), which would allow
   clients that do not use fullCMC messages to avoid CMS entirely.  Use
   of JWS would likely include a discussion of CBOR in order ensure the
   base64 expansions of the certs and signatures within the JWS message
   are of minimal size -- it is not yet clear to this author how that
   would work out]]

   The 'domainCAcert' element of this message contains the domain CA's
   public key.  This is specific to bootstrapping a public key
   infrastructure.  To support bootstrapping other key infrastructures
   additional domain identity types might be defined in the future.
   Clients MUST be prepared to ignore additional fields they do not
   recognize.  Clients MUST be prepared to parse and fail gracefully
   from an Audit Voucher response that does not contain a 'domainCAcert'
   field at all.

   To minimize the size of the Audit Voucher response message the
   domainCAcert is not a complete distribution of the EST <a href="#section-4.1.3">section 4.1.3</a>
   CA Certificate Response.

   The Pledge installs the domainCAcert trust anchor.  As indicated in
   <a href="#section-3.1.2">Section 3.1.2</a> the newly installed trust anchor is used as an EST
   <a href="./rfcmarkup.sh?rfc=7030">RFC7030</a> Explicit Trust Anchor.  The Pledge MUST use the domainCAcert
   trust anchor to immediately validate the currently provisional TLS
   connection to a Registrar.

<span class="h4"><a name="section-7.3.1">7.3.1</a>.  Completing authentication of Provisional TLS connection</span>

   If a Registrar's credential can not be verified using the
   domainCAcert trust anchor the TLS connection is immediately discarded
   and the Pledge abandons attempts to bootstrap with this discovered
   registrar.

   The following behaviors on a Registrar and Pledge are in addition to
   normal PKIX operations:





<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 38]</span>
</pre><pre class='newpage'><a name="page-39" id="page-39" href="#page-39" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   o  The EST server MUST use a certificate that chains to the
      domainCAcert.  This means that when the EST server obtains renewed
      credentials the credentials included in the <a href="#section-7.2">Section 7.2</a> request
      match the chain used in the current provisional TLS connection.

   o  The Pledge PKIX path validation of a Registrar validity period
      information is as described in <a href="#section-3.1.5">Section 3.1.5</a>.

   Because the domainCAcert trust anchor is installed as an Explicit
   Trust Anchor it can be used to authenticate any dynamically
   discovered EST server that contain the id-kp-cmcRA extended key usage
   extension as detailed in EST <a href="./rfcmarkup.sh?rfc=7030#section-3.6.1">RFC7030 section&nbsp;3.6.1</a>; but to reduce
   system complexity the Pledge SHOULD avoid additional discovery
   operations.  Instead the Pledge SHOULD communicate directly with the
   Registrar as the EST server to complete PKI local certificate
   enrollment.  Additionally the Pledge SHOULD use the existing TLS
   connection to proceed with EST enrollment, thus reducing the total
   amount of cryptographic and round trip operations required during
   bootstrapping.  [[EDNOTE: It is reasonable to mandate that the
   existing TLS connection be re-used? e.g.  MUST &gt;&gt; SHOULD?]]

<span class="h3"><a name="section-7.4">7.4</a>.  Voucher Status Telemetry</span>

   For automated bootstrapping of devices the adminstrative elements
   providing bootstrapping also provide indications to the system
   administrators concerning device lifecycle status.  To facilitate
   this those elements need telemetry information concerning the
   device's status.

   To indicate Pledge status regarding the Audit Voucher the client
   SHOULD post a status message.

   The client HTTP POSTs the following to the server at the EST well
   known URI /voucher_status.  The Status field indicates if the Voucher
   was acceptable.  If it was not acceptable the Reason string indicates
   why.  In the failure case this message is being sent to an
   unauthenticated, potentially malicious Registrar and therefore the
   Reason string SHOULD NOT provide information beneficial to an
   attacker.  The operational benefit of this telemetry information is
   balanced against the operational costs of not recording that an
   Voucher was ignored by a client the registar expected to continue
   joining the domain.

   {
     "version":"1",
     "Status":FALSE /* TRUE=Success, FALSE=Fail"
     "Reason":"Informative human readable message"
   }



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 39]</span>
</pre><pre class='newpage'><a name="page-40" id="page-40" href="#page-40" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The server SHOULD respond with an HTTP 200 but MAY simply fail with
   an HTTP 404 error.  The client ignores any response.  Within the
   server logs the server SHOULD capture this telemetry information.

<span class="h3"><a name="section-7.5">7.5</a>.  MASA authorization log Request</span>

   A registrar requests the MASA authorization log from the MASA service
   using this EST extension.

   This is done with an HTTP GET using the operation path value of
   "/requestauditlog".

   The client HTTP POSTs the same Voucher Request as for requesting an
   audit token but now posts it to the /requestauditlog URI instead.
   The IDevIDAuthorityKeyIdentifier and DevIDSerialNumber informs the
   MASA server which log is requested so the appropriate log can be
   prepared for the response.

<span class="h3"><a name="section-7.6">7.6</a>.  MASA authorization log Response</span>

   A log data file is returned consisting of all log entries.  For
   example:

  {
    "version":"1",
    "events":[
      {
       "date":"&lt;date/time of the entry&gt;",
       "domainID":"&lt;domainID as extracted from the domain CA certificate
                    within the CMS of the audit voucher request&gt;",
       "nonce":"&lt;any nonce if supplied (or the exact string 'NULL')&gt;"
      },
      {
       "date":"&lt;date/time of the entry&gt;",
       "domainID":"&lt;domainID as extracted from the domain CA certificate
                    within the CMS of the audit voucher request&gt;",
       "nonce":"&lt;any nonce if supplied (or the exact string 'NULL')&gt;"
      }
    ]
  }

   Distribution of a large log is less than ideal.  This structure can
   be optimized as follows: All nonce-less entries for the same domainID
   MAY be condensed into the single most recent nonceless entry.

   A Registrar uses this log information to make an informed decision
   regarding the continued bootstrapping of the Pledge.  For example if
   the log includes unexpected domainIDs this is indicative of



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 40]</span>
</pre><pre class='newpage'><a name="page-41" id="page-41" href="#page-41" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   problematic imprints by the Pledge.  If the log includes nonce-less
   entries this is indicative of the permanent ability for the indicated
   domain to trigger a reset of the device and take over management of
   it.  Equipment that is purchased pre-owned can be expected to have an
   extensive history.

   Log entries containing the Domain's ID can be compared against local
   history logs in search of discrepancies.

<span class="h3"><a name="section-7.7">7.7</a>.  EST Integration for PKI bootstrapping</span>

   The prior sections describe EST extensions necessary to enable fully
   automated bootstrapping.  Although the Audit Voucher request/response
   structure members IDevIDAuthorityKeyIdentifier and DevIDSerialNumber
   are specific to PKI bootstrapping these are the only PKI specific
   aspects of the extensions and future work might replace them with
   non-PKI structures.

   The prior sections provide functionality for the Pledge to obtain a
   trust anchor representative of the Domain.  The following section
   describe using EST to obtain a locally issued PKI certificate.  The
   Pledge SHOULD leverage the discovered Registrar to proceed with
   certificate enrollment and, if they do, MUST implement the EST
   options described in this section.  The Pledge MAY perform
   alternative enrollment methods including discovering an alternate EST
   server, or proceed to use its IDevID credential indefinitely.

<span class="h4"><a name="section-7.7.1">7.7.1</a>.  EST Distribution of CA Certificates</span>

   The Pledge MUST request the full EST Distribution of CA Certificates
   message.  See <a href="./rfcmarkup.sh?rfc=7030#section-4.1">RFC7030, section&nbsp;4.1</a>.

   This ensures that the Pledge has the complete set of current CA
   certificates beyond the domainCAcert (see <a href="#section-7.3">Section 7.3</a> for a
   discussion of the limitations).  Although these restrictions are
   acceptable for a Registrar integrated with initial bootstrapping they
   are not appropriate for ongoing PKIX end entity certificate
   validation.

<span class="h4"><a name="section-7.7.2">7.7.2</a>.  EST CSR Attributes</span>

   Automated bootstrapping occurs without local administrative
   configuration of the Pledge.  In some deployments its plausible that
   the Pledge generates a certificate request containing only identity
   information known to the Pledge (essentially the IDevID information)
   and ultimately receives a certificate containing domain specific
   identity information.  Conceptually the CA has complete control over
   all fields issued in the end entity certificate.  Realistically this



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 41]</span>
</pre><pre class='newpage'><a name="page-42" id="page-42" href="#page-42" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   is operationally difficult with the current status of PKI certificate
   authority deployments where the CSR is submitted to the CA via a
   number of non-standard protocols.

   To alleviate operational difficulty the Pledge MUST request the EST
   "CSR Attributes" from the EST server.  This allows the local
   infrastructure to inform the Pledge of the proper fields to include
   in the generated CSR.

   [[EDNOTE: The following is specific to anima purposes and should be
   moved to an appropriate anima document so as to keep bootstrapping as
   generic as possible: What we want are a 'domain name' stored in [TBD]
   and an 'ACP IPv6 address' stored in the iPAddress field as specified
   in <a href="./rfcmarkup.sh?rfc=5208">RFC5208</a> s4.2.1.6. ref ACP draft where certificate verification
   [TBD].  These should go into the subjectaltname in the [TBD]
   fields.]].  If the hardwareModuleName in the IDevID is populated then
   it SHOULD by default be propagated to the LDevID along with the
   hwSerialNum.  The registar SHOULD support local policy concerning
   this functionality.  [[EDNOTE: extensive use of EST CSR Attributes
   might need an new OID definition]].]]

   The Registar MUST also confirm the resulting CSR is formatted as
   indicated before forwarding the request to a CA.  If the Registar is
   communicating with the CA using a protocol like full CMC which
   provides mechanisms to override the CSR attributes, then these
   mechanisms MAY be used even if the client ignores CSR Attribute
   guidance.

<span class="h4"><a name="section-7.7.3">7.7.3</a>.  EST Client Certificate Request</span>

   The Pledge MUST request a new client certificate.  See <a href="./rfcmarkup.sh?rfc=7030#section-4.2">RFC7030,
   section&nbsp;4.2</a>.

<span class="h4"><a name="section-7.7.4">7.7.4</a>.  Enrollment Status Telemetry</span>

   For automated bootstrapping of devices the adminstrative elements
   providing bootstrapping also provide indications to the system
   administrators concerning device lifecycle status.  This might
   include information concerning attempted bootstrapping messages seen
   by the client, MASA provides logs and status of credential
   enrollment.  The EST protocol assumes an end user and therefore does
   not include a final success indication back to the server.  This is
   insufficient for automated use cases.

   To indicate successful enrollment the client SHOULD re-negotiate the
   EST TLS session using the newly obtained credentials.  This occurs by
   the client initiating a new TLS ClientHello message on the existing




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 42]</span>
</pre><pre class='newpage'><a name="page-43" id="page-43" href="#page-43" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   TLS connection.  The client MAY simply close the old TLS session and
   start a new one.  The server MUST support either model.

   In the case of a FAIL the Reason string indicates why the most recent
   enrollment failed.  The SubjectKeyIdentifier field MUST be included
   if the enrollment attempt was for a keypair that is locally known to
   the client.  If EST /serverkeygen was used and failed then the field
   is ommited from the status telemetry.

   In the case of a SUCCESS the Reason string is ommitted.  The
   SubjectKeyIdentifier is included so that the server can record the
   successful certificate distribution.

   The client HTTP POSTs the following to the server at the new EST well
   known URI /enrollstatus.

  {
    "version":"1",
    "Status":TRUE /* TRUE=Success, FALSE=Fail"
    "Reason":"Informative human readable message"
    "SubjectKeyIdentifier":"&lt;base64 encoded subjectkeyidentifier for the
                             enrollment that failed&gt;"
  }

   The server SHOULD respond with an HTTP 200 but MAY simply fail with
   an HTTP 404 error.

   Within the server logs the server MUST capture if this message was
   recieved over an TLS session with a matching client certificate.
   This allows for clients that wish to minimize their crypto operations
   to simply POST this response without renegotiating the TLS session -
   at the cost of the server not being able to accurately verify that
   enrollment was truly successful.

<span class="h4"><a name="section-7.7.5">7.7.5</a>.  EST over CoAP</span>

   [[EDNOTE: In order to support smaller devices the above section on
   Proxy behavior introduces mandatory to implement support for CoAP
   support by the Proxy.  This implies similar support by the Pledge and
   Registrar and means that the EST protocol operation encapsulation
   into CoAP needs to be described.  EST is HTTP based and "CoaP is
   designed to easily interface with HTTP for integration" [<a href="./rfcmarkup.sh?rfc=7252">RFC7252</a>].
   Use of CoAP implies Datagram TLS (DTLS) wherever this document
   describes TLS handshake specifics.  A complexity is that the large
   message sizes necessary for bootstrapping will require support for
   [<a href="./rfcmarkup.sh?draft=draft-ietf-core-block">draft-ietf-core-block</a>].]]





<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 43]</span>
</pre><pre class='newpage'><a name="page-44" id="page-44" href="#page-44" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h2"><a name="section-8">8</a>.  Reduced security operational modes</span>

   A common requirement of bootstrapping is to support less secure
   operational modes for support specific use cases.  The following
   sections detail specific ways that the Pledge, Registrar and MASA can
   be configured to run in a less secure mode for the indicated reasons.

<span class="h3"><a name="section-8.1">8.1</a>.  Trust Model</span>

   +--------+         +---------+    +------------+     +------------+
   | New    |         | Circuit |    | Domain     |     | Vendor     |
   | Entity |         | Proxy   |    | Registrar  |     | Service    |
   |        |         |         |    |            |     | (Internet  |
   +--------+         +---------+    +------------+     +------------+

   Figure 10

   Pledge:  The Pledge could be compromised and providing an attack
      vector for malware.  The entity is trusted to only imprint using
      secure methods described in this document.  Additional endpoint
      assessment techniques are RECOMMENDED but are out-of-scope of this
      document.

   Proxy:  Provides proxy functionalities but is not involved in
      security considerations.

   Registrar:  When interacting with a MASA server a Registrar makes all
      decisions.  When Ownership Vouchers are involved a Registrar is
      only a conduit and all security decisions are made on the vendor
      service.

   Vendor Service, MASA:  This form of vendor service is trusted to
      accurately log all claim attempts and to provide authoritative log
      information to Registrars.  The MASA does not know which devices
      are associated with which domains.  These claims could be
      strengthened by using cryptographic log techniques to provide
      append only, cryptographic assured, publicly auditable logs.
      Current text provides only for a trusted vendor.

   Vendor Service, Ownership Validation:  This form of vendor service is
      trusted to accurately know which device is owned by which domain.

<span class="h3"><a name="section-8.2">8.2</a>.  New Entity security reductions</span>

   The Pledge MAY support "trust on first use" on physical interfaces
   but MUST NOT support "trust on first use" on network interfaces.
   This is because "trust on first use" permanently degrades the
   security for all other use cases.



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 44]</span>
</pre><pre class='newpage'><a name="page-45" id="page-45" href="#page-45" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The Pledge MAY have an operational mode where it skips Voucher
   validation one time.  For example if a physical button is depressed
   during the bootstrapping operation.  This can be useful if the vendor
   service is unavailable.  This behavior SHOULD be available via local
   configuration or physical presence methods to ensure new entities can
   always be deployed even when autonomic methods fail.  This allows for
   unsecured imprint.

   It is RECOMMENDED that this only be available if hardware assisted
   NEA [<a href="./rfcmarkup.sh?rfc=5209">RFC5209</a>] is supported.

<span class="h3"><a name="section-8.3">8.3</a>.  Registrar security reductions</span>

   A Registrar can choose to accept devices using less secure methods.
   These methods are acceptable when low security models are needed, as
   the security decisions are being made by the local administrator, but
   they MUST NOT be the default behavior:

   1.  A registrar MAY choose to accept all devices, or all devices of a
       particular type, at the administrator's discretion.  This could
       occur when informing all Registrars of unique identifiers of new
       entities might be operationally difficult.

   2.  A registrar MAY choose to accept devices that claim a unique
       identity without the benefit of authenticating that claimed
       identity.  This could occur when the Pledge does not include an
       X.509 IDevID factory installed credential.  New Entities without
       an IDevID credential MAY form the <a href="#section-7.1">Section 7.1</a> request using the
       <a href="#section-7.2">Section 7.2</a> format to ensure the Pledge's serial number
       information is provided to the Registar (this includes the
       IDevIDAuthorityKeyIdentifier value which would be statically
       configured on the Pledge).  The Pledge MAY refused to provide a
       TLS client certificate (as one is not available).  The Pledge
       SHOULD support HTTP-based or certificate-less TLS authentication
       as described in EST <a href="./rfcmarkup.sh?rfc=7030#section-3.3.2">RFC7030 section&nbsp;3.3.2</a>.  A Registrar MUST NOT
       accept unauthenticated New Entities unless it has been configured
       to do so by an administrator that has verified that only expected
       new entities can communicate with a Registrar (presumably via a
       physically secured perimeter).

   3.  A Registrar MAY request nonce-less Audit Vouchers from the MASA
       service (by not including a nonce in the request).  These Audit
       Vouchers can then be transmitted to the Registrar and stored
       until they are needed during bootstrapping operations.  This is
       for use cases where target network is protected by an air gap and
       therefore can not contact the MASA service during Pledge
       deployment.




<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 45]</span>
</pre><pre class='newpage'><a name="page-46" id="page-46" href="#page-46" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   4.  A registrar MAY ignore unrecognized nonce-less Audit Log entries.
       This could occur when used equipment is purchased with a valid
       history being deployed in air gap networks that required
       permanent Audit Vouchers.

   These modes are not available for devices that require a vendor
   Ownership Voucher.  The methods vendors use to determine which
   devices are owned by which domains is out-of-scope.

<span class="h3"><a name="section-8.4">8.4</a>.  MASA security reductions</span>

   Lower security modes chosen by the MASA service effect all device
   deployments unless bound to the specific device identities.  In which
   case these modes can be provided as additional features for specific
   customers.  The MASA service can choose to run in less secure modes
   by:

   1.  Not enforcing that a Nonce is in the Audit Voucher.  This results
       in distribution of Audit Voucher that never expire and in effect
       makes the Domain an always trusted entity to the Pledge during
       any subsequent bootstrapping attempts.  That this occurred is
       captured in the log information so that the Domain registrar can
       make appropriate security decisions when a Pledge joins the
       Domain.  This is useful to support use cases where Registrars
       might not be online during actual device deployment.  Because
       this results in long lived Audit Voucher and do not require the
       proof that the device is online this is only accepted when the
       Registrar is authenticated by the MASA server and authorized to
       provide this functionality.  The MASA server is RECOMMENDED to
       use this functionality only in concert with Ownership Validation
       tracking.

   2.  Not verifying ownership before responding with an Audit Voucher.
       This is expected to be a common operational model because doing
       so relieves the vendor providing MASA services from having to
       tracking ownership during shipping and supply chain and allows
       for a very low overhead MASA service.  A Registrar uses the audit
       log information as a defense in depth strategy to ensure that
       this does not occur unexpectedly (for example when purchasing new
       equipment the Registrar would throw an error if any audit log
       information is reported).

<span class="h2"><a name="section-9">9</a>.  Security Considerations</span>








<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 46]</span>
</pre><pre class='newpage'><a name="page-47" id="page-47" href="#page-47" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h3"><a name="section-9.1">9.1</a>.  Pledge Privacy Considerations</span>

   This section discusses disclosures that a pledge may make that will
   make it easier for a third party to track the identity of the pledge.

<span class="h3"><a name="section-9.2">9.2</a>.  Network Privacy Considerations</span>

   This section discusses disclosures that a network may make to an
   active attacker through the bootstrap process.

<span class="h2"><a name="section-10">10</a>.  Security Considerations</span>

   In order to support a wide variety of use cases, devices can be
   claimed by a registrar without proving possession of the device in
   question.  This would result in a nonceless, and thus always valid,
   claim.  Or would result in an invalid nonce being associated with a
   claim.  The MASA service is required to authenticate such Registrars
   but no programmatic method is provided to ensure good behavior by the
   MASA service.  Nonceless entries into the audit log therefore
   permanently reduce the value of a device because future Registrars,
   during future bootstrap attempts, would now have to be configured
   with policy to ignore previously (and potentially unknown) domains.

   Future registrars are recommended to take the audit history of a
   device into account when deciding to join such devices into their
   network.  If the MASA server were to have allowed a significantly
   large number of claims this might become onerous to the MASA server
   which must maintain all the extra log entries.  Ensuring a Registrar
   is representative of a valid customer domain even without validating
   ownership helps to mitigate this.

   It is possible for an attacker to send an authorization request to
   the MASA service directly after the real Registrar obtains an
   authorization log.  If the attacker could also force the
   bootstrapping protocol to reset there is a theoretical opportunity
   for the attacker to use the Audit Voucher to take control of the
   Pledge but then proceed to enroll with the target domain.  Possible
   prevention mechanisms include:

   o  Per device rate limits on the MASA service ensure such timing
      attacks are difficult.

   o  In the advent of an unexpectedly lost bootstrapping connection the
      Registrar repeats the request for audit log information.

   To facilitate logging and administrative oversight the Pledge reports
   on Audit Voucher parsing status to the Registrar.  In the case of a
   failure this information is informative to a potentially malicious



<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 47]</span>
</pre><pre class='newpage'><a name="page-48" id="page-48" href="#page-48" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   Registar but this is RECOMMENDED anyway because of the operational
   benefits of an informed administrator in cases where the failure is
   indicative of a problem.

   As indicated in EST [<a href="./rfcmarkup.sh?rfc=7030" title='"Enrollment over Secure Transport"'>RFC7030</a>] the connection is provisional and
   untrusted until the server is successfully authorized.  If the server
   provides a redirect response the client MUST follow the redirect but
   the connection remains provisional.  If the client uses a well known
   URI for contacting a well known Registrar the EST Implicit Trust
   Anchor database is used as is described in <a href="./rfcmarkup.sh?rfc=6125">RFC6125</a> to authenticate
   the well known URI.  In this case the connection is not provisional
   and <a href="./rfcmarkup.sh?rfc=6125">RFC6125</a> methods can be used for each subsequent redirection.

   To facilitate truely limited clients EST <a href="./rfcmarkup.sh?rfc=7030#section-3.3.2">RFC7030 section&nbsp;3.3.2</a>
   requirements that the client MUST support a client authentication
   model have been reduced in <a href="#section-8">Section 8</a> to a statement that clients only
   "SHOULD" support such a model.  This reflects current (not great)
   practices but is NOT RECOMMENDED.

   The MASA service could lock a claim and refuse to issue a new voucher
   or the MASA service could go offline (for example if a vendor went
   out of business).  This functionality provides benefits such as theft
   resistance, but it also implies an operational risk to the Domain
   that Vendor behavior could limit future bootstrapping of the device
   by the Domain.  This can be mitigated by Registrars that request
   nonce-less Audit Vouchers.

<span class="h3"><a name="section-10.1">10.1</a>.  Security concerns with discovery process</span>

<span class="h4"><a name="section-10.1.1">10.1.1</a>.  Discovery of Registrar by Proxy</span>

   As described in section <a href="#section-3.2">Section 3.2</a>, the RECOMMENDED mechanism is for
   the proxy to discover the address of the registrar via GRASP
   [<a href="#ref-I-D.ietf-anima-grasp">I-D.ietf-anima-grasp</a>]

   GRASP is intended to run over a secured, and private Autonomic
   Control Plan [<a href="#ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>].  This
   discovery is between the already registered Registrar, and the
   already registered Proxy.  There are no GRASP security issues with
   this part, as both entities will have already joined the secured ACP.

<span class="h4"><a name="section-10.1.2">10.1.2</a>.  Discovery of Proxy by New Entity</span>

   [[EDNOTE: To be discussed]]







<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 48]</span>
</pre><pre class='newpage'><a name="page-49" id="page-49" href="#page-49" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h2"><a name="section-11">11</a>.  Acknowledgements</span>

   We would like to thank the various reviewers for their input, in
   particular Brian Carpenter, Toerless Eckert, Fuyu Eleven, Eliot Lear,
   Sergey Kasatkin, Markus Stenberg, and Peter van der Stok

<span class="h2"><a name="section-12">12</a>.  References</span>

<span class="h3"><a name="section-12.1">12.1</a>.  Normative References</span>

   [<a name="ref-I-D.ietf-anima-autonomic-control-plane" id="ref-I-D.ietf-anima-autonomic-control-plane">I-D.ietf-anima-autonomic-control-plane</a>]
              Behringer, M., Eckert, T., and S. Bjarnason, "An Autonomic
              Control Plane", <a href="./rfcmarkup.sh?draft=draft-ietf-anima-autonomic-control-plane-05">draft-ietf-anima-autonomic-control-</a>
              <a href="./rfcmarkup.sh?draft=draft-ietf-anima-autonomic-control-plane-05">plane-05</a> (work in progress), January 2017.

   [<a name="ref-I-D.ietf-anima-voucher" id="ref-I-D.ietf-anima-voucher">I-D.ietf-anima-voucher</a>]
              Watsen, K., Richardson, M., Pritikin, M., and T. Eckert,
              "Voucher and Voucher Revocation Profiles for Bootstrapping
              Protocols", <a href="./rfcmarkup.sh?draft=draft-ietf-anima-voucher-00">draft-ietf-anima-voucher-00</a> (work in
              progress), January 2017.

   [<a name="ref-IDevID" id="ref-IDevID">IDevID</a>]   IEEE Standard, , "IEEE 802.1AR Secure Device Identifier",
              December 2009, &lt;<a href="http://standards.ieee.org/findstds/standard/802.1AR-2009.html">http://standards.ieee.org/findstds/</a>
              <a href="http://standards.ieee.org/findstds/standard/802.1AR-2009.html">standard/802.1AR-2009.html</a>&gt;.

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="./rfcmarkup.sh?bcp=14">BCP 14</a>, <a href="./rfcmarkup.sh?rfc=2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a name="ref-RFC3542" id="ref-RFC3542">RFC3542</a>]  Stevens, W., Thomas, M., Nordmark, E., and T. Jinmei,
              "Advanced Sockets Application Program Interface (API) for
              IPv6", <a href="./rfcmarkup.sh?rfc=3542">RFC 3542</a>, DOI 10.17487/RFC3542, May 2003,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3542">http://www.rfc-editor.org/info/rfc3542</a>&gt;.

   [<a name="ref-RFC3927" id="ref-RFC3927">RFC3927</a>]  Cheshire, S., Aboba, B., and E. Guttman, "Dynamic
              Configuration of IPv4 Link-Local Addresses", <a href="./rfcmarkup.sh?rfc=3927">RFC 3927</a>,
              DOI 10.17487/RFC3927, May 2005,
              &lt;<a href="http://www.rfc-editor.org/info/rfc3927">http://www.rfc-editor.org/info/rfc3927</a>&gt;.

   [<a name="ref-RFC4862" id="ref-RFC4862">RFC4862</a>]  Thomson, S., Narten, T., and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", <a href="./rfcmarkup.sh?rfc=4862">RFC 4862</a>,
              DOI 10.17487/RFC4862, September 2007,
              &lt;<a href="http://www.rfc-editor.org/info/rfc4862">http://www.rfc-editor.org/info/rfc4862</a>&gt;.







<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 49]</span>
</pre><pre class='newpage'><a name="page-50" id="page-50" href="#page-50" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   [<a name="ref-RFC5280" id="ref-RFC5280">RFC5280</a>]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", <a href="./rfcmarkup.sh?rfc=5280">RFC 5280</a>, DOI 10.17487/RFC5280, May 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5280">http://www.rfc-editor.org/info/rfc5280</a>&gt;.

   [<a name="ref-RFC5386" id="ref-RFC5386">RFC5386</a>]  Williams, N. and M. Richardson, "Better-Than-Nothing
              Security: An Unauthenticated Mode of IPsec", <a href="./rfcmarkup.sh?rfc=5386">RFC 5386</a>,
              DOI 10.17487/RFC5386, November 2008,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5386">http://www.rfc-editor.org/info/rfc5386</a>&gt;.

   [<a name="ref-RFC5652" id="ref-RFC5652">RFC5652</a>]  Housley, R., "Cryptographic Message Syntax (CMS)", STD 70,
              <a href="./rfcmarkup.sh?rfc=5652">RFC 5652</a>, DOI 10.17487/RFC5652, September 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5652">http://www.rfc-editor.org/info/rfc5652</a>&gt;.

   [<a name="ref-RFC5660" id="ref-RFC5660">RFC5660</a>]  Williams, N., "IPsec Channels: Connection Latching",
              <a href="./rfcmarkup.sh?rfc=5660">RFC 5660</a>, DOI 10.17487/RFC5660, October 2009,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5660">http://www.rfc-editor.org/info/rfc5660</a>&gt;.

   [<a name="ref-RFC6762" id="ref-RFC6762">RFC6762</a>]  Cheshire, S. and M. Krochmal, "Multicast DNS", <a href="./rfcmarkup.sh?rfc=6762">RFC 6762</a>,
              DOI 10.17487/RFC6762, February 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6762">http://www.rfc-editor.org/info/rfc6762</a>&gt;.

   [<a name="ref-RFC6763" id="ref-RFC6763">RFC6763</a>]  Cheshire, S. and M. Krochmal, "DNS-Based Service
              Discovery", <a href="./rfcmarkup.sh?rfc=6763">RFC 6763</a>, DOI 10.17487/RFC6763, February 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6763">http://www.rfc-editor.org/info/rfc6763</a>&gt;.

   [<a name="ref-RFC7030" id="ref-RFC7030">RFC7030</a>]  Pritikin, M., Ed., Yee, P., Ed., and D. Harkins, Ed.,
              "Enrollment over Secure Transport", <a href="./rfcmarkup.sh?rfc=7030">RFC 7030</a>,
              DOI 10.17487/RFC7030, October 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7030">http://www.rfc-editor.org/info/rfc7030</a>&gt;.

   [<a name="ref-RFC7228" id="ref-RFC7228">RFC7228</a>]  Bormann, C., Ersue, M., and A. Keranen, "Terminology for
              Constrained-Node Networks", <a href="./rfcmarkup.sh?rfc=7228">RFC 7228</a>,
              DOI 10.17487/RFC7228, May 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7228">http://www.rfc-editor.org/info/rfc7228</a>&gt;.

<span class="h3"><a name="section-12.2">12.2</a>.  Informative References</span>

   [<a name="ref-I-D.behringer-homenet-trust-bootstrap" id="ref-I-D.behringer-homenet-trust-bootstrap">I-D.behringer-homenet-trust-bootstrap</a>]
              Behringer, M., Pritikin, M., and S. Bjarnason,
              "Bootstrapping Trust on a Homenet", <a href="./rfcmarkup.sh?draft=draft-behringer-homenet-trust-bootstrap-02">draft-behringer-</a>
              <a href="./rfcmarkup.sh?draft=draft-behringer-homenet-trust-bootstrap-02">homenet-trust-bootstrap-02</a> (work in progress), February
              2014.







<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 50]</span>
</pre><pre class='newpage'><a name="page-51" id="page-51" href="#page-51" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   [<a name="ref-I-D.ietf-anima-grasp" id="ref-I-D.ietf-anima-grasp">I-D.ietf-anima-grasp</a>]
              Bormann, C., Carpenter, B., and B. Liu, "A Generic
              Autonomic Signaling Protocol (GRASP)", <a href="./rfcmarkup.sh?draft=draft-ietf-anima-grasp-09">draft-ietf-anima-</a>
              <a href="./rfcmarkup.sh?draft=draft-ietf-anima-grasp-09">grasp-09</a> (work in progress), December 2016.

   [<a name="ref-I-D.ietf-netconf-zerotouch" id="ref-I-D.ietf-netconf-zerotouch">I-D.ietf-netconf-zerotouch</a>]
              Watsen, K. and M. Abrahamsson, "Zero Touch Provisioning
              for NETCONF or RESTCONF based Management", <a href="./rfcmarkup.sh?draft=draft-ietf-netconf-zerotouch-12">draft-ietf-</a>
              <a href="./rfcmarkup.sh?draft=draft-ietf-netconf-zerotouch-12">netconf-zerotouch-12</a> (work in progress), January 2017.

   [<a name="ref-I-D.lear-mud-framework" id="ref-I-D.lear-mud-framework">I-D.lear-mud-framework</a>]
              Lear, E., "Manufacturer Usage Description Framework",
              <a href="./rfcmarkup.sh?draft=draft-lear-mud-framework-00">draft-lear-mud-framework-00</a> (work in progress), January
              2016.

   [<a name="ref-I-D.richardson-anima-state-for-joinrouter" id="ref-I-D.richardson-anima-state-for-joinrouter">I-D.richardson-anima-state-for-joinrouter</a>]
              Richardson, M., "Considerations for stateful vs stateless
              join router in ANIMA bootstrap", <a href="./rfcmarkup.sh?draft=draft-richardson-anima-state-for-joinrouter-01">draft-richardson-anima-</a>
              <a href="./rfcmarkup.sh?draft=draft-richardson-anima-state-for-joinrouter-01">state-for-joinrouter-01</a> (work in progress), July 2016.

   [<a name="ref-imprinting" id="ref-imprinting">imprinting</a>]
              Wikipedia, , "Wikipedia article: Imprinting", July 2015,
              &lt;<a href="https://en.wikipedia">https://en.wikipedia</a>.org/wiki/Imprinting_(psychology)&gt;.

   [<a name="ref-RFC7217" id="ref-RFC7217">RFC7217</a>]  Gont, F., "A Method for Generating Semantically Opaque
              Interface Identifiers with IPv6 Stateless Address
              Autoconfiguration (SLAAC)", <a href="./rfcmarkup.sh?rfc=7217">RFC 7217</a>,
              DOI 10.17487/RFC7217, April 2014,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7217">http://www.rfc-editor.org/info/rfc7217</a>&gt;.

   [<a name="ref-RFC7435" id="ref-RFC7435">RFC7435</a>]  Dukhovni, V., "Opportunistic Security: Some Protection
              Most of the Time", <a href="./rfcmarkup.sh?rfc=7435">RFC 7435</a>, DOI 10.17487/RFC7435,
              December 2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7435">http://www.rfc-editor.org/info/rfc7435</a>&gt;.

   [<a name="ref-RFC7575" id="ref-RFC7575">RFC7575</a>]  Behringer, M., Pritikin, M., Bjarnason, S., Clemm, A.,
              Carpenter, B., Jiang, S., and L. Ciavaglia, "Autonomic
              Networking: Definitions and Design Goals", <a href="./rfcmarkup.sh?rfc=7575">RFC 7575</a>,
              DOI 10.17487/RFC7575, June 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7575">http://www.rfc-editor.org/info/rfc7575</a>&gt;.

   [<a name="ref-Stajano99theresurrecting" id="ref-Stajano99theresurrecting">Stajano99theresurrecting</a>]
              Stajano, F. and R. Anderson, "The resurrecting duckling:
              security issues for ad-hoc wireless networks", 1999,
              &lt;<a href="https://www.cl.cam.ac.uk/~fms27/papers/1999-StajanoAnd-duckling.pdf">https://www.cl.cam.ac.uk/~fms27/papers/1999-StajanoAnd-</a>
              <a href="https://www.cl.cam.ac.uk/~fms27/papers/1999-StajanoAnd-duckling.pdf">duckling.pdf</a>&gt;.






<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 51]</span>
</pre><pre class='newpage'><a name="page-52" id="page-52" href="#page-52" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


<span class="h2"><a name="appendix-A">Appendix A</a>.  IPv4 operations</span>

<span class="h1"><a name="appendix-A.1">A.1</a>.  IPv4 Link Local addresses</span>

   Instead of an IPv6 link-local address, an IPv4 address may be
   generated using [<a href="./rfcmarkup.sh?rfc=3927" title='"Dynamic Configuration of IPv4 Link-Local Addresses"'>RFC3927</a>]  Dynamic Configuration of IPv4 Link-Local
   Addresses.

   In the case that an IPv4 Local-Local address is formed, then the
   bootstrap process would continue as in the IPv6 case by looking for a
   (circuit) proxy.

<span class="h1"><a name="appendix-A.2">A.2</a>.  Use of DHCPv4</span>

   The Plege MAY obtain an IP address via DHCP [<a href="./rfcmarkup.sh?rfc=2131">RFC2131</a>].  The DHCP
   provided parameters for the Domain Name System can be used to perform
   DNS operations if all local discovery attempts fail.

<span class="h2"><a name="appendix-B">Appendix B</a>.  mDNS / DNSSD proxy discovery options</span>

   The Pledge MAY perform DNS-based Service Discovery [<a href="./rfcmarkup.sh?rfc=6763" title='"DNS-Based Service Discovery"'>RFC6763</a>] over
   Multicast DNS [<a href="./rfcmarkup.sh?rfc=6762" title='"Multicast DNS"'>RFC6762</a>] searching for the service
   "_bootstrapks._tcp.local.".

   To prevent unaccceptable levels of network traffic the congestion
   avoidance mechanisms specified in <a href="./rfcmarkup.sh?rfc=6762#section-7">[RFC6762] section&nbsp;7</a> MUST be
   followed.  The Pledge SHOULD listen for an unsolicited broadcast
   response as described in [<a href="./rfcmarkup.sh?rfc=6762" title='"Multicast DNS"'>RFC6762</a>].  This allows devices to avoid
   announcing their presence via mDNS broadcasts and instead silently
   join a network by watching for periodic unsolicited broadcast
   responses.

   Performs DNS-based Service Discovery [<a href="./rfcmarkup.sh?rfc=6763" title='"DNS-Based Service Discovery"'>RFC6763</a>] over normal DNS
   operations.  The service searched for is
   "_bootstrapks._tcp.example.com".  In this case the domain
   "example.com" is discovered as described in <a href="./rfcmarkup.sh?rfc=6763#section-11">[RFC6763] section&nbsp;11</a>.
   This method is only available if the host has received a useable IPv4
   address via DHCPv4 as suggested in <a href="#appendix-A">Appendix A</a>.

   If no local bootstrapks service is located using the GRASP
   mechanisms, or the above mentioned DNS-based Service Discovery
   methods the Pledge MAY contact a well known vendor provided
   bootstrapping server by performing a DNS lookup using a well known
   URI such as "bootstrapks.vendor-example.com".  The details of the URI
   are vendor specific.  Vendors that leverage this method on the Pledge
   are responsible for providing the bootstrapks service.





<span class="grey">Pritikin, et al.         Expires August 7, 2017                [Page 52]</span>
</pre><pre class='newpage'><a name="page-53" id="page-53" href="#page-53" class="invisible"> </a>
<span class="grey">Internet-Draft                    BRSKI                    February 2017</span>


   The current DNS services returned during each query is maintained
   until bootstrapping is completed.  If bootstrapping fails and the
   Pledge returns to the Discovery state it picks up where it left off
   and continues attempting bootstrapping.  For example if the first
   Multicast DNS _bootstrapks._tcp.local response doesn't work then the
   second and third responses are tried.  If these fail the Pledge moves
   on to normal DNS-based Service Discovery.

Authors' Addresses

   Max Pritikin
   Cisco

   Email: pritikin@cisco.com


   Michael C. Richardson
   Sandelman Software Works

   Email: mcr+ietf@sandelman.ca
   URI:   <a href="http://www.sandelman.ca/">http://www.sandelman.ca/</a>


   Michael H. Behringer
   Cisco

   Email: mbehring@cisco.com


   Steinthor Bjarnason
   Cisco

   Email: sbjarnas@cisco.com


   Kent Watsen
   Juniper Networks

   Email: kwatsen@juniper.net












Pritikin, et al.         Expires August 7, 2017                [Page 53]

</pre><br />
<span class="noprint"><small><small>Html markup produced by rfcmarkup 1.96, available from
<a href="http://tools.ietf.org/tools/rfcmarkup/">http://tools.ietf.org/tools/rfcmarkup/</a>
</small></small></span>
</body></html>
