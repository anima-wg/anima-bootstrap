<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Bootstrapping Remote Secure Key Infrastructures (BRSKI)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Prior Bootstrapping Approaches">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Scope of solution">
<link href="#rfc.section.1.3.1" rel="Chapter" title="1.3.1 Support environment">
<link href="#rfc.section.1.3.2" rel="Chapter" title="1.3.2 Constrained environments">
<link href="#rfc.section.1.3.3" rel="Chapter" title="1.3.3 Network Access Controls">
<link href="#rfc.section.1.3.4" rel="Chapter" title="1.3.4 Bootstrapping is not Booting">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 Leveraging the new key infrastructure / next steps">
<link href="#rfc.section.1.5" rel="Chapter" title="1.5 Requirements for Autonomic Network Infrastructure (ANI) devices">
<link href="#rfc.section.2" rel="Chapter" title="2 Architectural Overview">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Behavior of a Pledge">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Secure Imprinting using Vouchers">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Initial Device Identifier">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Identification of the Pledge">
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 MASA URI extension">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Protocol Flow">
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Architectural Components">
<link href="#rfc.section.2.5.1" rel="Chapter" title="2.5.1 Pledge">
<link href="#rfc.section.2.5.2" rel="Chapter" title="2.5.2 Join Proxy">
<link href="#rfc.section.2.5.3" rel="Chapter" title="2.5.3 Domain Registrar">
<link href="#rfc.section.2.5.4" rel="Chapter" title="2.5.4 Manufacturer Service">
<link href="#rfc.section.2.5.5" rel="Chapter" title="2.5.5 Public Key Infrastructure (PKI)">
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 Certificate Time Validation">
<link href="#rfc.section.2.6.1" rel="Chapter" title="2.6.1 Lack of realtime clock">
<link href="#rfc.section.2.6.2" rel="Chapter" title="2.6.2 Infinite Lifetime of IDevID">
<link href="#rfc.section.2.7" rel="Chapter" title="2.7 Cloud Registrar">
<link href="#rfc.section.2.8" rel="Chapter" title="2.8 Determining the MASA to contact">
<link href="#rfc.section.3" rel="Chapter" title="3 Voucher-Request artifact">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Nonceless Voucher Requests">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Tree Diagram">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Examples">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 YANG Module">
<link href="#rfc.section.4" rel="Chapter" title="4 Proxying details (Pledge - Proxy - Registrar)">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Pledge discovery of Proxy">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Proxy GRASP announcements">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 CoAP connection to Registrar">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Proxy discovery and communication of Registrar">
<link href="#rfc.section.5" rel="Chapter" title="5 Protocol Details (Pledge - Registrar - MASA)">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 BRSKI-EST TLS establishment details">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Pledge Requests Voucher from the Registrar">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Registrar Authorization of                                                    Pledge">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 BRSKI-MASA TLS establishment details">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Registrar Requests Voucher from MASA">
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 MASA renewal of expired vouchers">
<link href="#rfc.section.5.5.2" rel="Chapter" title="5.5.2 MASA verification of voucher-request signature consistency">
<link href="#rfc.section.5.5.3" rel="Chapter" title="5.5.3 MASA authentication of registrar (certificate)">
<link href="#rfc.section.5.5.4" rel="Chapter" title="5.5.4 MASA revocation checking of registrar (certificate)">
<link href="#rfc.section.5.5.5" rel="Chapter" title="5.5.5 MASA verification of pledge prior-signed-voucher-request">
<link href="#rfc.section.5.5.6" rel="Chapter" title="5.5.6 MASA pinning of registrar">
<link href="#rfc.section.5.5.7" rel="Chapter" title="5.5.7 MASA nonce handling">
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 MASA and Registrar Voucher Response">
<link href="#rfc.section.5.6.1" rel="Chapter" title="5.6.1 Pledge voucher verification">
<link href="#rfc.section.5.6.2" rel="Chapter" title="5.6.2 Pledge authentication of provisional TLS connection">
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Pledge BRSKI Status Telemetry">
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Registrar audit log request">
<link href="#rfc.section.5.8.1" rel="Chapter" title="5.8.1 MASA audit log response">
<link href="#rfc.section.5.8.2" rel="Chapter" title="5.8.2 Registrar audit log verification">
<link href="#rfc.section.5.9" rel="Chapter" title="5.9 EST Integration for PKI bootstrapping">
<link href="#rfc.section.5.9.1" rel="Chapter" title="5.9.1 EST Distribution of CA Certificates">
<link href="#rfc.section.5.9.2" rel="Chapter" title="5.9.2 EST CSR Attributes">
<link href="#rfc.section.5.9.3" rel="Chapter" title="5.9.3 EST Client Certificate Request">
<link href="#rfc.section.5.9.4" rel="Chapter" title="5.9.4 Enrollment Status Telemetry">
<link href="#rfc.section.5.9.5" rel="Chapter" title="5.9.5 Multiple certificates">
<link href="#rfc.section.5.9.6" rel="Chapter" title="5.9.6 EST over CoAP">
<link href="#rfc.section.6" rel="Chapter" title="6 Reduced security operational modes">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Trust Model">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Pledge security reductions">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Registrar security reductions">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 MASA security reductions">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Well-known EST registration">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 PKIX Registry">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Pledge BRSKI Status Telemetry">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 DNS Service Names">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 MUD File Extension for the MASA">
<link href="#rfc.section.8" rel="Chapter" title="8 Applicability to the Autonomic                                               Control Plane">
<link href="#rfc.section.9" rel="Chapter" title="9 Privacy Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 MASA audit log">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 What BRSKI-MASA reveals to the manufacturer">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Manufacturers and Used or Stolen Equipment">
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 Manufacturers and Grey market equipment">
<link href="#rfc.section.9.5" rel="Chapter" title="9.5 Some mitigations for meddling by manufacturers">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 DoS against MASA">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Freshness in Voucher-Requests">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 Trusting manufacturers">
<link href="#rfc.section.10.4" rel="Chapter" title="10.4 Manufacturer Maintainance of trust anchors">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A IPv4 and non-ANI operations">
<link href="#rfc.appendix.A.1" rel="Chapter" title="A.1 IPv4 Link Local addresses">
<link href="#rfc.appendix.A.2" rel="Chapter" title="A.2 Use of DHCPv4">
<link href="#rfc.appendix.B" rel="Chapter" title="B mDNS / DNSSD proxy discovery options">
<link href="#rfc.appendix.C" rel="Chapter" title="C MUD Extension">
<link href="#rfc.appendix.D" rel="Chapter" title="D Example Vouchers">
<link href="#rfc.appendix.D.1" rel="Chapter" title="D.1 Keys involved">
<link href="#rfc.appendix.D.1.1" rel="Chapter" title="D.1.1 MASA key pair for voucher signatures">
<link href="#rfc.appendix.D.1.2" rel="Chapter" title="D.1.2 Manufacturer key pair for IDevID signatures">
<link href="#rfc.appendix.D.1.3" rel="Chapter" title="D.1.3 Registrar key pair">
<link href="#rfc.appendix.D.1.4" rel="Chapter" title="D.1.4 Pledge key pair">
<link href="#rfc.appendix.D.2" rel="Chapter" title="D.2 Example process">
<link href="#rfc.appendix.D.2.1" rel="Chapter" title="D.2.1 Pledge to Registrar">
<link href="#rfc.appendix.D.2.2" rel="Chapter" title="D.2.2 Registrar to MASA">
<link href="#rfc.appendix.D.2.3" rel="Chapter" title="D.2.3 MASA to Registrar">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.6 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Pritikin, M., Richardson, M., Behringer, M., Bjarnason, S., and K. Watsen" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-anima-bootstrapping-keyinfra-19" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-07" />
  <meta name="dct.abstract" content="This document specifies automated bootstrapping of an Autonomic Control Plane.  To do this a remote secure key infrastructure (BRSKI) is created using manufacturer installed X.509 certificate, in combination with a manufacturer's authorizing service, both online and offline.  Bootstrapping a new device can occur using a routable address and a cloud service, or using only link-local connectivity, or on limited/disconnected networks. Support for lower security models, including devices with minimal identity, is described for legacy reasons but not encouraged.  Bootstrapping is complete when the cryptographic identity of the new key infrastructure is successfully deployed to the device but the established secure connection can be used to deploy a locally issued certificate to the device as well.  " />
  <meta name="description" content="This document specifies automated bootstrapping of an Autonomic Control Plane.  To do this a remote secure key infrastructure (BRSKI) is created using manufacturer installed X.509 certificate, in combination with a manufacturer's authorizing service, both online and offline.  Bootstrapping a new device can occur using a routable address and a cloud service, or using only link-local connectivity, or on limited/disconnected networks. Support for lower security models, including devices with minimal identity, is described for legacy reasons but not encouraged.  Bootstrapping is complete when the cryptographic identity of the new key infrastructure is successfully deployed to the device but the established secure connection can be used to deploy a locally issued certificate to the device as well.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">ANIMA WG</td>
<td class="right">M. Pritikin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M. Richardson</td>
</tr>
<tr>
<td class="left">Expires: September 8, 2019</td>
<td class="right">Sandelman</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Behringer</td>
</tr>
<tr>
<td class="left"></td>
<td class="right"></td>
</tr>
<tr>
<td class="left"></td>
<td class="right">S. Bjarnason</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Arbor Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">K. Watsen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 7, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Bootstrapping Remote Secure Key Infrastructures (BRSKI)<br />
  <span class="filename">draft-ietf-anima-bootstrapping-keyinfra-19</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies automated bootstrapping of an Autonomic Control Plane.  To do this a remote secure key infrastructure (BRSKI) is created using manufacturer installed X.509 certificate, in combination with a manufacturer's authorizing service, both online and offline.  Bootstrapping a new device can occur using a routable address and a cloud service, or using only link-local connectivity, or on limited/disconnected networks. Support for lower security models, including devices with minimal identity, is described for legacy reasons but not encouraged.  Bootstrapping is complete when the cryptographic identity of the new key infrastructure is successfully deployed to the device but the established secure connection can be used to deploy a locally issued certificate to the device as well.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 8, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Prior Bootstrapping Approaches</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Scope of solution</a>
</li>
<ul><li>1.3.1.   <a href="#rfc.section.1.3.1">Support environment</a>
</li>
<li>1.3.2.   <a href="#rfc.section.1.3.2">Constrained environments</a>
</li>
<li>1.3.3.   <a href="#rfc.section.1.3.3">Network Access Controls</a>
</li>
<li>1.3.4.   <a href="#rfc.section.1.3.4">Bootstrapping is not Booting</a>
</li>
</ul><li>1.4.   <a href="#rfc.section.1.4">Leveraging the new key infrastructure / next steps</a>
</li>
<li>1.5.   <a href="#rfc.section.1.5">Requirements for Autonomic Network Infrastructure (ANI) devices</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">Architectural Overview</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Behavior of a Pledge</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Secure Imprinting using Vouchers</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Initial Device Identifier</a>
</li>
<ul><li>2.3.1.   <a href="#rfc.section.2.3.1">Identification of the Pledge</a>
</li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">MASA URI extension</a>
</li>
</ul><li>2.4.   <a href="#rfc.section.2.4">Protocol Flow</a>
</li>
<li>2.5.   <a href="#rfc.section.2.5">Architectural Components</a>
</li>
<ul><li>2.5.1.   <a href="#rfc.section.2.5.1">Pledge</a>
</li>
<li>2.5.2.   <a href="#rfc.section.2.5.2">Join Proxy</a>
</li>
<li>2.5.3.   <a href="#rfc.section.2.5.3">Domain Registrar</a>
</li>
<li>2.5.4.   <a href="#rfc.section.2.5.4">Manufacturer Service</a>
</li>
<li>2.5.5.   <a href="#rfc.section.2.5.5">Public Key Infrastructure (PKI)</a>
</li>
</ul><li>2.6.   <a href="#rfc.section.2.6">Certificate Time Validation</a>
</li>
<ul><li>2.6.1.   <a href="#rfc.section.2.6.1">Lack of realtime clock</a>
</li>
<li>2.6.2.   <a href="#rfc.section.2.6.2">Infinite Lifetime of IDevID</a>
</li>
</ul><li>2.7.   <a href="#rfc.section.2.7">Cloud Registrar</a>
</li>
<li>2.8.   <a href="#rfc.section.2.8">Determining the MASA to contact</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Voucher-Request artifact</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Nonceless Voucher Requests</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Tree Diagram</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Examples</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">YANG Module</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Proxying details (Pledge - Proxy - Registrar)</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Pledge discovery of Proxy</a>
</li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">Proxy GRASP announcements</a>
</li>
</ul><li>4.2.   <a href="#rfc.section.4.2">CoAP connection to Registrar</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Proxy discovery and communication of Registrar</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">Protocol Details (Pledge - Registrar - MASA)</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">BRSKI-EST TLS establishment details</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Pledge Requests Voucher from the Registrar</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Registrar Authorization of                                                    Pledge</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">BRSKI-MASA TLS establishment details</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Registrar Requests Voucher from MASA</a>
</li>
<ul><li>5.5.1.   <a href="#rfc.section.5.5.1">MASA renewal of expired vouchers</a>
</li>
<li>5.5.2.   <a href="#rfc.section.5.5.2">MASA verification of voucher-request signature consistency</a>
</li>
<li>5.5.3.   <a href="#rfc.section.5.5.3">MASA authentication of registrar (certificate)</a>
</li>
<li>5.5.4.   <a href="#rfc.section.5.5.4">MASA revocation checking of registrar (certificate)</a>
</li>
<li>5.5.5.   <a href="#rfc.section.5.5.5">MASA verification of pledge prior-signed-voucher-request</a>
</li>
<li>5.5.6.   <a href="#rfc.section.5.5.6">MASA pinning of registrar</a>
</li>
<li>5.5.7.   <a href="#rfc.section.5.5.7">MASA nonce handling</a>
</li>
</ul><li>5.6.   <a href="#rfc.section.5.6">MASA and Registrar Voucher Response</a>
</li>
<ul><li>5.6.1.   <a href="#rfc.section.5.6.1">Pledge voucher verification</a>
</li>
<li>5.6.2.   <a href="#rfc.section.5.6.2">Pledge authentication of provisional TLS connection</a>
</li>
</ul><li>5.7.   <a href="#rfc.section.5.7">Pledge BRSKI Status Telemetry</a>
</li>
<li>5.8.   <a href="#rfc.section.5.8">Registrar audit log request</a>
</li>
<ul><li>5.8.1.   <a href="#rfc.section.5.8.1">MASA audit log response</a>
</li>
<li>5.8.2.   <a href="#rfc.section.5.8.2">Registrar audit log verification</a>
</li>
</ul><li>5.9.   <a href="#rfc.section.5.9">EST Integration for PKI bootstrapping</a>
</li>
<ul><li>5.9.1.   <a href="#rfc.section.5.9.1">EST Distribution of CA Certificates</a>
</li>
<li>5.9.2.   <a href="#rfc.section.5.9.2">EST CSR Attributes</a>
</li>
<li>5.9.3.   <a href="#rfc.section.5.9.3">EST Client Certificate Request</a>
</li>
<li>5.9.4.   <a href="#rfc.section.5.9.4">Enrollment Status Telemetry</a>
</li>
<li>5.9.5.   <a href="#rfc.section.5.9.5">Multiple certificates</a>
</li>
<li>5.9.6.   <a href="#rfc.section.5.9.6">EST over CoAP</a>
</li>
</ul></ul><li>6.   <a href="#rfc.section.6">Reduced security operational modes</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Trust Model</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Pledge security reductions</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Registrar security reductions</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">MASA security reductions</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">Well-known EST registration</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">PKIX Registry</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Pledge BRSKI Status Telemetry</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">DNS Service Names</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">MUD File Extension for the MASA</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">Applicability to the Autonomic                                               Control Plane</a>
</li>
<li>9.   <a href="#rfc.section.9">Privacy Considerations</a>
</li>
<ul><li>9.1.   <a href="#rfc.section.9.1">MASA audit log</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">What BRSKI-MASA reveals to the manufacturer</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">Manufacturers and Used or Stolen Equipment</a>
</li>
<li>9.4.   <a href="#rfc.section.9.4">Manufacturers and Grey market equipment</a>
</li>
<li>9.5.   <a href="#rfc.section.9.5">Some mitigations for meddling by manufacturers</a>
</li>
</ul><li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<ul><li>10.1.   <a href="#rfc.section.10.1">DoS against MASA</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">Freshness in Voucher-Requests</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">Trusting manufacturers</a>
</li>
<li>10.4.   <a href="#rfc.section.10.4">Manufacturer Maintainance of trust anchors</a>
</li>
</ul><li>11.   <a href="#rfc.section.11">Acknowledgements</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<ul><li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">IPv4 and non-ANI operations</a>
</li>
<ul><li>A.1.   <a href="#rfc.appendix.A.1">IPv4 Link Local addresses</a>
</li>
<li>A.2.   <a href="#rfc.appendix.A.2">Use of DHCPv4</a>
</li>
</ul><li>Appendix B.   <a href="#rfc.appendix.B">mDNS / DNSSD proxy discovery options</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.C">MUD Extension</a>
</li>
<li>Appendix D.   <a href="#rfc.appendix.D">Example Vouchers</a>
</li>
<ul><li>D.1.   <a href="#rfc.appendix.D.1">Keys involved</a>
</li>
<ul><li>D.1.1.   <a href="#rfc.appendix.D.1.1">MASA key pair for voucher signatures</a>
</li>
<li>D.1.2.   <a href="#rfc.appendix.D.1.2">Manufacturer key pair for IDevID signatures</a>
</li>
<li>D.1.3.   <a href="#rfc.appendix.D.1.3">Registrar key pair</a>
</li>
<li>D.1.4.   <a href="#rfc.appendix.D.1.4">Pledge key pair</a>
</li>
</ul><li>D.2.   <a href="#rfc.appendix.D.2">Example process</a>
</li>
<ul><li>D.2.1.   <a href="#rfc.appendix.D.2.1">Pledge to Registrar</a>
</li>
<li>D.2.2.   <a href="#rfc.appendix.D.2.2">Registrar to MASA</a>
</li>
<li>D.2.3.   <a href="#rfc.appendix.D.2.3">MASA to Registrar</a>
</li>
</ul></ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">BRSKI provides a solution for secure zero-touch (automated) bootstrap of new (unconfigured) devices that are called pledges in this document.  </p>
<p id="rfc.section.1.p.2">This document primarily provides for the needs of the ISP and Enterprise focused ANIMA <a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">Autonomic Control Plane (ACP)</a>.  Other users of the BRSKI protocol will need to provide separate applicability statements that include privacy and security considerations appropriate to that deployment.  Section <a href="#acpapplicability" class="xref">Section 8</a> explains the details applicability for this the ACP usage.  </p>
<p id="rfc.section.1.p.3">This document describes how pledges discover (or be discovered by) an element of the network domain to which the pledge belongs to perform the bootstrap.  This element (device) is called the registrar.  Before any other operation, pledge and registrar need to establish mutual trust: </p>
<p></p>

<ol>
<li>Registrar authenticating the pledge: "Who is this device? What is its identity?"</li>
<li>Registrar authorizing the pledge: "Is it mine? Do I want it? What are the chances it has been compromised?"</li>
<li>Pledge authenticating the registrar: "What is this registrar's identity?"</li>
<li>Pledge authorizing the registrar: "Should I join it?"</li>
</ol>
<p id="rfc.section.1.p.5">This document details protocols and messages to answer the above questions.  It uses a TLS connection and an PKIX (X.509v3) certificate (an IEEE 802.1AR <a href="#IDevID" class="xref">[IDevID]</a> LDevID) of the pledge to answer points 1 and 2.  It uses a new artifact called a "voucher" that the registrar receives from a "Manufacturer Authorized Signing Authority" and passes to the pledge to answer points 3 and 4.  </p>
<p id="rfc.section.1.p.6">A proxy provides very limited connectivity between the pledge and the registrar.  </p>
<p id="rfc.section.1.p.7">The syntactic details of vouchers are described in detail in <a href="#RFC8366" class="xref">[RFC8366]</a>. This document details automated protocol mechanisms to obtain vouchers, including the definition of a 'voucher-request' message that is a minor extension to the voucher format (see <a href="#voucher-request" class="xref">Section 3</a>) defined by <a href="#RFC8366" class="xref">[RFC8366]</a>.</p>
<p id="rfc.section.1.p.8">BRSKI results in the pledge storing an X.509 root certificate sufficient for verifying the registrar identity. In the process a TLS connection is established that can be directly used for Enrollment over Secure Transport (EST). In effect BRSKI provides an automated mechanism for the "Bootstrap Distribution of CA Certificates" described in <a href="#RFC7030" class="xref">[RFC7030]</a> Section 4.1.1 wherein the pledge "MUST [...] engage a human user to authorize the CA certificate using out-of-band" information". With BRSKI the pledge now can automate this process using the voucher. Integration with a complete EST enrollment is optional but trivial.</p>
<p id="rfc.section.1.p.9">BRSKI is agile enough to support bootstrapping alternative key infrastructures, such as a symmetric key solutions, but no such system is described in this document.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Prior Bootstrapping Approaches</h1>
<p id="rfc.section.1.1.p.1">To literally "pull yourself up by the bootstraps" is an impossible action. Similarly the secure establishment of a key infrastructure without external help is also an impossibility. Today it is commonly accepted that the initial connections between nodes are insecure, until key distribution is complete, or that domain-specific keying material (often pre-shared keys, including mechanisms like SIM cards) is pre-provisioned on each new device in a costly and non-scalable manner. Existing automated mechanisms are known as non-secured 'Trust on First Use' (TOFU) <a href="#RFC7435" class="xref">[RFC7435]</a>, 'resurrecting duckling' <a href="#Stajano99theresurrecting" class="xref">[Stajano99theresurrecting]</a> or 'pre-staging'.</p>
<p id="rfc.section.1.1.p.2">Another prior approach has been to try and minimize user actions during bootstrapping, but not eliminate all user-actions.  The original EST protocol <a href="#RFC7030" class="xref">[RFC7030]</a> does reduce user actions during bootstrap but does not provide solutions for how the following protocol steps can be made autonomic (not involving user actions): </p>
<p></p>

<ul>
<li>using the Implicit Trust Anchor <a href="#RFC7030" class="xref">[RFC7030]</a> database to authenticate an owner specific service (not an autonomic solution because the URL must be securely distributed),</li>
<li>engaging a human user to authorize the CA certificate using out-of-band data (not an autonomic solution because the human user is involved),</li>
<li>using a configured Explicit TA database (not an autonomic solution because the distribution of an explicit TA database is not autonomic),</li>
<li>and using a Certificate-Less TLS mutual authentication method (not an autonomic solution because the distribution of symmetric key material is not autonomic).  </li>
</ul>

<p> These "touch" methods do not meet the requirements for zero-touch.  </p>
<p id="rfc.section.1.1.p.4">There are "call home" technologies where the pledge first establishes a connection to a well known manufacturer service using a common client-server authentication model. After mutual authentication, appropriate credentials to authenticate the target domain are transfered to the pledge. This creates serveral problems and limitations:</p>
<p></p>

<ul>
<li>the pledge requires realtime connectivity to the manufacturer service,</li>
<li>the domain identity is exposed to the manufacturer service (this is a privacy concern),</li>
<li>the manufacturer is responsible for making the authorization decisions (this is a liability concern),</li>
</ul>
<p id="rfc.section.1.1.p.6">BRSKI addresses these issues by defining extensions to the EST protocol for the automated distribution of vouchers.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Terminology</h1>
<p id="rfc.section.1.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<p id="rfc.section.1.2.p.2">The following terms are defined for clarity:</p>
<p></p>

<dl>
<dt>domainID:</dt>
<dd style="margin-left: 8">The domain IDentity is the 160-bit SHA-1 hash of the BIT STRING of the subjectPublicKey of the pinned-domain-cert leaf, i.e. the Registrars' certificate.  This is consistent with the subject key identifier (<a href="#RFC5280" class="xref">Section 4.2.1.2</a>).  </dd>
<dt>drop ship:</dt>
<dd style="margin-left: 8">The physical distribution of equipment containing the "factory default" configuration to a final destination. In zero-touch scenarios there is no staging or pre-configuration during drop-ship.</dd>
<dt>imprint:</dt>
<dd style="margin-left: 8">The process where a device obtains the cryptographic key material to identify and trust future interactions with a network. This term is taken from Konrad Lorenz's work in biology with new ducklings: during a critical period, the duckling would assume that anything that looks like a mother duck is in fact their mother. An equivalent for a device is to obtain the fingerprint of the network's root certification authority certificate. A device that imprints on an attacker suffers a similar fate to a duckling that imprints on a hungry wolf. Securely imprinting is a primary focus of this document <a href="#imprinting" class="xref">[imprinting]</a>. The analogy to Lorenz's work was first noted in <a href="#Stajano99theresurrecting" class="xref">[Stajano99theresurrecting]</a>.</dd>
<dt>enrollment:</dt>
<dd style="margin-left: 8">The process where a device presents key material to a network and acquires a network specific identity.  For example when a certificate signing request is presented to a certification authority and a certificate is obtained in response.</dd>
<dt>Pledge:</dt>
<dd style="margin-left: 8">The prospective device, which has an identity installed at the factory.</dd>
<dt>Voucher:</dt>
<dd style="margin-left: 8">A signed artifact from the MASA that indicates to a pledge the cryptographic identity of the registrar it should trust. There are different types of vouchers depending on how that trust is asserted. Multiple voucher types are defined in <a href="#RFC8366" class="xref">[RFC8366]</a>
</dd>
<dt>Domain:</dt>
<dd style="margin-left: 8">The set of entities that share a common local trust anchor. This includes the proxy, registrar, Domain Certificate Authority, Management components and any existing entity that is already a member of the domain.</dd>
<dt>Domain CA:</dt>
<dd style="margin-left: 8">The domain Certification Authority (CA) provides certification functionalities to the domain. At a minimum it provides certification functionalities to a registrar and manages the private key that defines the domain. Optionally, it certifies all elements.</dd>
<dt>Join Registrar (and Coordinator):</dt>
<dd style="margin-left: 8">A representative of the domain that is configured, perhaps autonomically, to decide whether a new device is allowed to join the domain. The administrator of the domain interfaces with a "join registrar (and coordinator)" to control this process. Typically a join registrar is "inside" its domain. For simplicity this document often refers to this as just "registrar". Within <a href="#I-D.ietf-anima-reference-model" class="xref">[I-D.ietf-anima-reference-model]</a> this is refered to as the "join registrar autonomic service agent".  Other communities use the abbreviation "JRC".  </dd>
<dt>(Public) Key Infrastructure:</dt>
<dd style="margin-left: 8">The collection of systems and processes that sustain the activities of a public key system.  The registrar acts as an <a href="#RFC5280" class="xref">[RFC5280]</a> and <a href="#RFC5272" class="xref">[RFC5272]</a> (see section 7) "Registration Authority".</dd>
<dt>Join Proxy:</dt>
<dd style="margin-left: 8">A domain entity that helps the pledge join the domain. A join proxy facilitates communication for devices that find themselves in an environment where they are not provided connectivity until after they are validated as members of the domain. For simplicity this document sometimes uses the term of 'proxy' to indicate the join proxy. The pledge is unaware that they are communicating with a proxy rather than directly with a registrar.</dd>
<dt>Circuit Proxy:</dt>
<dd style="margin-left: 8">A stateful implementation of the join proxy. This is the assumed type of proxy.</dd>
<dt>IPIP Proxy:</dt>
<dd style="margin-left: 8">A stateless proxy alternative.</dd>
<dt>MASA Service:</dt>
<dd style="margin-left: 8">A third-party Manufacturer Authorized Signing Authority (MASA) service on the global Internet. The MASA signs vouchers. It also provides a repository for audit log information of privacy protected bootstrapping events. It does not track ownership. </dd>
<dt>Ownership Tracker:</dt>
<dd style="margin-left: 8">An Ownership Tracker service on the global internet. The Ownership Tracker uses business processes to accurately track ownership of all devices shipped against domains that have purchased them. Although optional, this component allows vendors to provide additional value in cases where their sales and distribution channels allow for accurately tracking of such ownership. Ownership tracking information is indicated in vouchers as described in <a href="#RFC8366" class="xref">[RFC8366]</a>
</dd>
<dt>IDevID:</dt>
<dd style="margin-left: 8">An Initial Device Identity X.509 certificate installed by the vendor on new equipment.</dd>
<dt>TOFU:</dt>
<dd style="margin-left: 8">Trust on First Use. Used similarly to <a href="#RFC7435" class="xref">[RFC7435]</a>. This is where a pledge device makes no security decisions but rather simply trusts the first registrar it is contacted by. This is also known as the "resurrecting duckling" model.</dd>
<dt>nonced:</dt>
<dd style="margin-left: 8">a voucher (or request) that contains a nonce (the normal case).</dd>
<dt>nonceless:</dt>
<dd style="margin-left: 8">a voucher (or request) that does not contain a nonce, relying upon accurate clocks for expiration, or which does not expire.</dd>
<dt>manufacturer:</dt>
<dd style="margin-left: 8">the term manufacturer is used throughout this document to be the entity that created the device.  This is typically the "original equipment manufacturer" or OEM, but in more complex situations it could be a "value added retailer" (VAR), or possibly even a systems integrator.  In general, it a goal of BRSKI to eliminate small distinctions between different sales channels.  The reason for this is that it permits a single device, with a uniform firmware load, to be shipped directly to all customers.  This eliminates costs for the manufacturer.  This also reduces the number of products supported in the field increasing the chance that firmware will be more up to date.  </dd>
<dt>ANI:</dt>
<dd style="margin-left: 8">The Autonomic Network Infrastructure as defined by <a href="#I-D.ietf-anima-reference-model" class="xref">[I-D.ietf-anima-reference-model]</a>.  This document details specific requirements for pledges, proxies and registrars when they are part of an ANI.</dd>
<dt>offline:</dt>
<dd style="margin-left: 8">When an architectural component cannot perform realtime communications with a peer, either due to network connectivity or because the peer is turned off, the operation is said to be occurring offline.</dd>
</dl>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Scope of solution</h1>
<h1 id="rfc.section.1.3.1">
<a href="#rfc.section.1.3.1">1.3.1.</a> Support environment</h1>
<p id="rfc.section.1.3.1.p.1">This solution (BRSKI) can support large router platforms with multi-gigabit inter-connections, mounted in controlled access data centers. But this solution is not exclusive to large equipment: it is intended to scale to thousands of devices located in hostile environments, such as ISP provided CPE devices which are drop-shipped to the end user. The situation where an order is fulfilled from distributed warehouse from a common stock and shipped directly to the target location at the request of a domain owner is explicitly supported. That stock ("SKU") could be provided to a number of potential domain owners, and the eventual domain owner will not know a-priori which device will go to which location.  </p>
<p id="rfc.section.1.3.1.p.2">The bootstrapping process can take minutes to complete depending on the network infrastructure and device processing speed. The network communication itself is not optimized for speed; for privacy reasons, the discovery process allows for the pledge to avoid announcing its presence through broadcasting.  </p>
<p id="rfc.section.1.3.1.p.3">Nomadic or mobile devices often need to aquire credentials to access the network at the new location.  An example of this is mobile phone roaming among network operators, or even between cell towers.  This is usually called handoff.  BRSKI does not provide a low-latency handoff which is usually a requirement in such situations.  For these solutions BRSKI can be used to create a relationship (an LDevID) with the "home" domain owner. The resulting credentials are then used to provide credentials more appropriate for a low-latency handoff.  </p>
<h1 id="rfc.section.1.3.2">
<a href="#rfc.section.1.3.2">1.3.2.</a> Constrained environments</h1>
<p id="rfc.section.1.3.2.p.1">Questions have been posed as to whether this solution is suitable in general for Internet of Things (IoT) networks. This depends on the capabilities of the devices in question. The terminology of <a href="#RFC7228" class="xref">[RFC7228]</a> is best used to describe the boundaries.</p>
<p id="rfc.section.1.3.2.p.2">The solution described in this document is aimed in general at non-constrained (i.e., class 2+) devices operating on a non-Challenged network. The entire solution as described here is not intended to be useable as-is by constrained devices operating on challenged networks (such as 802.15.4 LLNs).</p>
<p id="rfc.section.1.3.2.p.3">Specifically, there are protocol aspects described here that might result in congestion collapse or energy-exhaustion of intermediate battery powered routers in an LLN. Those types of networks SHOULD NOT use this solution. These limitations are predominately related to the large credential and key sizes required for device authentication.  Defining symmetric key techniques that meet the operational requirements is out-of-scope but the underlying protocol operations (TLS handshake and signing structures) have sufficient algorithm agility to support such techniques when defined.</p>
<p id="rfc.section.1.3.2.p.4">The imprint protocol described here could, however, be used by non-energy constrained devices joining a non-constrained network (for instance, smart light bulbs are usually mains powered, and speak 802.11). It could also be used by non-constrained devices across a non-energy constrained, but challenged network (such as 802.15.4). The certificate contents, and the process by which the four questions above are resolved do apply to constrained devices. It is simply the actual on-the-wire imprint protocol that could be inappropriate.</p>
<h1 id="rfc.section.1.3.3">
<a href="#rfc.section.1.3.3">1.3.3.</a> Network Access Controls</h1>
<p id="rfc.section.1.3.3.p.1">This document presumes that network access control has either already occurred, is not required, or is integrated by the proxy and registrar in such a way that the device itself does not need to be aware of the details. Although the use of an X.509 Initial Device Identity is consistant with IEEE 802.1AR <a href="#IDevID" class="xref">[IDevID]</a>, and allows for alignment with 802.1X network access control methods, its use here is for pledge authentication rather than network access control. Integrating this protocol with network access control, perhaps as an Extensible Authentication Protocol (EAP) method (see <a href="#RFC3748" class="xref">[RFC3748]</a>), is out-of-scope.</p>
<h1 id="rfc.section.1.3.4">
<a href="#rfc.section.1.3.4">1.3.4.</a> Bootstrapping is not Booting</h1>
<p id="rfc.section.1.3.4.p.1">This document describes "bootstrapping" as the protocol used to obtain a local trust anchor. It is expected that this trust anchor, along with any additional configuration information subsequently installed, is persisted on the device across system restarts ("booting"). Bootstrapping occurs only infrequently such as when a device is transfered to a new owner or has been reset to factory default settings.</p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> <a href="#PostEnrollment" id="PostEnrollment">Leveraging the new key infrastructure / next steps</a>
</h1>
<p id="rfc.section.1.4.p.1">As a result of the protocol described herein, the bootstrapped devices have the Domain CA trust anchor in common. An end entity certificate has optionally been issued from the Domain CA. This makes it possible to securely deploy functionalities across the domain, e.g:</p>

<ul>
<li>Device management.</li>
<li>Routing authentication.</li>
<li>Service discovery.</li>
</ul>

<p> </p>
<p id="rfc.section.1.4.p.2">The major beneficiary is that it possible to use the credentials deployed by this protocol to secure the Autonomic Control Plane (ACP) (<a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">[I-D.ietf-anima-autonomic-control-plane]</a>).  </p>
<h1 id="rfc.section.1.5">
<a href="#rfc.section.1.5">1.5.</a> <a href="#ANIrequirements" id="ANIrequirements">Requirements for Autonomic Network Infrastructure (ANI) devices</a>
</h1>
<p id="rfc.section.1.5.p.1">The BRSKI protocol can be used in a number of environments. Some of the options in this document is the result of requirements that are out of the ANI scope.  This section defines the base requirements for ANI devices.  </p>
<p id="rfc.section.1.5.p.2">For devices that intend to become part of an Autonomic Network Infrastructure (ANI) (<a href="#I-D.ietf-anima-reference-model" class="xref">[I-D.ietf-anima-reference-model]</a>) that includes an Autonomic Control Plane (<a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">[I-D.ietf-anima-autonomic-control-plane]</a>), the BRSKI protocol MUST be implemented.  </p>
<p id="rfc.section.1.5.p.3">The pledge must perform discovery of the proxy as described in <a href="#discovery" class="xref">Section 4.1</a> using GRASP M_FLOOD announcements.  </p>
<p id="rfc.section.1.5.p.4">Upon successfully validating a voucher artiface, a status telemetry MUST be returned. See <a href="#pledgestatus" class="xref">Section 5.7</a>.  </p>
<p id="rfc.section.1.5.p.5">An ANIMA ANI pledge MUST implement the EST automation extensions described in <a href="#ESTintegration" class="xref">Section 5.9</a>.  They supplement the <a href="#RFC7030" class="xref">[RFC7030]</a> EST to better support automated devices that do not have an end user.  </p>
<p id="rfc.section.1.5.p.6">The ANI Join Registrar ASA MUST support all the BRSKI and above listed EST operations.  </p>
<p id="rfc.section.1.5.p.7">All ANI devices SHOULD support the BRSKI proxy function, using circuit proxies over the ACP. (See <a href="#JRCgrasp" class="xref">Section 4.3</a>) </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Architectural Overview</h1>
<p id="rfc.section.2.p.1">The logical elements of the bootstrapping framework are described in this section. Figure 1 provides a simplified overview of the components.  </p>
<pre>
                                           +------------------------+
   +--------------Drop Ship---------------&gt;| Vendor Service         |
   |                                       +------------------------+
   |                                       | M anufacturer|         |
   |                                       | A uthorized  |Ownership|
   |                                       | S igning     |Tracker  |
   |                                       | A uthority   |         |
   |                                       +--------------+---------+
   |                                                      ^
   |                                                      |  BRSKI-
   V                                                      |   MASA
+-------+     ............................................|...
|       |     .                                           |  .
|       |     .  +------------+       +-----------+       |  .
|       |     .  |            |       |           |       |  .
|Pledge |     .  |   Join     |       | Domain    &lt;-------+  .
|       |     .  |   Proxy    |       | Registrar |          .
|       &lt;--------&gt;............&lt;-------&gt; (PKI RA)  |          .
|       |        |        BRSKI-EST   |           |          .
|       |     .  |            |       +-----+-----+          .
|IDevID |     .  +------------+             | EST RFC7030    .
|       |     .           +-----------------+----------+     .
|       |     .           | Key Infrastructure         |     .
|       |     .           | (e.g., PKI Certificate     |     .
+-------+     .           |       Authority)           |     .
              .           +----------------------------+     .
              .                                              .
              ................................................
                            "Domain" components
</pre>
<p>Figure 1</p>
<p id="rfc.section.2.p.2">We assume a multi-vendor network. In such an environment there could be a Manufacturer Service for each manufacturer that supports devices following this document's specification, or an integrator could provide a generic service authorized by multiple manufacturers. It is unlikely that an integrator could provide Ownership Tracking services for multiple manufacturers due to the required sales channel integrations necessary to track ownership.</p>
<p id="rfc.section.2.p.3">The domain is the managed network infrastructure with a Key Infrastructure the pledge is joining. The domain provides initial device connectivity sufficient for bootstrapping through a proxy. The domain registrar authenticates the pledge, makes authorization decisions, and distributes vouchers obtained from the Manufacturer Service. Optionally the registrar also acts as a PKI Registration Authority.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Behavior of a Pledge</h1>
<p id="rfc.section.2.1.p.1">The pledge goes through a series of steps, which are outlined here at a high level.</p>
<pre>
               ------------
              /  Factory   \
              \  default   /
               -----+------
                    |
             +------v-------+
             | (1) Discover |
+------------&gt;              |
|            +------+-------+
|                   |
|            +------v-------+
|            | (2) Identity |
^------------+              |
| rejected   +------+-------+
|                   |
|            +------v-------+
|            | (3) Request  |
|            |     Join     |
|            +------+-------+
|                   |
|            +------v-------+
|            | (4) Imprint  |
^------------+              |
| Bad MASA   +------+-------+
| response          |  send Voucher Status Telemetry
|            +------v-------+
|            | (5) Enroll   |&lt;---+ (non-error HTTP codes  )
^------------+              |\___/ (e.g. 201 'Retry-After')
| Enroll     +------+-------+
| Failure           |
|              -----v------
|             /  Enrolled  \
^------------+             |
 Factory      \------------/
 reset

</pre>
<p>Figure 2: pledge state diagram</p>
<p id="rfc.section.2.1.p.2">State descriptions for the pledge are as follows:</p>
<p></p>

<ol>
<li>Discover a communication channel to a registrar.</li>
<li>Identify itself. This is done by presenting an X.509 IDevID credential to the discovered registrar (via the proxy) in a TLS handshake. (The registrar credentials are only provisionally accepted at this time).</li>
<li>Request to join the discovered registrar. A unique nonce is included ensuring that any responses can be associated with this particular bootstrapping attempt.</li>
<li>Imprint on the registrar. This requires verification of the manufacturer service provided voucher. A voucher contains sufficient information for the pledge to complete authentication of a registrar.  This document details this step in depth.  </li>
<li>Enroll. After imprint an authenticated TLS (HTTPS) connection exists between pledge and registrar.  Enrollment over Secure Transport (EST) <a href="#RFC7030" class="xref">[RFC7030]</a> is then used to obtain a domain certificate from a registrar.</li>
</ol>
<p id="rfc.section.2.1.p.4">The pledge is now a member of, and can be managed by, the domain and will only repeat the discovery aspects of bootstrapping if it is returned to factory default settings.  </p>
<p id="rfc.section.2.1.p.5">This specification details integration with EST enrollment so that pledges can optionally obtain a locally issued certificate, although any REST interface could be integrated in future work.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Secure Imprinting using Vouchers</h1>
<p id="rfc.section.2.2.p.1">A voucher is a cryptographically protected artifact (a digital signature) to the pledge device authorizing a zero-touch imprint on the registrar domain. </p>
<p id="rfc.section.2.2.p.2">The format and cryptographic mechanism of vouchers is described in detail in <a href="#RFC8366" class="xref">[RFC8366]</a>.</p>
<p id="rfc.section.2.2.p.3">Vouchers provide a flexible mechanism to secure imprinting: the pledge device only imprints when a voucher can be validated.  At the lowest security levels the MASA can indiscriminately issue vouchers and log claims of ownership by domains.  At the highest security levels issuance of vouchers can be integrated with complex sales channel integrations that are beyond the scope of this document. The sales channel integration would verify actual (legal) ownership of the pledge by the domain.  This provides the flexibility for a number of use cases via a single common protocol mechanism on the pledge and registrar devices that are to be widely deployed in the field. The MASA services have the flexibility to leverage either the currently defined claim mechanisms or to experiment with higher or lower security levels.</p>
<p id="rfc.section.2.2.p.4">Vouchers provide a signed but non-encrypted communication channel among the pledge, the MASA, and the registrar. The registrar maintains control over the transport and policy decisions allowing the local security policy of the domain network to be enforced.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#IDevIDextension" id="IDevIDextension">Initial Device Identifier</a>
</h1>
<p id="rfc.section.2.3.p.1">Pledge authentication and pledge voucher-request signing is via a PKIX certificate installed during the manufacturing process. This is the 802.1AR Initial Device Identifier (IDevID), and it provides a basis for authenticating the pledge during the protocol exchanges described here.  There is no requirement for a common root PKI hierarchy.  Each device manufacturer can generate its own root certificate.  Specifically, the IDevID enables: </p>

<ol>
<li>Uniquely identifying the pledge by the Distinguished Name (DN) and subjectAltName (SAN) parameters in the IDevID. The unique identification of a pledge in the voucher objects are derived from those parameters as described below.  </li>
<li>Provides a cryptographic authentication of the pledge to the Registrar (see <a href="#pledgeauthorization" class="xref">Section 5.3</a>).  </li>
<li>Secure auto-discovery of the pledge's MASA by the registrar (see <a href="#obtainmasaurl" class="xref">Section 2.8</a>).  </li>
<li>Signing of voucher-request by the pledge's IDevID (see <a href="#voucher-request" class="xref">Section 3</a>).  </li>
<li>Provides a cryptographic authentication of the pledge to the MASA (see <a href="#MASAassertion" class="xref">Section 5.5.5</a>).  </li>
</ol>

<p> </p>
<p id="rfc.section.2.3.p.2">Section 7.2.13 of <a href="#IDevID" class="xref">[IDevID]</a> discusses keyUsage and extendedKeyUsage extensions in the IDevID certificate.  Any restrictions included reduce the utility of the IDevID and so this specification RECOMMENDS that no key usage restrictions be included.  Additionally, <a href="#RFC5280" class="xref">[RFC5280]</a> section 4.2.1.3 does not require key usage restrictions for end entity certificates.  </p>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#PledgeIdentification" id="PledgeIdentification">Identification of the Pledge</a>
</h1>
<p id="rfc.section.2.3.1.p.1">In the context of BRSKI, pledges are uniquely identified by a "serial-number". This serial-number is used both in the "serial-number" field of voucher or voucher-requests (see <a href="#voucher-request" class="xref">Section 3</a>) and in local policies on registrar or MASA (see <a href="#ProtocolDetails" class="xref">Section 5</a>).  </p>
<p id="rfc.section.2.3.1.p.2">The following fields are defined in <a href="#IDevID" class="xref">[IDevID]</a> and <a href="#RFC5280" class="xref">[RFC5280]</a>: </p>
<p></p>

<ul>
<li>The subject field's DN encoding MUST include the "serialNumber" attribute with the device's unique serial number.  (from <a href="#IDevID" class="xref">[IDevID]</a> section 7.2.8, and <a href="#RFC5280" class="xref">[RFC5280]</a> section 4.1.2.4's list of standard attributes) </li>
<li>The subject-alt field's encoding MAY include a non-critical version of the RFC4108 defined HardwareModuleName.  (from <a href="#IDevID" class="xref">[IDevID]</a> section 7.2.9) If the IDevID is stored in a Trusted Platform Module (TPM), then this field MAY contain the TPM identification rather than the device's serial number.  If both fields are present, then the subject field takes precedence.  </li>
</ul>

<p> </p>
<p id="rfc.section.2.3.1.p.4">and they are used as follows by the pledge to build the "serial-number" that is placed in the voucher-request.  In order to build it, the fields need to be converted into a serial-number of "type string".  The following methods are used depending on the first available IDevID certificate field (attempted in this order): </p>

<ol>
<li>
<a href="#RFC4519" class="xref">[RFC4519]</a> section 2.31 provides an example ("WI-3005") of the Distinguished Name "serialNumber" attribute.  [RFC4514] indicates this is a printable string so no encoding is necessary.  </li>
<li>The HardwareModuleName hwSerialNum OCTET STRING. This value is base64 encoded to convert it to a printable string format.  </li>
</ol>

<p> </p>
<p id="rfc.section.2.3.1.p.5">The above process to locate the serial-number MUST be performed by the pledge when filling out the voucher-request.  Signed voucher-requests are always passed up to the MASA, and the connection between the serial-number in the voucher-request and the serial number in the IDevID certificate.  </p>
<p id="rfc.section.2.3.1.p.6">As explained in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> the Registrar MUST extract the serial-number again itself from the pledge's TLS certificate.  It may consult the serial-number in the pledge-request if there are any possible confusion about the source of the serial-number (hwSerialNum vs serialNumber).  </p>
<h1 id="rfc.section.2.3.2">
<a href="#rfc.section.2.3.2">2.3.2.</a> <a href="#MASAURL" id="MASAURL">MASA URI extension</a>
</h1>
<p id="rfc.section.2.3.2.p.1">This docucment defines a new PKIX non-critical certificate extension to carry the MASA URI.  This extension is intended to be used in the IDevID certificate.  The URI is represented as described in Section 7.4 of <a href="#RFC5280" class="xref">[RFC5280]</a>.  </p>
<p id="rfc.section.2.3.2.p.2">Any Internationalized Resource Identifiers (IRIs) MUST be mapped to URIs as specified in Section 3.1 of [RFC3987] before they are placed in the certificate extension. The IRI provides the authority information.  The BRSKI "/.well-known" tree (<a href="#RFC5785" class="xref">[RFC5785]</a>) is described in <a href="#ProtocolDetails" class="xref">Section 5</a>.  </p>
<p id="rfc.section.2.3.2.p.3">As explained in <a href="#RFC5280" class="xref">[RFC5280]</a> section 7.4, a complete IRI SHOULD be in this extension, including the scheme, iauthority, and ipath.  As a consideration to constrained systems, this MAY be reduced to only the iauthority, in which case a scheme of "https://" and ipath of "/.well-known/est" is to be assumed, as explained in section <a href="#ProtocolDetails" class="xref">Section 5</a>.  </p>
<p id="rfc.section.2.3.2.p.4">The registrary can assume that only the iauthority is present in the extension, if there are no slash ("/") characters in the extension.  </p>
<p id="rfc.section.2.3.2.p.5">Section 7.4 of <a href="#RFC5280" class="xref">[RFC5280]</a> calls out various schemes that MUST be supported, including ldap, http and ftp.  However, the registrar MUST use https for the BRSKI-MASA connection.  </p>
<p id="rfc.section.2.3.2.p.6">The new extension is identified as follows:</p>
<pre>
&lt;CODE BEGINS&gt;

MASAURLExtnModule-2016 { iso(1) identified-organization(3) dod(6)
internet(1) security(5) mechanisms(5) pkix(7)
id-mod(0) id-mod-MASAURLExtn2016(TBD) }

DEFINITIONS IMPLICIT TAGS ::= BEGIN

-- EXPORTS ALL --

IMPORTS
EXTENSION
FROM PKIX-CommonTypes-2009
{ iso(1) identified-organization(3) dod(6) internet(1)
security(5) mechanisms(5) pkix(7) id-mod(0)
id-mod-pkixCommon-02(57) }

id-pe
FROM PKIX1Explicit-2009
{ iso(1) identified-organization(3) dod(6) internet(1)
security(5) mechanisms(5) pkix(7) id-mod(0)
id-mod-pkix1-explicit-02(51) } ;
MASACertExtensions EXTENSION ::= { ext-MASAURL, ... }
ext-MASAURL EXTENSION ::= { SYNTAX MASAURLSyntax
IDENTIFIED BY id-pe-masa-url }

id-pe-masa-url OBJECT IDENTIFIER ::= { id-pe TBD }

MASAURLSyntax ::= IA5String

END

&lt;CODE ENDS&gt;
</pre>
<p id="rfc.section.2.3.2.p.7">The choice of id-pe is based on guidance found in Section 4.2.2 of [RFC5280], "These extensions may be used to direct applications to on-line information about the issuer or the subject". The MASA URL is precisely that: online information about the particular subject. </p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#flow" id="flow">Protocol Flow</a>
</h1>
<p id="rfc.section.2.4.p.1">A representative flow is shown in Figure 3:</p>
<pre>
+--------+         +---------+    +------------+     +------------+
| Pledge |         | Circuit |    | Domain     |     | Vendor     |
|        |         | Join    |    | Registrar  |     | Service    |
|        |         | Proxy   |    |  (JRC)     |     | (MASA)     |
+--------+         +---------+    +------------+     +------------+
  |                     |                   |           Internet |
[discover]              |                   |                    |
  |&lt;-RFC4862 IPv6 addr  |                   |                    |
  |&lt;-RFC3927 IPv4 addr  | Appendix A        |  Legend            |
  |--------------------&gt;|                   |  C - circuit       |
  | optional: mDNS query| Appendix B        |      join proxy    |
  | RFC6763/RFC6762     |                   |  P - provisional   |
  |&lt;--------------------|                   |    TLS connection  |
  | GRASP M_FLOOD       |                   |                    |
  |   periodic broadcast|                   |                    |
[identity]              |                   |                    |
  |&lt;-------------------&gt;C&lt;-----------------&gt;|                    |
  |         TLS via the Join Proxy          |                    |
  |&lt;--Registrar TLS server authentication---|                    |
[PROVISIONAL accept of server cert]         |                    |
  P---X.509 client authentication----------&gt;|                    |
[request join]                              |                    |
  P---Voucher Request(w/nonce for voucher)-&gt;|                    |
  P                  /-------------------   |                    |
  P                  |                 [accept device?]          |
  P                  |                 [contact Vendor]          |
  P                  |                      |--Pledge ID--------&gt;|
  P                  |                      |--Domain ID--------&gt;|
  P                  |                      |--optional:nonce---&gt;|
  P              optional:                  |     [extract DomainID]
  P        can occur in advance             |     [update audit log]
  P            if nonceleess                |                    |
  P                  |                      |&lt;- voucher ---------|
  P                  \-------------------   | w/nonce if provided|
  P&lt;------voucher---------------------------|                    |
[imprint]                                   |                    |
  |-------voucher status telemetry---------&gt;|                    |
  |                                         |&lt;-device audit log--|
  |                             [verify audit log and voucher]   |
  |&lt;---------------------------------------&gt;|                    |
[enroll]                                    |                    |
  | Continue with RFC7030 enrollment        |                    |
  | using now bidirectionally authenticated |                    |
  | TLS session.                            |                    |
[enrolled]                                  |                    |
</pre>
<p>Figure 3</p>
<h1 id="rfc.section.2.5">
<a href="#rfc.section.2.5">2.5.</a> Architectural Components</h1>
<h1 id="rfc.section.2.5.1">
<a href="#rfc.section.2.5.1">2.5.1.</a> <a href="#pledge-overview" id="pledge-overview">Pledge</a>
</h1>
<p id="rfc.section.2.5.1.p.1">The pledge is the device that is attempting to join.  Until the pledge completes the enrollment process, it has link-local network connectivity only to the proxy.  </p>
<h1 id="rfc.section.2.5.2">
<a href="#rfc.section.2.5.2">2.5.2.</a> <a href="#proxy-overview" id="proxy-overview">Join Proxy</a>
</h1>
<p id="rfc.section.2.5.2.p.1">The join proxy provides HTTPS connectivity between the pledge and the registrar. A circuit proxy mechanism is described in <a href="#proxydetails" class="xref">Section 4</a>. Additional mechanisms, including a CoAP mechanism and a stateless IPIP mechanism are the subject of future work.  </p>
<h1 id="rfc.section.2.5.3">
<a href="#rfc.section.2.5.3">2.5.3.</a> <a href="#registrar-overview" id="registrar-overview">Domain Registrar</a>
</h1>
<p id="rfc.section.2.5.3.p.1">The domain's registrar operates as the BRSKI-MASA client when requesting vouchers from the MASA (see <a href="#brskimasatls" class="xref">Section 5.4</a>). The registrar operates as the BRSKI-EST server when pledges request vouchers (see <a href="#brskiesttls" class="xref">Section 5.1</a>). The registrar operates as the BRSKI-EST server "Registration Authority" if the pledge requests an end entity certificate over the BRSKI-EST connection (see <a href="#ESTintegration" class="xref">Section 5.9</a>).</p>
<p id="rfc.section.2.5.3.p.2">The registrar uses an Implicit Trust Anchor database for authenticating the BRSKI-MASA TLS connection MASA certificate.  The registrar uses a different Implicit Trust Anchor database for authenticating the BRSKI-EST TLS connection pledge client certificate.  Configuration or distribution of these trust anchor databases is out-of-scope of this specification.</p>
<h1 id="rfc.section.2.5.4">
<a href="#rfc.section.2.5.4">2.5.4.</a> <a href="#masa-overview" id="masa-overview">Manufacturer Service</a>
</h1>
<p id="rfc.section.2.5.4.p.1">The Manufacturer Service provides two logically seperate functions: the Manufacturer Authorized Signing Authority (MASA) described in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> and <a href="#VoucherResponse" class="xref">Section 5.6</a>, and an ownership tracking/auditing function described in <a href="#pledgestatus" class="xref">Section 5.7</a> and <a href="#authzLogRequest" class="xref">Section 5.8</a>.  </p>
<h1 id="rfc.section.2.5.5">
<a href="#rfc.section.2.5.5">2.5.5.</a> <a href="#pki-overview" id="pki-overview">Public Key Infrastructure (PKI)</a>
</h1>
<p id="rfc.section.2.5.5.p.1">The Public Key Infrastructure (PKI) administers certificates for the domain of concerns, providing the trust anchor(s) for it and allowing enrollment of pledges with domain certificates.  </p>
<p id="rfc.section.2.5.5.p.2">The voucher provides a method for the distribution of a single PKI trust anchor (as the "pinned-domain-cert"). A distribution of the full set of current trust anchors is possible using the optional EST integration.  </p>
<p id="rfc.section.2.5.5.p.3">The domain's registrar acts as an <a href="#RFC5272" class="xref">[RFC5272]</a> Registration Authority, requesting certificates for pledges from the Key Infrastructure.  </p>
<p id="rfc.section.2.5.5.p.4">The expectations of the PKI are unchanged from EST [<a href="#RFC7030" class="xref">[RFC7030]</a>].  This document does not place any additional architectural requirements on the Public Key Infrastructure.  </p>
<h1 id="rfc.section.2.6">
<a href="#rfc.section.2.6">2.6.</a> <a href="#certificatevalidaty" id="certificatevalidaty">Certificate Time Validation</a>
</h1>
<h1 id="rfc.section.2.6.1">
<a href="#rfc.section.2.6.1">2.6.1.</a> <a href="#timeunknown" id="timeunknown">Lack of realtime clock</a>
</h1>
<p id="rfc.section.2.6.1.p.1">Many devices when bootstrapping do not have knowledge of the current time. Mechanisms such as Network Time Protocols cannot be secured until bootstrapping is complete. Therefore bootstrapping is defined in a method that does not require knowledge of the current time.  A pledge MAY ignore all time stamps in the voucher and in the certificate validity periods if it does not know the current time.  </p>
<p id="rfc.section.2.6.1.p.2">The pledge is exposed to dates in the following five places: registrar certificate notBefore, registrar certificiate notAfter, voucher created-on, and voucher expires-on.  Additionally, CMS signatures contain a signingTime.  </p>
<p id="rfc.section.2.6.1.p.3">If the voucher contains a nonce then the pledge MUST confirm the nonce matches the original pledge voucher-request. This ensures the voucher is fresh.  See <a href="#RequestVoucherFromRegistrar" class="xref">Section 5.2</a>.  </p>
<h1 id="rfc.section.2.6.2">
<a href="#rfc.section.2.6.2">2.6.2.</a> <a href="#infinitelifetime" id="infinitelifetime">Infinite Lifetime of IDevID</a>
</h1>
<p><a href="#RFC5280" class="xref">[RFC5280]</a> explains that long lived pledge certificates "SHOULD be assigned the GeneralizedTime value of 99991231235959Z".  Registrars MUST support such lifetimes and SHOULD support ignoring pledge lifetimes if they did not follow the RFC5280 recommendations.  </p>
<p id="rfc.section.2.6.2.p.2">For example, IDevID may have incorrect lifetime of N &lt;= 3 years, rendering replacement pledges from storage useless after N years unless registrars support ignoring such a lifetime.  </p>
<h1 id="rfc.section.2.7">
<a href="#rfc.section.2.7">2.7.</a> <a href="#cloudregistrar" id="cloudregistrar">Cloud Registrar</a>
</h1>
<p id="rfc.section.2.7.p.1">There exist operationally open network wherein devices gain unauthenticated access to the internet at large.  In these use cases the management domain for the device needs to be discovered within the larger internet. These are less likely within the anima scope but may be more important in the future.  </p>
<p id="rfc.section.2.7.p.2">There are additionally some greenfield situations involving an entirely new installation where a device may have some kind of management uplink that it can use (such as via 3G network for instance).   In such a future situation, the device might use this management interface to learn that it should configure itself to become the local registrar.  </p>
<p id="rfc.section.2.7.p.3">In order to support these scenarios, the pledge MAY contact a well known URI of a cloud registrar if a local registrar cannot be discovered or if the pledge's target use cases do not include a local registrar.</p>
<p id="rfc.section.2.7.p.4">If the pledge uses a well known URI for contacting a cloud registrar an Implicit Trust Anchor database (see <a href="#RFC7030" class="xref">[RFC7030]</a>) MUST be used to authenticate service as described in <a href="#RFC6125" class="xref">[RFC6125]</a>. This is consistent with the human user configuration of an EST server URI in <a href="#RFC7030" class="xref">[RFC7030]</a> which also depends on RFC6125.</p>
<h1 id="rfc.section.2.8">
<a href="#rfc.section.2.8">2.8.</a> <a href="#obtainmasaurl" id="obtainmasaurl">Determining the MASA to contact</a>
</h1>
<p id="rfc.section.2.8.p.1">The registrar needs to be able to contact a MASA that is trusted by the pledge in order to obtain vouchers. There are three mechanisms described:</p>
<p id="rfc.section.2.8.p.2">The device's Initial Device Identifier (IDevID) will normally contain the MASA URL as detailed in <a href="#IDevIDextension" class="xref">Section 2.3</a>. This is the RECOMMENDED mechanism.</p>
<p id="rfc.section.2.8.p.3">If the registrar is integrated with <a href="#I-D.ietf-opsawg-mud" class="xref">[I-D.ietf-opsawg-mud]</a> and the pledge IDevID contains the id-pe-mud-url then the registrar MAY attempt to obtain the MASA URL from the MUD file. The MUD file extension for the MASA URL is defined in <a href="#mud-extension" class="xref">Appendix C</a>.</p>
<p id="rfc.section.2.8.p.4">It can be operationally difficult to ensure the necessary X.509 extensions are in the pledge's IDevID due to the difficulty of aligning current pledge manufacturing with software releases and development. As a final fallback the registrar MAY be manually configured or distributed with a MASA URL for each manufacturer. Note that the registrar can only select the configured MASA URL based on the trust anchor -- so manufacturers can only leverage this approach if they ensure a single MASA URL works for all pledge's associated with each trust anchor.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#voucher-request" id="voucher-request">Voucher-Request artifact</a>
</h1>
<p id="rfc.section.3.p.1">Voucher-requests are how vouchers are requested.  The semantics of the vouchers are described below, in the YANG model.  </p>
<p id="rfc.section.3.p.2">A pledge forms the "pledge voucher-request" and submits it to the registrar.  </p>
<p id="rfc.section.3.p.3">The registrar in turn forms the "registrar voucher-request", and submits it to the MASA.  </p>
<p id="rfc.section.3.p.4">The "proximity-registrar-cert" leaf is used in the pledge voucher-requests. This provides a method for the pledge to assert the registrar's proximity.  </p>
<p id="rfc.section.3.p.5">The "prior-signed-voucher-request" leaf is used in registrar voucher-requests. If present, it is the encoded (signed form) of the pledge voucher-request. This provides a method for the registrar to forward the pledge's signed request to the MASA. This completes transmission of the signed "proximity-registrar-cert" leaf.  </p>
<p id="rfc.section.3.p.6">Unless otherwise signaled (outside the voucher-request artifact), the signing structure is as defined for vouchers, see <a href="#RFC8366" class="xref">[RFC8366]</a>.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#noncelessVoucherRequest" id="noncelessVoucherRequest">Nonceless Voucher Requests</a>
</h1>
<p id="rfc.section.3.1.p.1">A registrar MAY also retrieve nonceless vouchers by sending nonceless voucher-requests to the MASA in order to obtain vouchers for use when the registrar does not have connectivity to the MASA.  No "prior-signed-voucher-request" leaf would be included.  The registrar will also need to know the serial number of the pledge. This document does not provide a mechanism for the registrar to learn that in an automated fashion. Typically this will be done via scanning of bar-code or QR-code on packaging, or via some sales channel integration.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#voucher-request-tree-diagram" id="voucher-request-tree-diagram">Tree Diagram</a>
</h1>
<p id="rfc.section.3.2.p.1">The following tree diagram illustrates a high-level view of a voucher-request document.  The voucher-request builds upon the voucher artifact described in <a href="#RFC8366" class="xref">[RFC8366]</a>.  The tree diagram is described in <a href="#RFC8340" class="xref">[RFC8340]</a>.  Each node in the diagram is fully described by the YANG module in <a href="#voucher-request-yang-module" class="xref">Section 3.4</a>.  Please review the YANG module for a detailed description of the voucher-request format.</p>
<pre>
module: ietf-voucher-request

  grouping voucher-request-grouping
    +---- voucher
       +---- created-on?                      yang:date-and-time
       +---- expires-on?                      yang:date-and-time
       +---- assertion?                       enumeration
       +---- serial-number                    string
       +---- idevid-issuer?                   binary
       +---- pinned-domain-cert?              binary
       +---- domain-cert-revocation-checks?   boolean
       +---- nonce?                           binary
       +---- last-renewal-date?               yang:date-and-time
       +---- prior-signed-voucher-request?    binary
       +---- proximity-registrar-cert?        binary
</pre>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#voucher-request-examples" id="voucher-request-examples">Examples</a>
</h1>
<p id="rfc.section.3.3.p.1">This section provides voucher-request examples for illustration purposes.  For detailed examples, see <a href="#exampleprocess" class="xref">Appendix D.2</a>. These examples conform to the encoding rules defined in <a href="#RFC7951" class="xref">[RFC7951]</a>.</p>
<p></p>

<dl>
<dt>Example (1)   </dt>
<dd>The following example illustrates a pledge voucher-request. The assertion leaf is indicated as 'proximity' and the registrar's TLS server certificate is included in the 'proximity-registrar-cert' leaf. See <a href="#RequestVoucherFromRegistrar" class="xref">Section 5.2</a>.</dd>
</dl>
<pre>
{
    "ietf-voucher-request:voucher": {
        "nonce": "62a2e7693d82fcda2624de58fb6722e5",
        "created-on": "2017-01-01T00:00:00.000Z",
        "proximity-registrar-cert": "base64encodedvalue=="
    }
}
</pre>
<p></p>

<dl>
<dt>Example (2)   </dt>
<dd>The following example illustrates a registrar voucher-request.  The 'prior-signed-voucher-request' leaf is populated with the pledge's voucher-request (such as the prior example).  The pledge's voucher-request, if a signed artifact with a CMS format signature is a binary object.  In the JSON encoding used here it must be base64 encoded. The nonce, created-on and assertion is carried forward. The serial-number is extracted from the pledge's Client Certificate from the TLS connection. See <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>.</dd>
</dl>
<pre>
{
    "ietf-voucher-request:voucher": {
        "nonce": "62a2e7693d82fcda2624de58fb6722e5",
        "created-on": "2017-01-01T00:00:02.000Z",
        "idevid-issuer": "base64encodedvalue=="
        "serial-number": "JADA123456789"
        "prior-signed-voucher-request": "base64encodedvalue=="
    }
}
</pre>
<p></p>

<dl>
<dt>Example (3)   </dt>
<dd>The following example illustrates a registrar voucher-request.  The 'prior-signed-voucher-request' leaf is not populated with the pledge's voucher-request nor is the nonce leaf. This form might be used by a registrar requesting a voucher when the pledge can not communicate with the registrar (such as when it is powered down, or still in packaging), and therefore could not submit a nonce.  This scenario is most useful when the registrar is aware that it will not be able to reach the MASA during deployment.  See <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>.</dd>
</dl>
<pre>
{
    "ietf-voucher-request:voucher": {
        "created-on":    "2017-01-01T00:00:02.000Z",
        "idevid-issuer": "base64encodedvalue=="
        "serial-number": "JADA123456789"
    }
}
</pre>
<p></p>

<dl>
<dt>Example (4)   </dt>
<dd>The following example illustrates a registrar voucher-request.  The 'prior-signed-voucher-request' leaf is not populated with the pledge voucher-request because the pledge did not sign its own request. This form might be used when more constrained pledges are being deployed. The nonce is populated from the pledge's request.   See <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>.</dd>
</dl>
<pre>
{
    "ietf-voucher-request:voucher": {
        "nonce": "62a2e7693d82fcda2624de58fb6722e5",
        "created-on": "2017-01-01T00:00:02.000Z",
        "idevid-issuer": "base64encodedvalue=="
        "serial-number": "JADA123456789"
    }
}
</pre>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#voucher-request-yang-module" id="voucher-request-yang-module">YANG Module</a>
</h1>
<p id="rfc.section.3.4.p.1">Following is a YANG <a href="#RFC7950" class="xref">[RFC7950]</a> module formally extending the <a href="#RFC8366" class="xref">[RFC8366]</a> voucher into a voucher-request.</p>
<pre>
&lt;CODE BEGINS&gt; file "ietf-voucher-request@2018-02-14.yang"
module ietf-voucher-request {
  yang-version 1.1;

  namespace
    "urn:ietf:params:xml:ns:yang:ietf-voucher-request";
  prefix "vch";

  import ietf-restconf {
    prefix rc;
    description "This import statement is only present to access
       the yang-data extension defined in RFC 8040.";
    reference "RFC 8040: RESTCONF Protocol";
  }

  import ietf-voucher {
    prefix v;
    description "This module defines the format for a voucher,
        which is produced by a pledge's manufacturer or
        delegate (MASA) to securely assign a pledge to
        an 'owner', so that the pledge may establish a secure
        conn ection to the owner's network infrastructure";

    reference "RFC YYYY: Voucher Profile for Bootstrapping Protocols";
  }

  organization
   "IETF ANIMA Working Group";

  contact
   "WG Web:   &lt;http://tools.ietf.org/wg/anima/&gt;
    WG List:  &lt;mailto:anima@ietf.org&gt;
    Author:   Kent Watsen
              &lt;mailto:kwatsen@juniper.net&gt;
    Author:   Max Pritikin
              &lt;mailto:pritikin@cisco.com&gt;
    Author:   Michael Richardson
              &lt;mailto:mcr+ietf@sandelman.ca&gt;
    Author:   Toerless Eckert
              &lt;mailto:tte+ietf@cs.fau.de&gt;";

  description
   "This module defines the format for a voucher request.
    It is a superset of the voucher itself.
    This artifact may be optionally signed.
    It provides content to the MASA for consideration
    during a voucher request.

    The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT',
    'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in
    the module text are to be interpreted as described in RFC 2119.

    Copyright (c) 2017 IETF Trust and the persons identified as
    authors of the code. All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, is permitted pursuant to, and subject to the license
    terms contained in, the Simplified BSD License set forth in Section
    4.c of the IETF Trust's Legal Provisions Relating to IETF Documents
    (http://trustee.ietf.org/license-info).

    This version of this YANG module is part of RFC XXXX; see the RFC
    itself for full legal notices.";

  revision "2018-02-14" {
    description
     "Initial version";
    reference
     "RFC XXXX: Voucher Profile for Bootstrapping Protocols";
  }

  // Top-level statement
  rc:yang-data voucher-request-artifact {
    uses voucher-request-grouping;
  }

  // Grouping defined for future usage
  grouping voucher-request-grouping {
    description
      "Grouping to allow reuse/extensions in future work.";

    uses v:voucher-artifact-grouping {
      refine "voucher/created-on" {
        mandatory false;
      }

      refine "voucher/pinned-domain-cert" {
        mandatory false;
      }

      refine "voucher/domain-cert-revocation-checks" {
        description "The domain-cert-revocation-checks field
                     is not valid in a voucher request, and
                     any occurance MUST be ignored";
      }

      refine "voucher/assertion" {
        mandatory false;
        description "Any assertion included in voucher
              requests SHOULD be ignored by the MASA.";
      }

      augment "voucher"  {
        description
          "Adds leaf nodes appropriate for requesting vouchers.";

        leaf prior-signed-voucher-request {
          type binary;
          description
            "If it is necessary to change a voucher, or re-sign and
             forward a voucher that was previously provided along a
             protocol path, then the previously signed voucher SHOULD be
             included in this field.

             For example, a pledge might sign a voucher request
             with a proximity-registrar-cert, and the registrar
             then includes it in the prior-signed-voucher-request field.
             This is a simple mechanism for a chain of trusted
             parties to change a voucher request, while
             maintaining the prior signature information.

             The Registrar and MASA MAY examine the prior signed
             voucher information for the
             purposes of policy decisions. For example this information
             could be useful to a MASA to determine that both pledge and
             registrar agree on proximity assertions. The MASA SHOULD
             remove all prior-signed-voucher-request information when
             signing a voucher for imprinting so as to minimize the
             final voucher size.";
        }

        leaf proximity-registrar-cert {
          type binary;
          description
            "An X.509 v3 certificate structure as specified by RFC 5280,
             Section 4 encoded using the ASN.1 distinguished encoding
             rules (DER), as specified in ITU-T X.690.

             The first certificate in the Registrar TLS server
             certificate_list sequence  (see [RFC5246]) presented by
             the Registrar to the Pledge. This MUST be populated in a
             Pledge's voucher request if a proximity assertion is
             requested.";
        }
      }
    }
  }

}

&lt;CODE ENDS&gt;
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#proxydetails" id="proxydetails">Proxying details (Pledge - Proxy - Registrar)</a>
</h1>
<p id="rfc.section.4.p.1">The role of the proxy is to facilitate communications. The proxy forwards packets between the pledge and a registrar that has been provisioned to the proxy via GRASP discovery.  </p>
<p id="rfc.section.4.p.2">This section defines a stateful proxy mechanism which is refered to as a "circuit" proxy.  </p>
<p id="rfc.section.4.p.3">The proxy does not terminate the TLS handshake: it passes streams of bytes onward without examination.  A proxy MUST NOT assume any specific TLS version.  </p>
<p id="rfc.section.4.p.4">A Registrar can directly provide the proxy announcements described below, in which case the announced port can point directly to the Registrar itself.  In this scenario the pledge is unaware that there is no proxing occuring.  This is useful for Registrars servicing pledges on directly connected networks.  </p>
<p id="rfc.section.4.p.5">As a result of the proxy Discovery process in <a href="#brskigrasp" class="xref">Section 4.1.1</a>, the port number exposed by the proxy does not need to be well known, or require an IANA allocation.  </p>
<p id="rfc.section.4.p.6">During the discovery of the Registrar by the Join Proxy, the Join Proxy will also learn which kinds of proxy mechanisms are available.  This will allow the Join Proxy to use the lowest impact mechanism which the Join Proxy and Registrar have in common.  </p>
<p id="rfc.section.4.p.7">In order to permit the proxy functionality to be implemented on the maximum variety of devices the chosen mechanism SHOULD use the minimum amount of state on the proxy device. While many devices in the ANIMA target space will be rather large routers, the proxy function is likely to be implemented in the control plane CPU of such a device, with available capabilities for the proxy function similar to many class 2 IoT devices.  </p>
<p id="rfc.section.4.p.8">The document <a href="#I-D.richardson-anima-state-for-joinrouter" class="xref">[I-D.richardson-anima-state-for-joinrouter]</a> provides a more extensive analysis and background of the alternative proxy methods.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#discovery" id="discovery">Pledge discovery of Proxy</a>
</h1>
<p id="rfc.section.4.1.p.1">The result of discovery is a logical communication with a registrar, through a proxy.  The proxy is transparent to the pledge.  The communication between the pledge is over IPv6 Link-Local addresses.  </p>
<p id="rfc.section.4.1.p.2">To discover the proxy the pledge performs the following actions:</p>
<p><a href="#ProtocolDetails" class="xref">Section 5</a>.  </p>

<ol>
<li>MUST: Obtains a local address using IPv6 methods as described in <a href="#RFC4862" class="xref">[RFC4862]</a> IPv6 Stateless Address AutoConfiguration.  Use of <a href="#RFC4941" class="xref">[RFC4941]</a> temporary addresses is encouraged.  To limit pervasive monitoring ( <a href="#RFC7258" class="xref">[RFC7258]</a>), a new temporary address MAY use a short lifetime (that is, set TEMP_PREFERRED_LIFETIME to be short).  Pledges will generally prefer use of IPv6 Link-Local addresses, and discovery of proxy will be by Link-Local mechanisms.  IPv4 methods are described in <a href="#IPv4operations" class="xref">Appendix A</a>
</li>
<li>MUST: Listen for GRASP M_FLOOD (<a href="#I-D.ietf-anima-grasp" class="xref">[I-D.ietf-anima-grasp]</a>) announcements of the objective: "AN_Proxy".  See section <a href="#brskigrasp" class="xref">Section 4.1.1</a> for the details of the objective.  The pledge MAY listen concurrently for other sources of information, see <a href="#mdnsmethods" class="xref">Appendix B</a>.  </li>
</ol>

<p> Once a proxy is discovered the pledge communicates with a registrar through the proxy using the bootstrapping protocol defined in </p>
<p id="rfc.section.4.1.p.4">While the GRASP M_FLOOD mechanism is passive for the pledge, the optional other methods (mDNS, and IPv4 methods) are active.  The pledge SHOULD run those methods in parallel with listening to for the M_FLOOD.  The active methods SHOULD exponentially back-off to a maximum of one hour to avoid overloading the network with discovery attempts.  Detection of change of physical link status (ethernet carrier for instance) SHOULD reset the exponential back off.  </p>
<p id="rfc.section.4.1.p.5">The pledge could discover more than one proxy on a given physical interface.  The pledge can have a multitude of physical interfaces as well: a layer-2/3 ethernet switch may have hundreds of physical ports.  </p>
<p id="rfc.section.4.1.p.6">Each possible proxy offer SHOULD be attempted up to the point where a voucher is received: while there are many ways in which the attempt may fail, it does not succeed until the voucher has been validated.  </p>
<p id="rfc.section.4.1.p.7">The connection attempts via a single proxy SHOULD exponentially back-off to a maximum of one hour to avoid overloading the network infrastructure.   The back-off timer for each  MUST be independent of other connection attempts.  </p>
<p id="rfc.section.4.1.p.8">Connection attempts SHOULD be run in parallel to avoid head of queue problems wherein an attacker running a fake proxy or registrar could perform protocol actions intentionally slowly.  The pledge SHOULD continue to listen to for additional GRASP M_FLOOD messages during the connection attempts.  </p>
<p id="rfc.section.4.1.p.9">Once a connection to a registrar is established (e.g. establishment of a TLS session key) there are expectations of more timely responses, see <a href="#RequestVoucherFromRegistrar" class="xref">Section 5.2</a>.  </p>
<p id="rfc.section.4.1.p.10">Once all discovered services are attempted (assuming that none succeeded) the device MUST return to listening for GRASP M_FLOOD.  It SHOULD periodically retry the manufacturer specific mechanisms.  The pledge MAY prioritize selection order as appropriate for the anticipated environment.  </p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#brskigrasp" id="brskigrasp">Proxy GRASP announcements</a>
</h1>
<pre>
[M_FLOOD, 12340815, h'fe800000000000000000000000000001', 180000,
            ["AN_Proxy", 4, 1, ""],
            [O_IPv6_LOCATOR,
              h'fe800000000000000000000000000001', IPPROTO_TCP, 4443]]
</pre>
<p id="rfc.section.4.1.1.p.1">A proxy uses the DULL GRASP M_FLOOD mechanism to announce itself.  This announcement can be within the same message as the ACP announcement detailed in <a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">[I-D.ietf-anima-autonomic-control-plane]</a>.  The M_FLOOD is formatted as follows: </p>

<p>Figure 6b: Proxy Discovery</p>
<pre>
flood-message = [M_FLOOD, session-id, initiator, ttl,
                 +[objective, (locator-option / [])]]

objective = ["AN_Proxy", objective-flags, loop-count,
                                       objective-value]

ttl             = 180000     ; 180,000 ms (3 minutes)
initiator = ACP address to contact Registrar
objective-flags   = sync-only  ; as in GRASP spec
sync-only         =  4         ; M_FLOOD only requires synchronization
loop-count        =  1         ; one hop only
objective-value   =  any       ; none

locator-option    = [ O_IPv6_LOCATOR, ipv6-address,
                    transport-proto, port-number ]
ipv6-address      = the v6 LL of the Proxy
transport-proto /= IPPROTO_TCP   ; note this can be any value from the
                                 ; IANA protocol registry, as per
                                 ; [GRASP] section 2.9.5.1, note 3.
port-number      = selected by Proxy
</pre>
<p id="rfc.section.4.1.1.p.2">The formal CDDL <a href="#I-D.ietf-cbor-cddl" class="xref">[I-D.ietf-cbor-cddl]</a> definition is: </p>

<p>Figure 6c: AN_Proxy CDDL</p>
<p id="rfc.section.4.1.1.p.3">On a small network the Registrar MAY include the GRASP M_FLOOD announcements to locally connected networks.  </p>
<p id="rfc.section.4.1.1.p.4">The $transport-proto above indicates the method that the pledge-proxy-registrar will use.  The TCP method described here is mandatory, and other proxy methods, such as CoAP methods not defined in this document are optional. Other methods MUST NOT be enabled unless the Join Registrar ASA indicates support for them in it's own announcement.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#coapconnection" id="coapconnection">CoAP connection to Registrar</a>
</h1>
<p id="rfc.section.4.2.p.1">The use of CoAP to connect from pledge to registrar is out of scope for this document, and is described in future work. See <a href="#I-D.ietf-anima-constrained-voucher" class="xref">[I-D.ietf-anima-constrained-voucher]</a>.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#JRCgrasp" id="JRCgrasp">Proxy discovery and communication of Registrar</a>
</h1>
<p id="rfc.section.4.3.p.1">The registrar SHOULD announce itself so that proxies can find it and determine what kind of connections can be terminated.  </p>
<p id="rfc.section.4.3.p.2">The registrar announces itself using ACP instance of GRASP using M_FLOOD messages.  ANI proxies MUST support GRASP discovery of registrars.  </p>
<pre>
[M_FLOOD, 12340815, h'fda379a6f6ee00000200000064000001', 180000,
            ["AN_join_registrar", 4, 255, "EST-TLS"],
            [O_IPv6_LOCATOR,
              h'fda379a6f6ee00000200000064000001', IPPROTO_TCP, 80]]
</pre>
<p id="rfc.section.4.3.p.3">The M_FLOOD is formatted as follows: </p>

<p>Figure 7a: Registrar Discovery</p>
<pre>
flood-message = [M_FLOOD, session-id, initiator, ttl,
                 +[objective, (locator-option / [])]]

objective = ["AN_join_registrar", objective-flags, loop-count,
                                       objective-value]

initiator = ACP address to contact Registrar
objective-flags = sync-only  ; as in GRASP spec
sync-only =  4               ; M_FLOOD only requires synchronization
loop-count      = 255        ; mandatory maximum
objective-value = text       ; name of the (list of) of supported
                             ; protocols: "EST-TLS" for RFC7030.
</pre>
<p id="rfc.section.4.3.p.4">The formal CDDL definition is: </p>

<p>Figure 7: AN_join_registrar CDDL</p>
<p id="rfc.section.4.3.p.5">The M_FLOOD message MUST be sent periodically.  The period is subject to network administrator policy (EST server configuration).  It must be sufficiently low that the aggregate amount of periodic M_FLOODs from all EST servers causes negligible traffic across the ACP.  </p>
<pre>
locator1  = [O_IPv6_LOCATOR, fd45:1345::6789, 6,  443]
locator2  = [O_IPv6_LOCATOR, fd45:1345::6789, 17, 5683]
locator3  = [O_IPv6_LOCATOR, fe80::1234, 41, nil]</pre>
<p id="rfc.section.4.3.p.6">Here are some examples of locators for illustrative purposes.  Only the first one (transport-protocol = 6, TCP) is defined in this document and is mandatory to implement.  </p>
<p id="rfc.section.4.3.p.7">A protocol of 6 indicates that TCP proxying on the indicated port is desired.  </p>
<p id="rfc.section.4.3.p.8">Registrars MUST announce the set of protocols that they support.  They MUST support TCP traffic.  </p>
<p id="rfc.section.4.3.p.9">Registrars MUST accept HTTPS/EST traffic on the TCP ports indicated.  </p>
<p id="rfc.section.4.3.p.10">Registrars MUST support ANI TLS circuit proxy and therefore BRSKI across HTTPS/TLS native across the ACP.  </p>
<p id="rfc.section.4.3.p.11">In the ANI, the Autonomic Control Plane (ACP) secured instance of GRASP (<a href="#I-D.ietf-anima-grasp" class="xref">[I-D.ietf-anima-grasp]</a>) MUST be used for discovery of ANI registrar ACP addresses and ports by ANI proxies.  The TCP leg of the proxy connection between ANI proxy and ANI registrar therefore also runs across the ACP.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#ProtocolDetails" id="ProtocolDetails">Protocol Details (Pledge - Registrar - MASA)</a>
</h1>
<p id="rfc.section.5.p.1">The pledge MUST initiate BRSKI after boot if it is unconfigured.  The pledge MUST NOT automatically initiate BRSKI if it has been configured or is in the process of being configured.</p>
<p id="rfc.section.5.p.2">BRSKI is described as extensions to EST <a href="#RFC7030" class="xref">[RFC7030]</a>.  The goal of these extensions is to reduce the number of TLS connections and crypto operations required on the pledge.  The registrar implements the BRSKI REST interface within the same "/.well-known" URI tree as the existing EST URIs as described in EST <a href="#RFC7030" class="xref">[RFC7030]</a> section 3.2.2. The communication channel between the pledge and the registrar is referred to as "BRSKI-EST" (see Figure 1).  </p>
<p id="rfc.section.5.p.3">The communication channel between the registrar and MASA is similarly described as extensions to EST within the same "/.well-known" tree. For clarity this channel is referred to as "BRSKI-MASA". (See Figure 1).</p>
<p id="rfc.section.5.p.4">MASA URI is "https://" iauthority "/.well-known/est".</p>
<p id="rfc.section.5.p.5">BRSKI uses existing CMS message formats for existing EST operations.  BRSKI uses JSON <a href="#RFC7159" class="xref">[RFC7159]</a> for all new operations defined here, and voucher formats.  </p>
<p id="rfc.section.5.p.6">While EST section 3.2 does not insist upon use of HTTP 1.1 persistent connections, BRSKI-EST connections SHOULD use persistent connections.  The intention of this guidance is to ensure the provisional TLS state occurs only once, and that the subsequent resolution of the provision state is not subject to a MITM attack during a critical phase.  </p>
<p id="rfc.section.5.p.7">Summarized automation extensions for the BRSKI-EST flow are:</p>
<p></p>

<ul>
<li>The pledge either attempts concurrent connections via each discovered proxy, or it times out quickly and tries connections in series, as explained at the end of <a href="#brskiesttls" class="xref">Section 5.1</a>.  </li>
<li>The pledge provisionally accepts the registrar certificate during the TLS handshake as detailed in <a href="#brskiesttls" class="xref">Section 5.1</a>.  </li>
<li>The pledge requests and validates a voucher using the new REST calls described below.  </li>
<li>The pledge completes authentication of the server certificate as detailed in <a href="#CompletingAuthenticationBootstrapping" class="xref">Section 5.6.1</a>. This moves the BRSKI-EST TLS connection out of the provisional state.  </li>
<li>Mandatory boostrap steps conclude with voucher status telemetry (see <a href="#pledgestatus" class="xref">Section 5.7</a>).  </li>
</ul>
<p id="rfc.section.5.p.9">The BRSKI-EST TLS connection can now be used for EST enrollment.  </p>
<p id="rfc.section.5.p.10">The extensions for a registrar (equivalent to EST server) are:</p>
<p></p>

<ul>
<li>Client authentication is automated using Initial Device Identity (IDevID) as per the EST certificate based client authentication.  The subject field's DN encoding MUST include the "serialNumber" attribute with the device's unique serial number.  </li>
<li>In the language of <a href="#RFC6125" class="xref">[RFC6125]</a> this provides for a SERIALNUM-ID category of identifier that can be included in a certificate and therefore that can also be used for matching purposes. The SERIALNUM-ID whitelist is collated according to manufacturer trust anchor since serial numbers are not globally unique.  </li>
<li>The registrar requests and validates the voucher from the MASA.</li>
<li>The registrar forwards the voucher to the pledge when requested.</li>
<li>The registrar performs log verifications in addition to local authorization checks before accepting optional pledge device enrollment requests.</li>
</ul>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#brskiesttls" id="brskiesttls">BRSKI-EST TLS establishment details</a>
</h1>
<p id="rfc.section.5.1.p.1">The pledge establishes the TLS connection with the registrar through the circuit proxy (see <a href="#proxydetails" class="xref">Section 4</a>) but the TLS handshake is with the registrar. The BRSKI-EST pledge is the TLS client and the BRSKI-EST registrar is the TLS server.  All security associations established are between the pledge and the registrar regardless of proxy operations.</p>
<p id="rfc.section.5.1.p.2">Establishment of the BRSKI-EST TLS connection is as specified in EST <a href="#RFC7030" class="xref">[RFC7030]</a> section 4.1.1 "Bootstrap Distribution of CA Certificates" <a href="#RFC7030" class="xref">[RFC7030]</a> wherein the client is authenticated with the IDevID certificate, and the EST server (the registrar) is provisionally authenticated with an unverified server certificate.</p>
<p id="rfc.section.5.1.p.3">The pledge maintains a security paranoia concerning the provisional state, and all data received, until a voucher is received and verified as specified in <a href="#CompletingAuthenticationBootstrapping" class="xref">Section 5.6.1</a></p>
<p id="rfc.section.5.1.p.4">A Pledge that can connect to multiple registries concurrently, SHOULD do so.  Some devices may be unable to do so for lack of threading, or resource issues.   Concurrent connections defeat atttempts by a malicious proxy from causing a TCP Slowloris-like attack (see <a href="#slowloris" class="xref">[slowloris]</a>).  </p>
<p id="rfc.section.5.1.p.5">A pledge that can not maintain as many connections as there are eligible proxies.  If no connection is making process after 5 seconds then the pledge SHOULD drop the oldest connection and go on to a different proxy: the proxy that has been communicated with least recently.  If there were no other proxies discovered, the pledge MAY continue to wait, as long as it is concurrently listening for new proxy announcements.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#RequestVoucherFromRegistrar" id="RequestVoucherFromRegistrar">Pledge Requests Voucher from the Registrar</a>
</h1>
<p id="rfc.section.5.2.p.1">When the pledge bootstraps it makes a request for a voucher from a registrar.</p>
<p id="rfc.section.5.2.p.2">This is done with an HTTPS POST using the operation path value of "/.well-known/est/requestvoucher".</p>
<p id="rfc.section.5.2.p.3">The request media types are:</p>
<p></p>

<dl>
<dt>application/voucher-cms+json</dt>
<dd style="margin-left: 8">The request is a "YANG-defined JSON document that has been signed using a CMS structure" as described in <a href="#voucher-request" class="xref">Section 3</a> using the JSON encoding described in <a href="#RFC7951" class="xref">[RFC7951]</a>.  The pledge SHOULD sign the request using the <a href="#IDevIDextension" class="xref">Section 2.3</a> credential.  </dd>
<dt>application/json</dt>
<dd style="margin-left: 8">The request is the "YANG-defined JSON document" as described in <a href="#voucher-request" class="xref">Section 3</a> with the exception that it is not within a CMS structure. It is protected only by the TLS client authentication.  This reduces the cryptographic requirements on the pledge.</dd>
</dl>
<p id="rfc.section.5.2.p.5">For simplicity the term 'voucher-request' is used to refer to either of these media types. Registrar impementations SHOULD anticipate future media types but of course will simply fail the request if those types are not yet known.</p>
<p id="rfc.section.5.2.p.6">The pledge populates the voucher-request fields as follows:</p>
<p></p>

<dl>
<dt>created-on:</dt>
<dd style="margin-left: 8">Pledges that have a realtime clock are RECOMMENDED to populate this field. This provides additional information to the MASA.</dd>
<dt>nonce:</dt>
<dd style="margin-left: 8">The pledge voucher-request MUST contain a cryptographically strong random or pseudo-random number nonce. (see <a href="#RFC4086" class="xref">[RFC4086]</a>) Doing so ensures <a href="#timeunknown" class="xref">Section 2.6.1</a> functionality. The nonce MUST NOT be reused for multiple bootstrapping attempts. (The registrar voucher-request MAY omit the nonce as per <a href="#noncelessVoucherRequest" class="xref">Section 3.1</a>) </dd>
<dt>proximity-registrar-cert:</dt>
<dd style="margin-left: 8">In a pledge voucher-request this is the first certificate in the TLS server 'certificate_list' sequence (see [RFC5246]) presented by the registrar to the pledge. This MUST be populated in a pledge voucher-request if the "proximity" assertion is populated.</dd>
</dl>
<p id="rfc.section.5.2.p.8">All other fields MAY be omitted in the pledge voucher-request.</p>
<p id="rfc.section.5.2.p.9">An example JSON payload of a pledge voucher-request is in <a href="#voucher-request-examples" class="xref">Section 3.3</a> Example 1.</p>
<p id="rfc.section.5.2.p.10">The registrar validates the client identity as described in EST <a href="#RFC7030" class="xref">[RFC7030]</a> section 3.3.2. If the request is signed the registrar confirms that the associated 'proximity-registrar-cert' is correct.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#pledgeauthorization" id="pledgeauthorization">Registrar Authorization of                                                    Pledge</a>
</h1>
<p id="rfc.section.5.3.p.1">In a fully automated network all devices must be securely identified and authorized to join the domain.  </p>
<p id="rfc.section.5.3.p.2">A Registrar accepts or declines a request to join the domain, based on the authenticated identity presented.  Automated acceptance criteria include:</p>

<ul>
<li>allow any device of a specific type (as determined by the X.509 IDevID),</li>
<li>allow any device from a specific vendor (as determined by the X.509 IDevID),</li>
<li>allow a specific device from a vendor (as determined by the X.509 IDevID) against a domain white list.  (The mechanism for checking a shared white list potentially used by multiple Registrars is out of scope).</li>
</ul>

<p> </p>
<p id="rfc.section.5.3.p.3">If these validations fail the registrar SHOULD respond with an appropriate HTTP error code.  </p>
<p id="rfc.section.5.3.p.4">If authorization is successful the registrar obtains a voucher from the MASA service (see <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>) and returns that MASA signed voucher to the pledge as described in <a href="#VoucherResponse" class="xref">Section 5.6</a>.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#brskimasatls" id="brskimasatls">BRSKI-MASA TLS establishment details</a>
</h1>
<p id="rfc.section.5.4.p.1">The BRSKI-MASA TLS connection is a 'normal' TLS connection appropriate for HTTPS REST interfaces. The registrar initiates the connection and uses the MASA URL obtained as described in <a href="#obtainmasaurl" class="xref">Section 2.8</a> for <a href="#RFC6125" class="xref">[RFC6125]</a> authentication of the MASA.  </p>
<p id="rfc.section.5.4.p.2">The primary method of registrar "authentication" by the MASA is detailed in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>. As detailed in <a href="#securityconsiderations" class="xref">Section 10</a> the MASA might find it necessary to request additional registrar authentication.  </p>
<p id="rfc.section.5.4.p.3">The MASA and the registrars SHOULD be prepared to support TLS client certificate authentication and/or HTTP Basic or Digest authentication as described in RFC7030 for EST clients.  This connection MAY also have no client authentication at all (<a href="#masasecurityreductions" class="xref">Section 6.4</a>) </p>
<p id="rfc.section.5.4.p.4">The authentication of the BRSKI-MASA connection does not affect the voucher-request process, as voucher-requests are already signed by the registrar.  Instead, this authentication provides access control to the audit log.  </p>
<p id="rfc.section.5.4.p.5">Implementors are advised that contacting the MASA is to establish a secured REST connection with a web service and that there are a number of authentication models being explored within the industry. Registrars are RECOMMENDED to fail gracefully and generate useful administrative notifications or logs in the advent of unexpected HTTP 401 (Unauthorized) responses from the MASA.  </p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#RequestVoucherFromMASA" id="RequestVoucherFromMASA">Registrar Requests Voucher from MASA</a>
</h1>
<p id="rfc.section.5.5.p.1">When a registrar receives a pledge voucher-request it in turn submits a registrar voucher-request to the MASA service via an HTTPS RESTful interface (<a href="#RFC7231" class="xref">[RFC7231]</a>).  </p>
<p id="rfc.section.5.5.p.2">This is done with an HTTP POST using the operation path value of "/.well-known/est/requestvoucher".</p>
<p id="rfc.section.5.5.p.3">The request media type is defined in <a href="#RFC8366" class="xref">[RFC8366]</a> and is application/voucher-cms+json. It is a JSON document that has been signed using a CMS structure.  The registrar MUST sign the registrar voucher-request. The entire registrar certificate chain, up to and including the Domain CA, MUST be included in the CMS structure.  </p>
<p id="rfc.section.5.5.p.4">MASA impementations SHOULD anticipate future media types but of course will simply fail the request if those types are not yet known.</p>
<p id="rfc.section.5.5.p.5">The registrar populates the voucher-request fields as follows:</p>
<p></p>

<dl>
<dt>created-on:</dt>
<dd style="margin-left: 8">Registrars are RECOMMENDED to populate this field. This provides additional information to the MASA.</dd>
<dt>nonce:</dt>
<dd style="margin-left: 8">This is the value from the pledge voucher-request. The registrar voucher-request MAY omit the nonce as per <a href="#noncelessVoucherRequest" class="xref">Section 3.1</a>) </dd>
<dt>serial-number:</dt>
<dd style="margin-left: 8">The serial number of the pledge the registrar would like a voucher for. The registrar determines this value by parsing the authenticated pledge IDevID certificate. See <a href="#IDevIDextension" class="xref">Section 2.3</a>.  The registrar MUST verify that the serial number field it parsed matches the serial number field the pledge provided in its voucher-request. This provides a sanity check useful for detecting error conditions and logging.  The registrar MUST NOT simply copy the serial number field from a pledge voucher request as that field is claimed but not certified.</dd>
<dt>idevid-issuer:</dt>
<dd style="margin-left: 8">The idevid-issuer value from the pledge certificate is included to ensure a statistically unique identity.</dd>
<dt>prior-signed-voucher-request:</dt>
<dd style="margin-left: 8">If a signed pledge voucher-request was received then it SHOULD be included in the registrar voucher-request.  (NOTE: what is included is the complete pledge voucher-request, inclusive of the 'assertion', 'proximity-registrar-cert', etc wrapped by the pledge's original signature). If a signed voucher-request was not recieved from the pledge then this leaf is omitted from the registrar voucher request.</dd>
</dl>
<p id="rfc.section.5.5.p.7">A nonceless registrar voucher-request MAY be submitted to the MASA. Doing so allows the registrar to request a voucher when the pledge is offline, or when the registrar anticipates not being able to connect to the MASA while the pledge is being deployed. Some use cases require the registrar to learn the appropriate IDevID SerialNumber field from the physical device labeling or from the sales channel (out-of-scope for this document).  </p>
<p id="rfc.section.5.5.p.8">All other fields MAY be omitted in the registrar voucher-request.</p>
<p id="rfc.section.5.5.p.9">Example JSON payloads of registrar voucher-requests are in <a href="#voucher-request-examples" class="xref">Section 3.3</a> Examples 2 through 4.</p>
<p id="rfc.section.5.5.p.10">The MASA verifies that the registrar voucher-request is internally consistent but does not necessarily authenticate the registrar certificate since the registrar is not known to the MASA in advance. The MASA performs the actions and validation checks described in the following sub-sections before issuing a voucher.</p>
<h1 id="rfc.section.5.5.1">
<a href="#rfc.section.5.5.1">5.5.1.</a> MASA renewal of expired vouchers</h1>
<p id="rfc.section.5.5.1.p.1">As described in <a href="#RFC8366" class="xref">[RFC8366]</a> vouchers are normally short lived to avoid revocation issues. If the request is for a previous (expired) voucher using the same registrar then the request for a renewed voucher SHOULD be automatically authorized. The MASA has sufficient information to determine this by examining the request, the registrar authentication, and the existing audit log. The issuance of a renewed voucher is logged as detailed in <a href="#VoucherResponse" class="xref">Section 5.6</a>.  </p>
<p id="rfc.section.5.5.1.p.2">To inform the MASA that existing vouchers are not to be renewed one can update or revoke the registrar credentials used to authorize the request (see <a href="#MASAauthenticationOfRegistrar" class="xref">Section 5.5.3</a> and <a href="#revocationcheck" class="xref">Section 5.5.4</a>). More flexible methods will likely involve sales channel integration and authorizations (details are out-of-scope of this document).</p>
<h1 id="rfc.section.5.5.2">
<a href="#rfc.section.5.5.2">5.5.2.</a> <a href="#MASAsignatureconsistency" id="MASAsignatureconsistency">MASA verification of voucher-request signature consistency</a>
</h1>
<p id="rfc.section.5.5.2.p.1">The MASA MUST verify that the registrar voucher-request is signed by a registrar. This is confirmed by verifying that the id-kp-cmcRA extended key usage extension field (as detailed in EST RFC7030 section 3.6.1) exists in the certificate of the entity that signed the registrar voucher-request. This verification is only a consistency check that the unauthenticated domain CA intended the voucher-request signer to be a registrar. Performing this check provides value to the domain PKI by assuring the domain administrator that the MASA service will only respect claims from authorized Registration Authorities of the domain.</p>
<p id="rfc.section.5.5.2.p.2">The MASA verifies that the domain CA certificate is included in the CMS structure as detailed in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>.  </p>
<h1 id="rfc.section.5.5.3">
<a href="#rfc.section.5.5.3">5.5.3.</a> <a href="#MASAauthenticationOfRegistrar" id="MASAauthenticationOfRegistrar">MASA authentication of registrar (certificate)</a>
</h1>
<p id="rfc.section.5.5.3.p.1">If a nonceless voucher-request is submitted the MASA MUST authenticate the registrar as described in either EST <a href="#RFC7030" class="xref">[RFC7030]</a> section 3.2, section 3.3, or by validating the registrar's certificate used to sign the registrar voucher-request.  Any of these methods reduce the risk of DDoS attacks and provide an authenticated identity as an input to sales channel integration and authorizations (details are out-of-scope of this document).  </p>
<p id="rfc.section.5.5.3.p.2">In the nonced case, validation of the registrar MAY be omitted if the device policy is to accept audit-only vouchers.  </p>
<h1 id="rfc.section.5.5.4">
<a href="#rfc.section.5.5.4">5.5.4.</a> <a href="#revocationcheck" id="revocationcheck">MASA revocation checking of registrar (certificate)</a>
</h1>
<p id="rfc.section.5.5.4.p.1">As noted in <a href="#MASAauthenticationOfRegistrar" class="xref">Section 5.5.3</a> the MASA performs registrar authentication in a subset of situations (e.g. nonceless voucher requests). Normal PKIX revocation checking is assumed during either EST client authentication or voucher-request signature validation. Similarly, as noted in <a href="#MASAsignatureconsistency" class="xref">Section 5.5.2</a>, the MASA performs normal PKIX revocation checking during signature consistency checks (a signature by a registrar certificate that has been revoked is an inconsistency).</p>
<h1 id="rfc.section.5.5.5">
<a href="#rfc.section.5.5.5">5.5.5.</a> <a href="#MASAassertion" id="MASAassertion">MASA verification of pledge prior-signed-voucher-request</a>
</h1>
<p id="rfc.section.5.5.5.p.1">The MASA MAY verify that the registrar voucher-request includes the 'prior-signed-voucher-request' field. If so the prior-signed-voucher-request MUST include a 'proximity-registrar-cert' that is consistent with the certificate used to sign the registrar voucher-request. Additionally the voucher-request serial-number leaf MUST match the pledge serial-number that the MASA extracts from the signing certificate of the prior-signed-voucher-request.  The MASA is aware of which pledges support signing of their voucher requests and can use this information to confirm proximity of the pledge with the registrar, thus ensuring that the BRSKI-EST TLS connection has no man-in-the-middle.</p>
<p id="rfc.section.5.5.5.p.2">If these checks succeed the MASA updates the voucher and audit log assertion leafs with the "proximity" assertion.</p>
<h1 id="rfc.section.5.5.6">
<a href="#rfc.section.5.5.6">5.5.6.</a> <a href="#MASApinned" id="MASApinned">MASA pinning of registrar</a>
</h1>
<p id="rfc.section.5.5.6.p.1">The registrar's certificate chain is extracted from the signature method. The chain includes the domain CA certificate as specified in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a>. This certificate is used to populate the "pinned-domain-cert" of the voucher being issued. The domainID (e.g., hash of the root public key) is determined from the pinned-domain-cert and is used to update the audit log.  </p>
<h1 id="rfc.section.5.5.7">
<a href="#rfc.section.5.5.7">5.5.7.</a> <a href="#MASAnoncehandling" id="MASAnoncehandling">MASA nonce handling</a>
</h1>
<p id="rfc.section.5.5.7.p.1">The MASA does not verify the nonce itself.  If the registrar voucher-request contains a nonce, and the prior-signed-voucher-request is exist, then the MASA MUST verify that the nonce is consistent.  (Recall from above that the voucher-request might not contain a nonce, see <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> and <a href="#MASAauthenticationOfRegistrar" class="xref">Section 5.5.3</a>).  </p>
<p id="rfc.section.5.5.7.p.2">The MASA MUST use the nonce from the registrar voucher-request for the resulting voucher and audit log. The prior-signed-voucher-request nonce is ignored during this operation.</p>
<h1 id="rfc.section.5.6">
<a href="#rfc.section.5.6">5.6.</a> <a href="#VoucherResponse" id="VoucherResponse">MASA and Registrar Voucher Response</a>
</h1>
<p id="rfc.section.5.6.p.1">The MASA voucher response to the registrar is forwarded without changes to the pledge; therefore this section applies to both the MASA and the registrar. The HTTP signaling described applies to both the MASA and registrar responses. A registrar either caches prior MASA responses or dynamically requests a new voucher based on local policy (it does not generate or sign a voucher).</p>
<p id="rfc.section.5.6.p.2">If the voucher-request is successful, the server (MASA responding to registrar or registrar responding to pledge) response MUST contain an HTTP 200 response code. The server MUST answer with a suitable 4xx or 5xx HTTP [RFC2616] error code when a problem occurs.  In this case, the response data from the MASA MUST be a plaintext human-readable (ASCII, English) error message containing explanatory information describing why the request was rejected.</p>
<p id="rfc.section.5.6.p.3">The registrar MAY respond with an HTTP 202 ("the request has been accepted for processing, but the processing has not been completed") as described in EST <a href="#RFC7030" class="xref">[RFC7030]</a> section 4.2.3 wherein the client "MUST wait at least the specified 'Retry-After' time before repeating the same request".  (see <a href="#RFC7231" class="xref">[RFC7231]</a> section 6.6.4) The pledge is RECOMMENDED to provide local feedback (blinked LED etc) during this wait cycle if mechanisms for this are available. To prevent an attacker registrar from significantly delaying bootstrapping the pledge MUST limit the 'Retry-After' time to 60 seconds. Ideally the pledge would keep track of the appropriate Retry-After header values for any number of outstanding registrars but this would involve a state table on the pledge.  Instead the pledge MAY ignore the exact Retry-After value in favor of a single hard coded value (a registrar that is unable to complete the transaction after the first 60 seconds has another chance a minute later). A pledge SHOULD only maintain a 202 retry-state for up to 4 days, which is longer than a long weekend, after which time the enrollment attempt fails and the pledge returns to discovery state.  </p>
<p id="rfc.section.5.6.p.4">In order to avoid infinite redirect loops, which a malicious registrar might do in order to keep the pledge from discovering the correct registrar, the pledge MUST NOT follow more than one redirection (3xx code) to another web origins. EST supports redirection but requires user input; this change allows the pledge to follow a single redirection without a user interaction.  </p>
<p id="rfc.section.5.6.p.5">A 403 (Forbidden) response is appropriate if the voucher-request is not signed correctly, stale, or if the pledge has another outstanding voucher that cannot be overridden.</p>
<p id="rfc.section.5.6.p.6">A 404 (Not Found) response is appropriate when the request is for a device that is not known to the MASA.</p>
<p id="rfc.section.5.6.p.7">A 406 (Not Acceptable) response is appropriate if a voucher of the desired type or using the desired algorithms (as indicated by the Accept: headers, and algorithms used in the signature) cannot be issued such as because the MASA knows the pledge cannot process that type. The registrar SHOULD use this response if it determines the pledge is unacceptable due to inventory control, MASA audit logs, or any other reason.</p>
<p id="rfc.section.5.6.p.8">A 415 (Unsupported Media Type) response is approriate for a request that has a voucher encoding that is not understood.</p>
<p id="rfc.section.5.6.p.9">The response media type is:</p>
<p></p>

<dl>
<dt>application/voucher-cms+json</dt>
<dd style="margin-left: 8">The response is a "YANG-defined JSON document that has been signed using a CMS structure" as described in <a href="#RFC8366" class="xref">[RFC8366]</a> using the JSON encoded described in <a href="#RFC7951" class="xref">[RFC7951]</a>.  The MASA MUST sign the response.</dd>
</dl>
<p id="rfc.section.5.6.p.11">The syntactic details of vouchers are described in detail in <a href="#RFC8366" class="xref">[RFC8366]</a>. For example, the voucher consists of: </p>
<pre>
{
  "ietf-voucher:voucher": {
    "nonce": "62a2e7693d82fcda2624de58fb6722e5",
    "assertion": "logging"
    "pinned-domain-cert": "base64encodedvalue=="
    "serial-number": "JADA123456789"
  }
}
</pre>
<p id="rfc.section.5.6.p.12">The MASA populates the voucher fields as follows:</p>
<p></p>

<dl>
<dt>nonce:</dt>
<dd style="margin-left: 8">The nonce from the pledge if available. See <a href="#MASAnoncehandling" class="xref">Section 5.5.7</a>.</dd>
<dt>assertion:</dt>
<dd style="margin-left: 8">The method used to verify assertion. See <a href="#MASAassertion" class="xref">Section 5.5.5</a>.</dd>
<dt>pinned-domain-cert:</dt>
<dd style="margin-left: 8">The domain CA cert. See <a href="#MASApinned" class="xref">Section 5.5.6</a>. This figure is illustrative, for an example, see <a href="#exampleprocess" class="xref">Appendix D.2</a>
</dd>
<dt>serial-number:</dt>
<dd style="margin-left: 8">The serial-number as provided in the voucher-request. Also see <a href="#MASAassertion" class="xref">Section 5.5.5</a>.</dd>
<dt>domain-cert-revocation-checks:</dt>
<dd style="margin-left: 8">Set as appropriate for the pledge's capabilities and as documented in <a href="#RFC8366" class="xref">[RFC8366]</a>.  The MASA MAY set this field to 'false' since setting it to 'true' would require that revocation information be available to the pledge and this document does not make normative requirements for <a href="#RFC6961" class="xref">[RFC6961]</a> or equivalent integrations.</dd>
<dt>expires-on:</dt>
<dd style="margin-left: 8">This is set for nonceless vouchers. The MASA ensures the voucher lifetime is consistent with any revocation or pinned-domain-cert consistency checks the pledge might perform.  See section <a href="#timeunknown" class="xref">Section 2.6.1</a>. There are three times to consider: (a) a configured voucher lifetime in the MASA, (b) the expiry time for the registrar's certificate, (c) any certificate revocation information (CRL) lifetime. The expires-on field SHOULD be before the earliest of these three values.  Typically (b) will be some significant time in the future, but (c) will typically be short (on the order of a week or less).  The RECOMMENDED period for (a) is on the order of 20 minutes, so it will typically determine the lifespan of the resulting voucher.  20 minutes is sufficent time to reach the post-provisional state in the pledge, at which point there is an established trust relationship between pledge and registrar.  The subsequent operations can take as long as required from that point onwards.  The lifetime of the voucher has no impact on the lifespan of the ownership relationship.  </dd>
</dl>
<p id="rfc.section.5.6.p.14">Whenever a voucher is issued the MASA MUST update the audit log appropriately.  The internal state requirements to maintain the audit log are out-of-scope. See <a href="#MASAauditlog" class="xref">Section 5.8.1</a> for a discussion of reporting the log to a registrar.</p>
<h1 id="rfc.section.5.6.1">
<a href="#rfc.section.5.6.1">5.6.1.</a> <a href="#CompletingAuthenticationBootstrapping" id="CompletingAuthenticationBootstrapping">Pledge voucher verification</a>
</h1>
<p id="rfc.section.5.6.1.p.1">The pledge MUST verify the voucher signature using the manufacturer installed trust anchor(s) associated with the manufacturer's MASA (this is likely included in the pledge's firmware). Management of the manufacter installed trust anchor(s) is out-of-scope of this document; this protocol does not update these trust anchor(s).</p>
<p id="rfc.section.5.6.1.p.2">The pledge MUST verify the serial-number field of the signed voucher matches the pledge's own serial-number.</p>
<p id="rfc.section.5.6.1.p.3">The pledge MUST verify that the voucher nonce field is accurate and matches the nonce the pledge submitted to this registrar, or that the voucher is nonceless (see <a href="#pledgeReductions" class="xref">Section 6.2</a>).</p>
<p id="rfc.section.5.6.1.p.4">The pledge MUST be prepared to parse and fail gracefully from a voucher response that does not contain a 'pinned-domain-cert' field. The pledge MUST be prepared to ignore additional fields that it does not recognize.  </p>
<h1 id="rfc.section.5.6.2">
<a href="#rfc.section.5.6.2">5.6.2.</a> Pledge authentication of provisional TLS connection</h1>
<p id="rfc.section.5.6.2.p.1">The 'pinned-domain-cert' element of the voucher contains the domain CA's public key. The pledge MUST use the 'pinned-domain-cert' trust anchor to immediately complete authentication of the provisional TLS connection.</p>
<p id="rfc.section.5.6.2.p.2">If a registrar's credentials cannot be verified using the pinned-domain-cert trust anchor from the voucher then the TLS connection is immediately discarded and the pledge abandons attempts to bootstrap with this discovered registrar. The pledge SHOULD send voucher status telemetry (described below) before closing the TLS connection.  The pledge MUST attempt to enroll using any other proxies it has found.  It SHOULD return to the same proxy again after attempting with other proxies.  Attempts should be attempted in the exponential backoff described earlier.  Attempts SHOULD be repeated as failure may be the result of a temporary inconsistently (an inconsistently rolled registrar key, or some other mis-configuration).  The inconsistently could also be the result an active MITM attack on the EST connection.  </p>
<p id="rfc.section.5.6.2.p.3">The registrar MUST use a certificate that chains to the pinned-domain-cert as its TLS server certificate.  </p>
<p id="rfc.section.5.6.2.p.4">The pledge's PKIX path validation of a registrar certificate's validity period information is as described in <a href="#timeunknown" class="xref">Section 2.6.1</a>.  Once the PKIX path validation is successful the TLS connection is no longer provisional.</p>
<p id="rfc.section.5.6.2.p.5">The pinned-domain-cert MAY be installed as an trust anchor for future operations such as enrollment (e.g. <a href="#RFC7030" class="xref">[RFC7030]</a> as recommended) or trust anchor management or raw protocols that do not need full PKI based key management. It can be used to authenticate any dynamically discovered EST server that contain the id-kp-cmcRA extended key usage extension as detailed in EST RFC7030 section 3.6.1; but to reduce system complexity the pledge SHOULD avoid additional discovery operations. Instead the pledge SHOULD communicate directly with the registrar as the EST server. The 'pinned-domain-cert' is not a complete distribution of the <a href="#RFC7030" class="xref">[RFC7030]</a> section 4.1.3 CA Certificate Response, which is an additional justification for the recommendation to proceed with EST key management operations. Once a full CA Certificate Response is obtained it is more authoritative for the domain than the limited 'pinned-domain-cert' response.</p>
<h1 id="rfc.section.5.7">
<a href="#rfc.section.5.7">5.7.</a> <a href="#pledgestatus" id="pledgestatus">Pledge BRSKI Status Telemetry</a>
</h1>
<p id="rfc.section.5.7.p.1">The domain is expected to provide indications to the system administrators concerning device lifecycle status. To facilitate this it needs telemetry information concerning the device's status.</p>
<p id="rfc.section.5.7.p.2">To indicate pledge status regarding the voucher, the pledge MUST post a status message.</p>
<p id="rfc.section.5.7.p.3">The posted data media type: application/json</p>
<p id="rfc.section.5.7.p.4">The client HTTP POSTs the following to the server at the EST well known URI "/voucher_status". The Status field indicates if the voucher was acceptable. If it was not acceptable the Reason string indicates why. In the failure case this message may be sent to an unauthenticated, potentially malicious registrar and therefore the Reason string SHOULD NOT provide information beneficial to an attacker. The operational benefit of this telemetry information is balanced against the operational costs of not recording that an voucher was ignored by a client the registrar expected to continue joining the domain.</p>
<pre>{
  "version":"1",
  "Status":FALSE /* TRUE=Success, FALSE=Fail"
  "Reason":"Informative human readable message"
  "reason-context": { additional JSON }
}</pre>
<p></p>
<p id="rfc.section.5.7.p.6">The reason-context attribute is an arbitrary JSON object (literal value or hash of values) which provides additional information specific to this pledge.  The contents of this field are not subject to standardization.  </p>
<p id="rfc.section.5.7.p.7">Additional standard JSON fields in this POST MAY be added, see <a href="#pledgestatustelemetryregistry" class="xref">Section 7.3</a>.  </p>
<h1 id="rfc.section.5.8">
<a href="#rfc.section.5.8">5.8.</a> <a href="#authzLogRequest" id="authzLogRequest">Registrar audit log request</a>
</h1>
<p id="rfc.section.5.8.p.1">After receiving the pledge status telemetry <a href="#pledgestatus" class="xref">Section 5.7</a>, the registrar SHOULD request the MASA audit log from the MASA service.</p>
<p id="rfc.section.5.8.p.2">This is done with an HTTP GET using the operation path value of "/.well-known/est/requestauditlog".  </p>
<p id="rfc.section.5.8.p.3">The registrar SHOULD HTTP POST the same registrar voucher-request as it did when requesting a voucher. It is posted to the /requestauditlog URI instead.  The "idevid-issuer" and "serial-number" informs the MASA which log is requested so the appropriate log can be prepared for the response.  Using the same media type and message minimizes cryptographic and message operations although it results in additional network traffic.  The relying MASA implementation MAY leverage internal state to associate this request with the original, and by now already validated, voucher-request so as to avoid an extra crypto validation.</p>
<p id="rfc.section.5.8.p.4">A registrar MAY request logs at future times. If the registrar generates a new request then the MASA is forced to perform the additional cryptographic operations to verify the new request.</p>
<p id="rfc.section.5.8.p.5">A MASA that receives a request for a device that does not exist, or for which the requesting owner was never an owner returns an HTTP 404 ("Not found") code.  </p>
<p id="rfc.section.5.8.p.6">Rather than returning the audit log as a response to the POST (with a return code 200), the MASA MAY instead return a 201 ("Created") RESTful response (<a href="#RFC7231" class="xref">[RFC7231]</a> section 7.1) containing a URL to the prepared (and easily cachable) audit response.  </p>
<p id="rfc.section.5.8.p.7">In order to avoid enumeration of device audit logs, MASA that return URLs SHOULD take care to make the returned URL unguessable.  For instance, rather than returning URLs containing a database number such as https://example.com/auditlog/1234 or the EUI of the device such https://example.com/auditlog/10-00-00-11-22-33, the MASA SHOULD return a randomly generated value (a "slug" in web parlance).  The value is used to find the relevant database entry.  </p>
<p id="rfc.section.5.8.p.8">A MASA that returns a code 200 MAY also include a Location: header for future reference by the registrar.  </p>
<p id="rfc.section.5.8.p.9">The request media type is:</p>
<p></p>

<dl>
<dt>application/voucher-cms+json</dt>
<dd style="margin-left: 8">The request is a "YANG-defined JSON document that has been signed using a CMS structure" as described in <a href="#voucher-request" class="xref">Section 3</a> using the JSON encoded described in <a href="#RFC7951" class="xref">[RFC7951]</a>. The registrar MUST sign the request. The entire registrar certificate chain, up to and including the Domain CA, MUST be included in the CMS structure.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.5.8.1">
<a href="#rfc.section.5.8.1">5.8.1.</a> <a href="#MASAauditlog" id="MASAauditlog">MASA audit log response</a>
</h1>
<p id="rfc.section.5.8.1.p.1">A log data file is returned consisting of all log entries associated with the the device selected by the IDevID presented in the request.  The audit log may be truncated of old or repeated values as explained below.  The returned data is in JSON format (<a href="#RFC7951" class="xref">[RFC7951]</a>), and the Content-Type SHOULD be "application/json".  For example:</p>
<pre>
{
  "version":"1",
  "events":[
    {
     "date":"&lt;date/time of the entry&gt;",
     "domainID":"&lt;domainID extracted from voucher-request&gt;",
     "nonce":"&lt;any nonce if supplied (or the exact string 'NULL')&gt;"
     "assertion":"&lt;the value from the voucher assertion leaf&gt;"
     "truncated":"&lt;the number of domainID entries truncated&gt;"
    },
    {
     "date":"&lt;date/time of the entry&gt;",
     "domainID":"&lt;anotherDomainID extracted from voucher-request&gt;",
     "nonce":"&lt;any nonce if supplied (or the exact string 'NULL')&gt;"
     "assertion":"&lt;the value from the voucher assertion leaf&gt;"
    }
  ],
  "truncation": {
     "nonced duplicates": "&lt;total number of entries truncated&gt;",
     "nonceless duplicates": "&lt;total number of entries truncated&gt;",
     "arbitrary": "&lt;number of domainID entries removed entirely&gt;"
     }
}</pre>
<p></p>
<p id="rfc.section.5.8.1.p.3">Distribution of a large log is less than ideal. This structure can be optimized as follows: Nonced or Nonceless entries for the same domainID MAY be truncated from the log leaving only the single most recent nonced or nonceless entry for that domainID. In the case of truncation the 'event' truncation value SHOULD contain a count of the number of events for this domainID that were truncated. The log SHOULD NOT be further reduced but there could exist operational situation where maintaining the full log is not possible. In such situations the log MAY be arbitrarily truncated for length, with the number of removed entries indicated as 'arbitrary'.  </p>
<p id="rfc.section.5.8.1.p.4">If the truncation count exceeds 1024 then the MASA MAY use this value without further incrementing it.  </p>
<p id="rfc.section.5.8.1.p.5">A log where duplicate entries for the same domain have been truncated ("nonced duplicates" and/or "nonceless duplicates) could still be acceptable for informed decisions. A log that has had "arbitrary" truncations is less acceptable but manufacturer transparency is better than hidden truncations.</p>
<p id="rfc.section.5.8.1.p.6">This document specifies a simple log format as provided by the MASA service to the registrar. This format could be improved by distributed consensus technologies that integrate vouchers with technologies such as block-chain or hash trees or optimized logging approaches. Doing so is out of the scope of this document but is an anticipated improvement for future work.  As such, the registrar client SHOULD anticipate new kinds of responses, and SHOULD provide operator controls to indicate how to process unknown responses.  </p>
<h1 id="rfc.section.5.8.2">
<a href="#rfc.section.5.8.2">5.8.2.</a> <a href="#auditLogVerification" id="auditLogVerification">Registrar audit log verification</a>
</h1>
<p id="rfc.section.5.8.2.p.1">Each time the Manufacturer Authorized Signing Authority (MASA) issues a voucher, it places it into the audit log for that device.  The details are described in <a href="#authzLogRequest" class="xref">Section 5.8</a>.  The contents of the audit log can express a variety of trust levels, and this section explains what kind of trust a registrar can derive from the entries.  </p>
<p id="rfc.section.5.8.2.p.2">While the audit log provides a list of vouchers that were issued by the MASA, the vouchers are issued in response to voucher-requests, and it is the contents of the voucher-requests which determines how meaningful the audit log entries are.  </p>
<p id="rfc.section.5.8.2.p.3">A registrar SHOULD use the log information to make an informed decision regarding the continued bootstrapping of the pledge. The exact policy is out of scope of this document as it depends on the security requirements within the registrar domain. Equipment that is purchased pre-owned can be expected to have an extensive history.  The following dicussion is provided to help explain the value of each log element:</p>
<p></p>

<dl>
<dt>date:</dt>
<dd style="margin-left: 8">The date field provides the registrar an opportunity to divide the log around known events such as the purchase date. Depending on context known to the registrar or administrator evens before/after certain dates can have different levels of importance. For example for equipment that is expected to be new, and thus have no history, it would be a surprise to find prior entries.</dd>
<dt>domainID:</dt>
<dd style="margin-left: 8">If the log includes an unexpected domainID then the pledge could have imprinted on an unexpected domain. The registrar can be expected to use a variety of techniques to define "unexpected" ranging from white lists of prior domains to anomoly detection (e.g. "this device was previously bound to a different domain than any other device deployed"). Log entries can also be compared against local history logs in search of discrepancies (e.g. "this device was re-deployed some number of times internally but the external audit log shows additional re-deployments our internal logs are unaware of").</dd>
<dt>nonce:</dt>
<dd style="margin-left: 8">Nonceless entries mean the logged domainID could theoretically trigger a reset of the pledge and then take over management by using the existing nonceless voucher.</dd>
<dt>assertion:</dt>
<dd style="margin-left: 8">The assertion leaf in the voucher and audit log indicates why the MASA issued the voucher. A "verified" entry means that the MASA issued the associated voucher as a result of positive verification of ownership but this can still be problematic for registrar's that expected only new (not pre-owned) pledges. A "logged" assertion informs the registrar that the prior vouchers were issued with minimal verification. A "proximity" assertion assures the registrar that the pledge was truly communicating with the prior domain and thus provides assurance that the prior domain really has deployed the pledge.</dd>
</dl>
<p id="rfc.section.5.8.2.p.5">A relatively simple policy is to white list known (internal or external) domainIDs and to require all vouchers to have a nonce and/or require that all nonceless vouchers be from a subset (e.g. only internal) domainIDs. A simple action is to revoke any locally issued credentials for the pledge in question or to refuse to forward the voucher.  A registrar MAY be configured to ignore the history of the device but it is RECOMMENDED that this only be configured if hardware assisted NEA [RFC5209] is supported.</p>
<h1 id="rfc.section.5.9">
<a href="#rfc.section.5.9">5.9.</a> <a href="#ESTintegration" id="ESTintegration">EST Integration for PKI bootstrapping</a>
</h1>
<p id="rfc.section.5.9.p.1">The pledge SHOULD follow the BRSKI operations with EST enrollment operations including "CA Certificates Request", "CSR Attributes" and "Client Certificate Request" or "Server-Side Key Generation", etc. This is a relatively seamless integration since BRSKI REST calls provide an automated alternative to the manual bootstrapping method described in <a href="#RFC7030" class="xref">[RFC7030]</a>. As noted above, use of HTTP 1.1 persistent connections simplifies the pledge state machine.</p>
<p id="rfc.section.5.9.p.2">Although EST allows clients to obtain multiple certificates by sending multiple CSR requests BRSKI mandates use of the CSR Attributes request and mandates that the registrar validate the CSR against the expected attributes. This implies that client requests will "look the same" and therefore result in a single logical certificate being issued even if the client were to make multiple requests. Registrars MAY contain more complex logic but doing so is out-of-scope of this specification.  BRSKI does not signal any enhancement or restriction to this capability.  </p>
<h1 id="rfc.section.5.9.1">
<a href="#rfc.section.5.9.1">5.9.1.</a> EST Distribution of CA Certificates</h1>
<p id="rfc.section.5.9.1.p.1">The pledge SHOULD request the full EST Distribution of CA Certificates message. See RFC7030, section 4.1.</p>
<p id="rfc.section.5.9.1.p.2">This ensures that the pledge has the complete set of current CA certificates beyond the pinned-domain-cert (see <a href="#CompletingAuthenticationBootstrapping" class="xref">Section 5.6.1</a> for a discussion of the limitations inherent in having a single certificate instead of a full CA Certificates response.) Although these limitations are acceptable during initial bootstrapping, they are not appropriate for ongoing PKIX end entity certificate validation.</p>
<h1 id="rfc.section.5.9.2">
<a href="#rfc.section.5.9.2">5.9.2.</a> <a href="#csrattributes" id="csrattributes">EST CSR Attributes</a>
</h1>
<p id="rfc.section.5.9.2.p.1">Automated bootstrapping occurs without local administrative configuration of the pledge. In some deployments it is plausible that the pledge generates a certificate request containing only identity information known to the pledge (essentially the X.509 IDevID information) and ultimately receives a certificate containing domain specific identity information. Conceptually the CA has complete control over all fields issued in the end entity certificate. Realistically this is operationally difficult with the current status of PKI certificate authority deployments, where the CSR is submitted to the CA via a number of non-standard protocols. Even with all standardized protocols used, it could operationally be problematic to expect that service specific certificate fields can be created by a CA that is likely operated by a group that has no insight into different network services/protocols used. For example, the CA could even be outsourced.</p>
<p id="rfc.section.5.9.2.p.2">To alleviate these operational difficulties, the pledge MUST request the EST "CSR Attributes" from the EST server and the EST server needs to be able to reply with the attributes necessary for use of the certificate in its intended protocols/services. This approach allows for minimal CA integrations and instead the local infrastructure (EST server) informs the pledge of the proper fields to include in the generated CSR. This approach is beneficial to automated boostrapping in the widest number of environments.</p>
<p id="rfc.section.5.9.2.p.3">If the hardwareModuleName in the X.509 IDevID is populated then it SHOULD by default be propagated to the LDevID along with the hwSerialNum. The EST server SHOULD support local policy concerning this functionality.</p>
<p id="rfc.section.5.9.2.p.4">In networks using the BRSKI enrolled certificate to authenticate the ACP (Autonomic Control Plane), the EST attributes MUST include the "ACP information" field. See <a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">[I-D.ietf-anima-autonomic-control-plane]</a> for more details.</p>
<p id="rfc.section.5.9.2.p.5">The registrar MUST also confirm that the resulting CSR is formatted as indicated before forwarding the request to a CA. If the registrar is communicating with the CA using a protocol such as full CMC, which provides mechanisms to override the CSR attributes, then these mechanisms MAY be used even if the client ignores CSR Attribute guidance.</p>
<h1 id="rfc.section.5.9.3">
<a href="#rfc.section.5.9.3">5.9.3.</a> EST Client Certificate Request</h1>
<p id="rfc.section.5.9.3.p.1">The pledge MUST request a new client certificate. See RFC7030, section 4.2.</p>
<h1 id="rfc.section.5.9.4">
<a href="#rfc.section.5.9.4">5.9.4.</a> Enrollment Status Telemetry</h1>
<p id="rfc.section.5.9.4.p.1">For automated bootstrapping of devices, the adminstrative elements providing bootstrapping also provide indications to the system administrators concerning device lifecycle status. This might include information concerning attempted bootstrapping messages seen by the client, MASA provides logs and status of credential enrollment. <a href="#RFC7030" class="xref">[RFC7030]</a> assumes an end user and therefore does not include a final success indication back to the server. This is insufficient for automated use cases.</p>
<p id="rfc.section.5.9.4.p.2">To indicate successful enrollment the client SHOULD re-negotiate the EST TLS session using the newly obtained credentials. This occurs by the client initiating a new TLS ClientHello message on the existing TLS connection. The client MAY simply close the old TLS session and start a new one. The server MUST support either model.</p>
<p id="rfc.section.5.9.4.p.3">In the case of a FAIL, the Reason string indicates why the most recent enrollment failed. The SubjectKeyIdentifier field MUST be included if the enrollment attempt was for a keypair that is locally known to the client. If EST /serverkeygen was used and failed then the field is omitted from the status telemetry.</p>
<p id="rfc.section.5.9.4.p.4">In the case of a SUCCESS the Reason string is omitted. The SubjectKeyIdentifier is included so that the server can record the successful certificate distribution.</p>
<p id="rfc.section.5.9.4.p.5">Status media type: application/json</p>
<p id="rfc.section.5.9.4.p.6">The client HTTP POSTs the following to the server at the new EST well known URI /enrollstatus.</p>
<pre>{
  "version":"1",
  "Status":TRUE /* TRUE=Success, FALSE=Fail"
  "Reason":"Informative human readable message"
  "reason-context": "Additional information"
}</pre>
<p></p>
<p id="rfc.section.5.9.4.p.8">The server SHOULD respond with an HTTP 200 but MAY simply fail with an HTTP 404 error.</p>
<p id="rfc.section.5.9.4.p.9">Within the server logs the server MUST capture if this message was received over an TLS session with a matching client certificate.  This allows for clients that wish to minimize their crypto operations to simply POST this response without renegotiating the TLS session - at the cost of the server not being able to accurately verify that enrollment was truly successful.</p>
<h1 id="rfc.section.5.9.5">
<a href="#rfc.section.5.9.5">5.9.5.</a> Multiple certificates</h1>
<p id="rfc.section.5.9.5.p.1">Pledges that require multiple certificates could establish direct EST connections to the registrar.  </p>
<h1 id="rfc.section.5.9.6">
<a href="#rfc.section.5.9.6">5.9.6.</a> EST over CoAP</h1>
<p id="rfc.section.5.9.6.p.1">This document describes extensions to EST for the purposes of bootstrapping of remote key infrastructures.  Bootstrapping is relevant for CoAP enrollment discussions as well. The defintion of EST and BRSKI over CoAP is not discussed within this document beyond ensuring proxy support for CoAP operations. Instead it is anticipated that a definition of CoAP mappings will occur in subsequent documents such as <a href="#I-D.ietf-ace-coap-est" class="xref">[I-D.ietf-ace-coap-est]</a> and that CoAP mappings for BRSKI will be discussed either there or in future work.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#reducedsecuritymodes" id="reducedsecuritymodes">Reduced security operational modes</a>
</h1>
<p id="rfc.section.6.p.1">A common requirement of bootstrapping is to support less secure operational modes for support specific use cases. The following sections detail specific ways that the pledge, registrar and MASA can be configured to run in a less secure mode for the indicated reasons.  </p>
<p id="rfc.section.6.p.2">This section is considered non-normative: use suggested methods MUST be detailed in specific profiles of BRSKI.  This is the subject for future work.  </p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Trust Model</h1>
<p id="rfc.section.6.1.p.1">This section explains the trust relationships detailed in <a href="#flow" class="xref">Section 2.4</a>: </p>
<pre>
+--------+         +---------+    +------------+     +------------+
| Pledge |         | Join    |    | Domain     |     |Manufacturer|
|        |         | Proxy   |    | Registrar  |     | Service    |
|        |         |         |    |            |     | (Internet) |
+--------+         +---------+    +------------+     +------------+
              </pre>
<p>Figure 10</p>
<p></p>

<dl>
<dt>Pledge:</dt>
<dd style="margin-left: 8">The pledge could be compromised and providing an attack vector for malware. The entity is trusted to only imprint using secure methods described in this document.  Additional endpoint assessment techniques are RECOMMENDED but are out-of-scope of this document.</dd>
<dt>Join Proxy:</dt>
<dd style="margin-left: 8">Provides proxy functionalities but is not involved in security considerations.</dd>
<dt>Registrar:</dt>
<dd style="margin-left: 8">When interacting with a MASA a registrar makes all decisions. For Ownership Audit Vouchers (see <a href="#RFC8366" class="xref">[RFC8366]</a>) the registrar is provided an opportunity to accept MASA decisions.</dd>
<dt>Vendor Service, MASA:</dt>
<dd style="margin-left: 8">This form of manufacturer service is trusted to accurately log all claim attempts and to provide authoritative log information to registrars. The MASA does not know which devices are associated with which domains. These claims could be strengthened by using cryptographic log techniques to provide append only, cryptographic assured, publicly auditable logs. Current text provides only for a trusted manufacturer.</dd>
<dt>Vendor Service, Ownership Validation:</dt>
<dd style="margin-left: 8">This form of manufacturer service is trusted to accurately know which device is owned by which domain.</dd>
</dl>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#pledgeReductions" id="pledgeReductions">Pledge security reductions</a>
</h1>
<p id="rfc.section.6.2.p.1">The pledge can choose to accept vouchers using less secure methods. These methods enable offline and emergency (touch based) deployment use cases: </p>

<ol>
<li>The pledge MUST accept nonceless vouchers. This allows for a use case where the registrar can not connect to the MASA at the deployment time.  Logging and validity periods address the security considerations of supporting these use cases.  </li>
<li>Many devices already support "trust on first use" for physical interfaces such as console ports. This document does not change that reality. Devices supporting this protocol MUST NOT support "trust on first use" on network interfaces. This is because "trust on first use" over network interfaces would undermine the logging based security protections provided by this specification.</li>
<li>The pledge MAY have an operational mode where it skips voucher validation one time. For example if a physical button is depressed during the bootstrapping operation. This can be useful if the manufacturer service is unavailable. This behavior SHOULD be available via local configuration or physical presence methods (such as use of a serial/craft console) to ensure new entities can always be deployed even when autonomic methods fail. This allows for unsecured imprint.</li>
</ol>
<p id="rfc.section.6.2.p.2">It is RECOMMENDED that "trust on first use" or any method of skipping voucher validation (including use of craft serial console) only be available if hardware assisted Network Endpoint Assessment [RFC5209] is supported. This recommendation ensures that domain network monitoring can detect innappropriate use of offline or emergency deployment procedures when voucher-based bootstrapping is not used.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> Registrar security reductions</h1>
<p id="rfc.section.6.3.p.1">A registrar can choose to accept devices using less secure methods.  These methods are acceptable when low security models are needed, as the security decisions are being made by the local administrator, but they MUST NOT be the default behavior:</p>

<ol>
<li>A registrar MAY choose to accept all devices, or all devices of a particular type, at the administrator's discretion. This could occur when informing all registrars of unique identifiers of new entities might be operationally difficult.</li>
<li>A registrar MAY choose to accept devices that claim a unique identity without the benefit of authenticating that claimed identity. This could occur when the pledge does not include an X.509 IDevID factory installed credential. New Entities without an X.509 IDevID credential MAY form the <a href="#RequestVoucherFromRegistrar" class="xref">Section 5.2</a> request using the <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> format to ensure the pledge's serial number information is provided to the registrar (this includes the IDevID AuthorityKeyIdentifier value, which would be statically configured on the pledge.) The pledge MAY refuse to provide a TLS client certificate (as one is not available.) The pledge SHOULD support HTTP-based or certificate-less TLS authentication as described in EST RFC7030 section 3.3.2. A registrar MUST NOT accept unauthenticated New Entities unless it has been configured to do so by an administrator that has verified that only expected new entities can communicate with a registrar (presumably via a physically secured perimeter.)</li>
<li>A registrar MAY submit a nonceless voucher-requests to the MASA service (by not including a nonce in the voucher-request.) The resulting vouchers can then be stored by the registrar until they are needed during bootstrapping operations. This is for use cases where the target network is protected by an air gap and therefore cannot contact the MASA service during pledge deployment.</li>
<li>A registrar MAY ignore unrecognized nonceless log entries. This could occur when used equipment is purchased with a valid history being deployed in air gap networks that required permanent vouchers.</li>
</ol>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#masasecurityreductions" id="masasecurityreductions">MASA security reductions</a>
</h1>
<p id="rfc.section.6.4.p.1">Lower security modes chosen by the MASA service affect all device deployments unless bound to the specific device identities. In which case these modes can be provided as additional features for specific customers. The MASA service can choose to run in less secure modes by:</p>
<p></p>

<ol>
<li>Not enforcing that a nonce is in the voucher. This results in distribution of a voucher that never expires and in effect makes the Domain an always trusted entity to the pledge during any subsequent bootstrapping attempts. That this occurred is captured in the log information so that the registrar can make appropriate security decisions when a pledge joins the Domain. This is useful to support use cases where registrars might not be online during actual device deployment. Because this results in a long lived voucher and does not require the proof that the device is online, this is only accepted when the registrar is authenticated by the MASA and authorized to provide this functionality. The MASA is RECOMMENDED to use this functionality only in concert with an enhanced level of ownership tracking (out-of-scope.) If the pledge device is known to have a real-time-clock that is set from the factory, use of a voucher validity period is RECOMMENDED.</li>
<li>Not verifying ownership before responding with a voucher. This is expected to be a common operational model because doing so relieves the manufacturer providing MASA services from having to track ownership during shipping and supply chain and allows for a very low overhead MASA service. A registrar uses the audit log information as a defense in depth strategy to ensure that this does not occur unexpectedly (for example when purchasing new equipment the registrar would throw an error if any audit log information is reported.) The MASA SHOULD verify the 'prior-signed-voucher-request' information for pledges that support that functionality. This provides a proof-of-proximity check that reduces the need for ownership verification.</li>
</ol>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<p id="rfc.section.7.p.1">This document requires the following IANA actions:</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> Well-known EST registration</h1>
<p id="rfc.section.7.1.p.1">This document extends the definitions of "est" (so far defined via RFC7030) in the "https://www.iana.org/assignments/well-known-uris/well-known-uris.xhtml" registry as follows: </p>

<ul>
<li>add /.well-known/est/requestvoucher (see <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> ) </li>
<li>add /.well-known/est/requestauditlog (see <a href="#pledgestatus" class="xref">Section 5.7</a>)</li>
</ul>

<p> </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> PKIX Registry</h1>
<p id="rfc.section.7.2.p.1">IANA is requested to register the following:</p>
<p id="rfc.section.7.2.p.2">This document requests a number for id-mod-MASAURLExtn2016(TBD) from the pkix(7) id-mod(0) Registry.  </p>
<p id="rfc.section.7.2.p.3">This document has received an early allocation from the id-pe registry (SMI Security for PKIX Certificate Extension) for id-pe-masa-url with the value 32, resulting in an OID of 1.3.6.1.5.5.7.1.32.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#pledgestatustelemetryregistry" id="pledgestatustelemetryregistry">Pledge BRSKI Status Telemetry</a>
</h1>
<p id="rfc.section.7.3.p.1">IANA is requested to create a new Registry entitled: "BRSKI Parameters", and within that Registry to create a table called: "Pledge BRSKI Status Telemetry Attributes".  New items can be added using the Specification Required.  The following items are to be in the initial registration, with this document (<a href="#pledgestatus" class="xref">Section 5.7</a>) as the reference: </p>

<ul>
<li>version</li>
<li>Status</li>
<li>Reason</li>
<li>reason-context</li>
</ul>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> DNS Service Names</h1>
<p id="rfc.section.7.4.p.1">IANA is requested to register the following Service Names:</p>
<pre>
Service Name: _brski-proxy
Transport Protocol(s): tcp
Assignee: IESG &lt;iesg@ietf.org&gt;.
Contact: IESG &lt;iesg@ietf.org&gt;
Description: The Bootstrapping Remote Secure Key
             Infrastructures Proxy
Reference: [This document]

Service Name: _brski-registrar
Transport Protocol(s): tcp
Assignee: IESG &lt;iesg@ietf.org&gt;.
Contact: IESG &lt;iesg@ietf.org&gt;
Description: The Bootstrapping Remote Secure Key
             Infrastructures Registrar
Reference: [This document]
          </pre>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> MUD File Extension for the MASA</h1>
<p id="rfc.section.7.5.p.1">The IANA is requested to list the name "masa" in the MUD extensions registry defined in <a href="#I-D.ietf-opsawg-mud" class="xref">[I-D.ietf-opsawg-mud]</a>.  Its use is documented in <a href="#mud-extension" class="xref">Appendix C</a>.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#acpapplicability" id="acpapplicability">Applicability to the Autonomic                                               Control Plane</a>
</h1>
<p id="rfc.section.8.p.1">This document provides a solution to the requirements for secure bootstrap set out in <a href="#RFC8368" class="xref">Using an Autonomic Control Plane for Stable Connectivity of Network Operations, Administration, and Maintenance</a>, <a href="#I-D.ietf-anima-reference-model" class="xref">A Reference Model for Autonomic Networking</a> and specifically the <a href="#I-D.ietf-anima-autonomic-control-plane" class="xref">An Autonomic Control Plane (ACP)</a>, section 3.2 (Secure Bootstrap), and section 6.1 (ACP Domain, Certificate and Network).  </p>
<p id="rfc.section.8.p.2">The protocol described in this document has appeal in a number of other non-ANIMA use cases.  Such uses of the protocol will be deploying into other environments with different tradeoffs of privacy, security, reliability and autonomy from manufacturers.  As such those use cases will need to provide their own applicability statements, and will need to address unique privacy and security considerations for the environments in which they are used.  </p>
<p id="rfc.section.8.p.3">The autonomic control plane that this document provides bootstrap for is typically a medium to large Internet Service Provider organization, or an equivalent Enterprise that has signficant layer-3 router connectivity.  (A network consistenting of primarily layer-2 is not excluded, but the adjacencies that the ACP will create and maintain will not reflect the topology until all devices participate in the ACP).  </p>
<p id="rfc.section.8.p.4">As specified in the ANIMA charter, this work "..focuses on professionally-managed networks."  Such a network has an operator and can do things like like install, configure and operate the Registrar function.  The operator makes purchasing decisions and is aware of what manufacturers it expects to see on it's network.  </p>
<p id="rfc.section.8.p.5">Such an operator also is capable of performing the traditional (craft serial-console) based bootstrap of devices. The zero-touch mechanism presented in this and the ACP document represents a signficiant efficiency: in particular it reduces the need to put senior experts on airplanes to configure devices in person.  There is a recognition as the technology evolves that not every situation may work out, and occasionally a human still still have to visit.  </p>
<p id="rfc.section.8.p.6">The BRSKI protocol is going into environments where there have already been quite a number of vendor proprietary management systems.  Those are not expected to go away quickly, but rather to leverage the secure credentials that are provisioned by BRSKI.  The connectivity requirements of said management systems are provided by the ACP.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#privacyconsiderations" id="privacyconsiderations">Privacy Considerations</a>
</h1>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> MASA audit log</h1>
<p id="rfc.section.9.1.p.1">The MASA audit log includes a hash of the domainID for each Registrar a voucher has been issued to. This information is closely related to the actual domain identity, especially when paired with the anti-DDoS authentication information the MASA might collect. This could provide sufficient information for the MASA service to build a detailed understanding the devices that have been provisioned within a domain.  </p>
<p id="rfc.section.9.1.p.2">There are a number of design choices that mitigate this risk. The domain can maintain some privacy since it has not necessarily been authenticated and is not authoritatively bound to the supply chain.  </p>
<p id="rfc.section.9.1.p.3">Additionally the domainID captures only the unauthenticated subject key identifier of the domain. A privacy sensitive domain could theoretically generate a new domainID for each device being deployed. Similarly a privacy sensitive domain would likely purchase devices that support proximity assertions from a manufacturer that does not require sales channel integrations. This would result in a significant level of privacy while maintaining the security characteristics provided by Registrar based audit log inspection.  </p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> What BRSKI-MASA reveals to the manufacturer</h1>
<p id="rfc.section.9.2.p.1">The so-called "call-home" mechanism that occurs as part of the BRSKI-MASA connection standardizes what has been deemed by some as a sinister mechanism for corporate oversight of individuals.  (<a href="#livingwithIoT" class="xref">[livingwithIoT]</a> and <a href="#IoTstrangeThings" class="xref">[IoTstrangeThings]</a> for a small sample).  </p>
<p id="rfc.section.9.2.p.2">As the Autonomic Control Plane (ACP) usage of BRSKI is not targetted at individual usage of IoT devices, but rather at the Enterprise and ISP creation of networks in a zero-touch fashion, the "call-home" represents a different kind of concern.  </p>
<p id="rfc.section.9.2.p.3">It needs to be re-iterated that the BRSKI-MASA mechanism only occurs once during the comissioning of the device.  It is well defined, and although encrypted with TLS, it could in theory be made auditable as the contents are well defined.  This connection does not occur when the device powers on or is restarted for normal routines.  It is conceivable that a device could be forced to go through a full factory reset during an exceptional firmware update situation, after which enrollment would have be repeated.  </p>
<p id="rfc.section.9.2.p.4">The BRSKI call-home mechanism is mediated via the owner's Registrar, and the information that is transmitted is directly auditable by the device owner.    This is in stark constrast to many "call-home" protocols where the device autonomously calls home and uses an undocumented protocol.  </p>
<p id="rfc.section.9.2.p.5">While the contents of the signed part of the pledge voucher request can not be changed, they are not encrypted at the registrar.  The ability to audit the messages by the owner of the network prevents exfiltration of data by a nefarious pledge.  The contents of an unsigned voucher request are, however, completely changeable by the Registrar.   Both are, to re-iterate, encrypted by TLS while in transit.  </p>
<p id="rfc.section.9.2.p.6">The BRSKI-MASA exchange reveals the following information to the manufacturer: </p>

<ul>
<li>the identity of the device being enrolled (down to the serial-number!).  </li>
<li>an identity of the domain owner in the form of the domain trust anchor.  However, this is not a global PKI anchored name within the WebPKI, so this identity could be pseudonymous.  If there is sales channel integration, then the MASA will have authenticated the domain owner, either via pinned certificate, or perhaps another HTTP authentication method, as per <a href="#MASAauthenticationOfRegistrar" class="xref">Section 5.5.3</a>.  </li>
<li>the time the device is activated, </li>
<li>the IP address of the domain Owner's Registrar.  For ISPs and Enterprises, the IP address provides very clear geolocation of the owner.  No amount of IP address privacy extensions (<a href="#RFC4941" class="xref">[RFC4941]</a>) can do anything about this, as a simple whois lookup likely identifies the ISP or Enterprise from the upper bits anyway.  A passive attacker who observes the connection definitely may conclude that the given enterprise/ISP is a customer of the particular equipment vendor.  The precise model that is being enrolled will remain private.  </li>
</ul>

<p> </p>
<p id="rfc.section.9.2.p.7">The above situation is to be distinguished from a residential/individual person who registers a device from a manufacturer: that an enterprise/ISP purchases routing products is hardly worth mentioning.  Deviations would, however, be notable.  </p>
<p id="rfc.section.9.2.p.8">The situation is not improved by the enterprise/ISP using anonymization services such as <a href="#Dingledine2004" class="xref">ToR</a>, as a TLS 1.2 connection will reveal the ClientCertificate used, clearly identifying the enterprise/ISP involved.  TLS 1.3 is better in this regard, but an active attacker can still discover the parties involved by performing a Man-In-The-Middle-Attack on the first attempt (breaking/killing it with a TCP RST), and then letting subsequent connection pass through.  </p>
<p id="rfc.section.9.2.p.9">A manufacturer could attempt to mix the BRSKI-MASA traffic in with general traffic their site by hosting the MASA behind the same (set) of load balancers that the companies normal marketing site is hosted behind.  This makes lots of sense from a straight capacity planning point of view as the same set of services (and the same set of Distributed Denial of Service mitigations) may be used.  Unfortunately, as the BRSKI-MASA connections include TLS ClientCertificate exchanges, this may easily be observed in TLS 1.2, and a traffic analysis may reveal it even in TLS 1.3.  This does not make such a plan irrelevant.  There may be other organizational reasons to keep the marketing site (which is often subject to frequent redesigs, outsourcing, etc.) seperate from the MASA, which may need to operate reliably for decades.  </p>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> Manufacturers and Used or Stolen Equipment</h1>
<p id="rfc.section.9.3.p.1">As explained above, the manufacturer receives information each time that a device which is in factory-default mode does a zero-touch bootstrap, and attempts to enroll into a domain owner's registrar.  </p>
<p id="rfc.section.9.3.p.2">The manufacturer is therefore in a position to decline to issue a voucher if it detects that the new owner is not the same as the previous owner.  </p>

<ol>
<li>This can be seen as a feature if the equipment is believed to have been stolen.  If the legitimate owner notifies the manufacturer of the theft, then when the new owner brings the device up, if they use the zero-touch mechanism, the new (illegitimate) owner reveals their location and identity.  </li>
<li>In the case of Used equipment, the initial owner could inform the manufacturer of the sale, or the manufacturer may just permit resales unless told otherwise.  In which case, the transfer of ownership simply occurs.  </li>
<li>A manufacturer could however decide not to issue a new voucher in response to a transfer of ownership.  This is essentially the same as the stolen case, with the manufacturer having decided that the sale was not legitimate.  </li>
<li>There is a fourth case, if the manufacturer is providing protection against stolen devices.  The manufacturer then has a responsability to protect the legitimate owner against fraudulent claims that the the equipment was stolen.  Such a claim would cause the manufacturer to refuse to issue a new voucher. Should the device go through a deep factory reset (for instance, replacement of a damaged main board component, the device would not bootstrap.  </li>
<li>Finally, there is a fifth case: the manufacturer has decided to end-of-line the device, or the owner has not paid a yearly support amount, and the manufacturer refuses to issue new vouchers at that point.  This last case is not new to the industry: many license systems are already deployed that have significantly worse effect.  </li>
</ol>

<p> </p>
<p id="rfc.section.9.3.p.3">This section has outlined five situations in which a manufacturer could use the voucher system to enforce what are clearly license terms.  A manufacturer that attempted to enforce license terms via vouchers would find it rather ineffective as the terms would only be enforced when the device is enrolled, and this is not (to repeat), a daily or even monthly occurrance.  </p>
<h1 id="rfc.section.9.4">
<a href="#rfc.section.9.4">9.4.</a> Manufacturers and Grey market equipment</h1>
<p id="rfc.section.9.4.p.1">Manufacturers of devices often sell different products into different regional markets.  Which product is available in which market can be driven by price differentials, support issues (some markets may require manuals and tech-support to be done in the local language), government export regulation (such as whether strong crypto is permitted to be exported, or permitted to be used in a particular market).  When an domain owner obtains a device from a different market (they can be new) and transfers it to a different location, this is called a Grey Market.  </p>
<p id="rfc.section.9.4.p.2">A manufacturer could decide not to issue a voucher to an enterprise/ISP based upon their location.  There are a number of ways which this could be determined: from the geolocation of the registrar, from sales channel knowledge about the customer, and what products are (un-)available in that market.  If the device has a GPS the coordinates of the device could even be placed into an extension of the voucher.  </p>
<p id="rfc.section.9.4.p.3">The above actions are not illegal, and not new.  Many manufacturers have shipped crypto-weak (exportable) versions of firmware as the default on equipment for decades.  The first task of an enterprise/ISP has always been to login to a manufacturer system, show one's "entitlement" (country informatin, proof that support payments have been made), and receive either a new updated firmware, or a license key that will activate the correct firmware.  </p>
<p id="rfc.section.9.4.p.4">BRSKI permits the above process to automated (in an autonomic fashion), and therefore perhaps encourages this kind of differentiation by reducing the cost of doing it.  </p>
<p id="rfc.section.9.4.p.5">An issue that manufacturers will need to deal with in the above automated process is when a device is shipped to one country with one set of rules (or laws or entitlements), but the domain registry is in another one.  Which rules apply is something will have to be worked out: the manufacturer could come to believe they are dealing with Grey market equipment, when it is simply dealing with a global enterprise.  </p>
<h1 id="rfc.section.9.5">
<a href="#rfc.section.9.5">9.5.</a> Some mitigations for meddling by manufacturers</h1>
<p id="rfc.section.9.5.p.1">The most obvious mitigation is not to buy the product.  Pick manufacturers that are up-front about their policies, who do not change them gratutiously.  </p>
<p id="rfc.section.9.5.p.2">A manufacturer could provide a mechanism to manage the trust anchors and built-in certificates (IDevID) as an extension.  This is a substantial amount of work, and may be an area for future standardization work.  </p>
<p id="rfc.section.9.5.p.3">Replacement of the voucher validation anchors (usually pointing to the original manufacturer's MASA) with those of the new owner permits the new owner to issue vouchers to subsequent owners. This would be done by having the selling (old) owner to run a MASA.  </p>
<p id="rfc.section.9.5.p.4">In order to automatically find the new MASA, the mechanism describe in this document is to look for the MASA URL extension in the IDevID.  A new owner could override this in their Registrar, or the manufacturer could provide a mechanism to update or replace the IDevID prior to sale.  </p>
<p id="rfc.section.9.5.p.5">Once the voucher trust anchor and the IDevID is replaced, then the device will no longer trust the manufacturer in any way.  When a new owner performs a bootstrap, the device will point to a MASA that has been chosen, and will validate vouchers from this new entity.  </p>
<p id="rfc.section.9.5.p.6">The BRSKI protocol depends upon a trust anchor on the device and an identity on the device.  Management of these these entities facilitiates a few new operatonal modes without making any changes to the BRSKI protocol.  Those modes include: offline modes where the domain owner operates an internal MASA for all devices, resell modes where the first domain owner becomes the MASA for the next (resold-to) domain owner, and services where an aggregator acquires a large variety of devices, and then acts as a pseudonymized MASA for a variety of devices from a variety of manufacturers.  </p>
<p id="rfc.section.9.5.p.7">Some manufacturers may wish to consider replacement of the IDevID as an indication that the device's warantee is terminated. For others, the privacy requiments of some deployments might consider this a standard operating practice.  </p>
<p id="rfc.section.9.5.p.8">As discussed at the end of <a href="#MASAauditlog" class="xref">Section 5.8.1</a>, new work could be done to use a distributed consensus technology for the audit log.  This would permit the audit log to continue to be useful, even when there is a chain of MASA due to changes of ownership.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#securityconsiderations" id="securityconsiderations">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">This document details a protocol for bootstrapping that balances operational concerns against security concerns. As detailed in the introduction, and touched on again in <a href="#reducedsecuritymodes" class="xref">Section 6</a>, the protocol allows for reduced security modes.  These attempt to deliver additional control to the local administrator and owner in cases where less security provides operational benefits. This section goes into more detail about a variety of specific considerations.</p>
<p id="rfc.section.10.p.2">To facilitate logging and administrative oversight, in addition to triggering Registration verification of MASA logs, the pledge reports on voucher parsing status to the registrar. In the case of a failure, this information is informative to a potentially malicious registrar. This is mandated anyway because of the operational benefits of an informed administrator in cases where the failure is indicative of a problem. The registrar is RECOMMENDED to verify MASA logs if voucher status telemetry is not received.</p>
<p id="rfc.section.10.p.3">To facilitate truely limited clients EST RFC7030 section 3.3.2 requirements that the client MUST support a client authentication model have been reduced in <a href="#reducedsecuritymodes" class="xref">Section 6</a> to a statement that the registrar "MAY" choose to accept devices that fail cryptographic authentication. This reflects current (poor) practices in shipping devices without a cryptographic identity that are NOT RECOMMENDED.</p>
<p id="rfc.section.10.p.4">During the provisional period of the connection the pledge MUST treat all HTTP header and content data as untrusted data. HTTP libraries are regularly exposed to non-secured HTTP traffic: mature libraries should not have any problems.  </p>
<p id="rfc.section.10.p.5">Pledges might chose to engage in protocol operations with multiple discovered registrars in parallel. As noted above they will only do so with distinct nonce values, but the end result could be multiple vouchers issued from the MASA if all registrars attempt to claim the device. This is not a failure and the pledge choses whichever voucher to accept based on internal logic. The registrars verifying log information will see multiple entries and take this into account for their analytics purposes.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> <a href="#dosmasa" id="dosmasa">DoS against MASA</a>
</h1>
<p id="rfc.section.10.1.p.1">There are uses cases where the MASA could be unavailable or uncooperative to the Registrar. They include active DoS attacks, planned and unplanned network partitions, changes to MASA policy, or other instances where MASA policy rejects a claim. These introduce an operational risk to the Registrar owner in that MASA behavior might limit the ability to bootstrap a pledge device. For example this might be an issue during disaster recovery. This risk can be mitigated by Registrars that request and maintain long term copies of "nonceless" vouchers. In that way they are guaranteed to be able to bootstrap their devices.</p>
<p id="rfc.section.10.1.p.2">The issuance of nonceless vouchers themselves creates a security concern. If the Registrar of a previous domain can intercept protocol communications then it can use a previously issued nonceless voucher to establish management control of a pledge device even after having sold it. This risk is mitigated by recording the issuance of such vouchers in the MASA audit log that is verified by the subsequent Registrar and by Pledges only bootstrapping when in a factory default state. This reflects a balance between enabling MASA independence during future bootstrapping and the security of bootstrapping itself.  Registrar control over requesting and auditing nonceless vouchers allows device owners to choose an appropriate balance.</p>
<p id="rfc.section.10.1.p.3">The MASA is exposed to DoS attacks wherein attackers claim an unbounded number of devices. Ensuring a registrar is representative of a valid manufacturer customer, even without validating ownership of specific pledge devices, helps to mitigate this. Pledge signatures on the pledge voucher-request, as forwarded by the registrar in the prior-signed-voucher-request field of the registrar voucher-request, significantly reduce this risk by ensuring the MASA can confirm proximity between the pledge and the registrar making the request. This mechanism is optional to allow for constrained devices. Supply chain integration ("know your customer") is an additional step that MASA providers and device vendors can explore.</p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> Freshness in Voucher-Requests</h1>
<p id="rfc.section.10.2.p.1">A concern has been raised that the pledge voucher-request should contain some content (a nonce) provided by the registrar and/or MASA in order for those actors to verify that the pledge voucher-request is fresh.  </p>
<p id="rfc.section.10.2.p.2">There are a number of operational problems with getting a nonce from the MASA to the pledge. It is somewhat easier to collect a random value from the registrar, but as the registrar is not yet vouched for, such a registrar nonce has little value.  There are privacy and logistical challenges to addressing these operational issues, so if such a thing were to be considered, it would have to provide some clear value.  This section examines the impacts of not having a fresh pledge voucher-request.  </p>
<p id="rfc.section.10.2.p.3">Because the registrar authenticates the pledge, a full Man-in-the-Middle attack is not possible, despite the provisional TLS authentication by the pledge (see <a href="#ProtocolDetails" class="xref">Section 5</a>.) Instead we examine the case of a fake registrar (Rm) that communicates with the pledge in parallel or in close time proximity with the intended registrar. (This scenario is intentionally supported as described in <a href="#discovery" class="xref">Section 4.1</a>.) </p>
<p id="rfc.section.10.2.p.4">The fake registrar (Rm) can obtain a voucher signed by the MASA either directly or through arbitrary intermediaries.  Assuming that the MASA accepts the registrar voucher-request (either because Rm is collaborating with a legitimate registrar according to supply chain information, or because the MASA is in audit-log only mode), then a voucher linking the pledge to the registrar Rm is issued.  </p>
<p id="rfc.section.10.2.p.5">Such a voucher, when passed back to the pledge, would link the pledge to registrar Rm, and would permit the pledge to end the provisional state. It now trusts Rm and, if it has any security vulnerabilities leveragable by an Rm with full administrative control, can be assumed to be a threat against the intended registrar.  </p>
<p id="rfc.section.10.2.p.6">This flow is mitigated by the intended registrar verifying the audit logs available from the MASA as described in <a href="#authzLogRequest" class="xref">Section 5.8</a>. Rm might chose to collect a voucher-request but wait until after the intended registrar completes the authorization process before submitting it. This pledge voucher-request would be 'stale' in that it has a nonce that no longer matches the internal state of the pledge. In order to successfully use any resulting voucher the Rm would need to remove the stale nonce or anticipate the pledge's future nonce state. Reducing the possibility of this is why the pledge is mandated to generate a strong random or pseudo-random number nonce.</p>
<p id="rfc.section.10.2.p.7">Additionally, in order to successfully use the resulting voucher the Rm would have to attack the pledge and return it to a bootstrapping enabled state. This would require wiping the pledge of current configuration and triggering a re-bootstrapping of the pledge.  This is no more likely than simply taking control of the pledge directly but if this is a consideration the target network is RECOMMENDED to take the following steps: </p>
<p></p>

<ul>
<li>Ongoing network monitoring for unexpected bootstrapping attempts by pledges.</li>
<li>Retreival and examination of MASA log information upon the occurance of any such unexpected events. Rm will be listed in the logs along with nonce information for analysis.</li>
</ul>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> Trusting manufacturers</h1>
<p id="rfc.section.10.3.p.1">The BRSKI extensions to EST permit a new pledge to be completely configured with domain specific trust anchors.  The link from built-in manufacturer-provided trust anchors to domain-specific trust anchors is mediated by the signed voucher artifact.  </p>
<p id="rfc.section.10.3.p.2">If the manufacturer's IDevID signing key is not properly validated, then there is a risk that the network will accept a pledge that should not be a member of the network.  As the address of the manufacturer's MASA is provided in the IDevID using the extension from <a href="#IDevIDextension" class="xref">Section 2.3</a>, the malicious pledge will have no problem collaborating with it's MASA to produce a completely valid voucher.  </p>
<p id="rfc.section.10.3.p.3">BRSKI does not, however, fundamentally change the trust model from domain owner to manufacturer.  Assuming that the pledge used its IDevID with RFC7030 EST and BRSKI, the domain (registrar) still needs to trust the manufacturer.  </p>
<p id="rfc.section.10.3.p.4">Establishing this trust between domain and manufacturer is outside the scope of BRSKI.  There are a number of mechanisms that can adopted including: </p>

<ul>
<li>Manually configuring each manufacturer's trust anchor.  </li>
<li>A Trust-On-First-Use (TOFU) mechanism. A human would be queried upon seeing a manufacturer's trust anchor for the first time, and then the trust anchor would be installed to the trusted store.  There are risks with this; even if the key to name is validated using something like the WebPKI, there remains the possibility that the name is a look alike: e.g, c1sco.com, ..  </li>
<li>scanning the trust anchor from a QR code that came with the packaging (this is really a manual TOFU mechanism) </li>
<li>some sales integration process where trust anchors are provided as part of the sales process, probably included in a digital packing "slip", or a sales invoice.  </li>
<li>consortium membership, where all manufacturers of a particular device category (e.g, a light bulb, or a cable-modem) are signed by an certificate authority specifically for this.  This is done by CableLabs today. It is used for authentication and authorization as part of TR-79: <a href="#docsisroot" class="xref">[docsisroot]</a> and <a href="#TR069" class="xref">[TR069]</a>.  </li>
</ul>

<p> </p>
<p id="rfc.section.10.3.p.5">The existing WebPKI provides a reasonable anchor between manufacturer name and public key. It authenticates the key.  It does not provide a reasonable authorization for the manufacturer, so it is not directly useable on it's own.  </p>
<h1 id="rfc.section.10.4">
<a href="#rfc.section.10.4">10.4.</a> Manufacturer Maintainance of trust anchors</h1>
<p id="rfc.section.10.4.p.1">BRSKI depends upon the manufacturer building in trust anchors to the pledge device.  The voucher artifact which is signed by the MASA will be validated by the pledge using that anchor.  This implies that the manufacturer needs to maintain access to a signing key that the pledge can validate.  </p>
<p id="rfc.section.10.4.p.2">The manufacturer will need to maintain the ability to make signatures that can be validated for the lifetime that the device could be onboarded. Whether this onboarding lifetime is less than the device lifetime depends upon how the device is used.  An inventory of devices kept in a warehouse as spares might not be onboarded for many decades.  </p>
<p id="rfc.section.10.4.p.3">There are good cryptographic hygiene reasons why a manufacturer would not want to maintain access to a private key for many decades.  A manufacturer in that situation can leverage a long-term certificate authority anchor, built-in to the pledge, and then a certificate chain may be incorporated using the normal CMS certificate set.  This may increase the size of the voucher artifacts, but that is not a significant issues in non-constrained environements.  </p>
<p id="rfc.section.10.4.p.4">There are a few other operational variations that manufacturers could consider. For instance, there is no reason that every device need have the same set of trust anchors pre-installed.  Devices built in different factories, or on different days, or any other consideration could have different trust anchors built in, and the record of which batch the device is in would be recorded in the asset database.  The manufacturer would then know which anchor to sign an artifact against.  </p>
<p id="rfc.section.10.4.p.5">Aside from the concern about long-term access to private keys, a major limiting factor for the shelf-life of many devices will be the age of the cryptographic algorithms included.  A device produced in 2019 will have hardware and software capable of validating algorithms common in 2019, and will have no defense against attacks (both quantum and von-neuman brute force attacks) which have not yet been invented.  This concern is orthogonal to the concern about access to private keys, but this concern likely dominates and limits the lifespan of a device in a warehouse.  If any update to firmware to support new cryptographic mechanism were possible (while the device was in a warehouse), updates to trust anchors would also be done at the same time.  </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Acknowledgements</h1>
<p id="rfc.section.11.p.1">We would like to thank the various reviewers for their input, in particular William Atwood, Brian Carpenter, Toerless Eckert, Fuyu Eleven, Eliot Lear, Sergey Kasatkin, Anoop Kumar, Markus Stenberg, Peter van der Stok, and Thomas Werner </p>
<p id="rfc.section.11.p.2">Significant reviews were done by Jari Arko, Christian Huitema and Russ Housley.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-anima-autonomic-control-plane">[I-D.ietf-anima-autonomic-control-plane]</b></td>
<td class="top">
<a>Eckert, T.</a>, <a>Behringer, M.</a> and <a>S. Bjarnason</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-autonomic-control-plane-18">An Autonomic Control Plane (ACP)</a>", Internet-Draft draft-ietf-anima-autonomic-control-plane-18, August 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-anima-grasp">[I-D.ietf-anima-grasp]</b></td>
<td class="top">
<a>Bormann, C.</a>, <a>Carpenter, B.</a> and <a>B. Liu</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-grasp-15">A Generic Autonomic Signaling Protocol (GRASP)</a>", Internet-Draft draft-ietf-anima-grasp-15, July 2017.</td>
</tr>
<tr>
<td class="reference"><b id="IDevID">[IDevID]</b></td>
<td class="top">
<a>IEEE Standard</a>, "<a href="http://standards.ieee.org/findstds/standard/802.1AR-2009.html">IEEE 802.1AR Secure Device Identifier</a>", December 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="https://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, DOI 10.17487/RFC3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3927">[RFC3927]</b></td>
<td class="top">
<a>Cheshire, S.</a>, <a>Aboba, B.</a> and <a>E. Guttman</a>, "<a href="https://tools.ietf.org/html/rfc3927">Dynamic Configuration of IPv4 Link-Local Addresses</a>", RFC 3927, DOI 10.17487/RFC3927, May 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4086">[RFC4086]</b></td>
<td class="top">
<a>Eastlake 3rd, D.</a>, <a>Schiller, J.</a> and <a>S. Crocker</a>, "<a href="https://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>", BCP 106, RFC 4086, DOI 10.17487/RFC4086, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4519">[RFC4519]</b></td>
<td class="top">
<a>Sciberras, A.</a>, "<a href="https://tools.ietf.org/html/rfc4519">Lightweight Directory Access Protocol (LDAP): Schema for User Applications</a>", RFC 4519, DOI 10.17487/RFC4519, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4862">[RFC4862]</b></td>
<td class="top">
<a>Thomson, S.</a>, <a>Narten, T.</a> and <a>T. Jinmei</a>, "<a href="https://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>", RFC 4862, DOI 10.17487/RFC4862, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4941">[RFC4941]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Draves, R.</a> and <a>S. Krishnan</a>, "<a href="https://tools.ietf.org/html/rfc4941">Privacy Extensions for Stateless Address Autoconfiguration in IPv6</a>", RFC 4941, DOI 10.17487/RFC4941, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="https://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, DOI 10.17487/RFC5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5272">[RFC5272]</b></td>
<td class="top">
<a>Schaad, J.</a> and <a>M. Myers</a>, "<a href="https://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>", RFC 5272, DOI 10.17487/RFC5272, June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5280">[RFC5280]</b></td>
<td class="top">
<a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="https://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, DOI 10.17487/RFC5280, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5386">[RFC5386]</b></td>
<td class="top">
<a>Williams, N.</a> and <a>M. Richardson</a>, "<a href="https://tools.ietf.org/html/rfc5386">Better-Than-Nothing Security: An Unauthenticated Mode of IPsec</a>", RFC 5386, DOI 10.17487/RFC5386, November 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5652">[RFC5652]</b></td>
<td class="top">
<a>Housley, R.</a>, "<a href="https://tools.ietf.org/html/rfc5652">Cryptographic Message Syntax (CMS)</a>", STD 70, RFC 5652, DOI 10.17487/RFC5652, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5660">[RFC5660]</b></td>
<td class="top">
<a>Williams, N.</a>, "<a href="https://tools.ietf.org/html/rfc5660">IPsec Channels: Connection Latching</a>", RFC 5660, DOI 10.17487/RFC5660, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6125">[RFC6125]</b></td>
<td class="top">
<a>Saint-Andre, P.</a> and <a>J. Hodges</a>, "<a href="https://tools.ietf.org/html/rfc6125">Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</a>", RFC 6125, DOI 10.17487/RFC6125, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6762">[RFC6762]</b></td>
<td class="top">
<a>Cheshire, S.</a> and <a>M. Krochmal</a>, "<a href="https://tools.ietf.org/html/rfc6762">Multicast DNS</a>", RFC 6762, DOI 10.17487/RFC6762, February 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6763">[RFC6763]</b></td>
<td class="top">
<a>Cheshire, S.</a> and <a>M. Krochmal</a>, "<a href="https://tools.ietf.org/html/rfc6763">DNS-Based Service Discovery</a>", RFC 6763, DOI 10.17487/RFC6763, February 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7030">[RFC7030]</b></td>
<td class="top">
<a>Pritikin, M.</a>, <a>Yee, P.</a> and <a>D. Harkins</a>, "<a href="https://tools.ietf.org/html/rfc7030">Enrollment over Secure Transport</a>", RFC 7030, DOI 10.17487/RFC7030, October 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7159">[RFC7159]</b></td>
<td class="top">
<a>Bray, T.</a>, "<a href="https://tools.ietf.org/html/rfc7159">The JavaScript Object Notation (JSON) Data Interchange Format</a>", RFC 7159, DOI 10.17487/RFC7159, March 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7950">[RFC7950]</b></td>
<td class="top">
<a>Bjorklund, M.</a>, "<a href="https://tools.ietf.org/html/rfc7950">The YANG 1.1 Data Modeling Language</a>", RFC 7950, DOI 10.17487/RFC7950, August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7951">[RFC7951]</b></td>
<td class="top">
<a>Lhotka, L.</a>, "<a href="https://tools.ietf.org/html/rfc7951">JSON Encoding of Data Modeled with YANG</a>", RFC 7951, DOI 10.17487/RFC7951, August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8366">[RFC8366]</b></td>
<td class="top">
<a>Watsen, K.</a>, <a>Richardson, M.</a>, <a>Pritikin, M.</a> and <a>T. Eckert</a>, "<a href="https://tools.ietf.org/html/rfc8366">A Voucher Artifact for Bootstrapping Protocols</a>", RFC 8366, DOI 10.17487/RFC8366, May 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8368">[RFC8368]</b></td>
<td class="top">
<a>Eckert, T.</a> and <a>M. Behringer</a>, "<a href="https://tools.ietf.org/html/rfc8368">Using an Autonomic Control Plane for Stable Connectivity of Network Operations, Administration, and Maintenance (OAM)</a>", RFC 8368, DOI 10.17487/RFC8368, May 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Dingledine2004">[Dingledine2004]</b></td>
<td class="top">
<a>Dingledine, R.</a>, <a>Mathewson, N.</a> and <a>P. Syverson</a>, "<a href="https://spec.torproject.org/tor-spec">Tor: the second-generation onion router</a>", 2004.</td>
</tr>
<tr>
<td class="reference"><b id="docsisroot">[docsisroot]</b></td>
<td class="top">
<a>CableLabs</a>, "<a href="https://www.cablelabs.com/resources/digital-certificate-issuance-service/">CableLabs Digital Certificate Issuance Service</a>", February 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ace-coap-est">[I-D.ietf-ace-coap-est]</b></td>
<td class="top">
<a>Stok, P.</a>, <a>Kampanakis, P.</a>, <a>Richardson, M.</a> and <a>S. Raza</a>, "<a href="https://tools.ietf.org/html/draft-ietf-ace-coap-est-09">EST over secure CoAP (EST-coaps)</a>", Internet-Draft draft-ietf-ace-coap-est-09, February 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-anima-constrained-voucher">[I-D.ietf-anima-constrained-voucher]</b></td>
<td class="top">
<a>Richardson, M.</a>, <a>Stok, P.</a> and <a>P. Kampanakis</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-constrained-voucher-02">Constrained Voucher Artifacts for Bootstrapping Protocols</a>", Internet-Draft draft-ietf-anima-constrained-voucher-02, September 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-anima-reference-model">[I-D.ietf-anima-reference-model]</b></td>
<td class="top">
<a>Behringer, M.</a>, <a>Carpenter, B.</a>, <a>Eckert, T.</a>, <a>Ciavaglia, L.</a> and <a>J. Nobre</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-reference-model-10">A Reference Model for Autonomic Networking</a>", Internet-Draft draft-ietf-anima-reference-model-10, November 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-anima-stable-connectivity">[I-D.ietf-anima-stable-connectivity]</b></td>
<td class="top">
<a>Eckert, T.</a> and <a>M. Behringer</a>, "<a href="https://tools.ietf.org/html/draft-ietf-anima-stable-connectivity-10">Using Autonomic Control Plane for Stable Connectivity of Network OAM</a>", Internet-Draft draft-ietf-anima-stable-connectivity-10, February 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-cbor-cddl">[I-D.ietf-cbor-cddl]</b></td>
<td class="top">
<a>Birkholz, H.</a>, <a>Vigano, C.</a> and <a>C. Bormann</a>, "<a href="https://tools.ietf.org/html/draft-ietf-cbor-cddl-07">Concise data definition language (CDDL): a notational convention to express CBOR and JSON data structures</a>", Internet-Draft draft-ietf-cbor-cddl-07, February 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-netconf-zerotouch">[I-D.ietf-netconf-zerotouch]</b></td>
<td class="top">
<a>Watsen, K.</a>, <a>Abrahamsson, M.</a> and <a>I. Farrer</a>, "<a href="https://tools.ietf.org/html/draft-ietf-netconf-zerotouch-29">Secure Zero Touch Provisioning (SZTP)</a>", Internet-Draft draft-ietf-netconf-zerotouch-29, January 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-opsawg-mud">[I-D.ietf-opsawg-mud]</b></td>
<td class="top">
<a>Lear, E.</a>, <a>Droms, R.</a> and <a>D. Romascanu</a>, "<a href="https://tools.ietf.org/html/draft-ietf-opsawg-mud-25">Manufacturer Usage Description Specification</a>", Internet-Draft draft-ietf-opsawg-mud-25, June 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.richardson-anima-state-for-joinrouter">[I-D.richardson-anima-state-for-joinrouter]</b></td>
<td class="top">
<a>Richardson, M.</a>, "<a href="https://tools.ietf.org/html/draft-richardson-anima-state-for-joinrouter-02">Considerations for stateful vs stateless join router in ANIMA bootstrap</a>", Internet-Draft draft-richardson-anima-state-for-joinrouter-02, January 2018.</td>
</tr>
<tr>
<td class="reference"><b id="imprinting">[imprinting]</b></td>
<td class="top">
<a>Wikipedia</a>, "<a href="https://en.wikipedia.org/wiki/Imprinting_(psychology)">Wikipedia article: Imprinting</a>", July 2015.</td>
</tr>
<tr>
<td class="reference"><b id="IoTstrangeThings">[IoTstrangeThings]</b></td>
<td class="top">
<a>Internet</a>, "<a href="https://www.welivesecurity.com/2017/03/03/internet-of-things-security-privacy-iot-update/">IoT of toys stranger than fiction: Cybersecurity and data privacy update (accessed 2018-12-02)</a>", March 2017.</td>
</tr>
<tr>
<td class="reference"><b id="livingwithIoT">[livingwithIoT]</b></td>
<td class="top">
<a>Internet</a>, "<a href="https://www.siliconrepublic.com/machines/iot-smart-devices-reality">What is it actually like to live in a house filled with IoT devices? (accessed 2018-12-02)</a>", February 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2473">[RFC2473]</b></td>
<td class="top">
<a>Conta, A.</a> and <a>S. Deering</a>, "<a href="https://tools.ietf.org/html/rfc2473">Generic Packet Tunneling in IPv6 Specification</a>", RFC 2473, DOI 10.17487/RFC2473, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2663">[RFC2663]</b></td>
<td class="top">
<a>Srisuresh, P.</a> and <a>M. Holdrege</a>, "<a href="https://tools.ietf.org/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a>", RFC 2663, DOI 10.17487/RFC2663, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5785">[RFC5785]</b></td>
<td class="top">
<a>Nottingham, M.</a> and <a>E. Hammer-Lahav</a>, "<a href="https://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>", RFC 5785, DOI 10.17487/RFC5785, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6960">[RFC6960]</b></td>
<td class="top">
<a>Santesson, S.</a>, <a>Myers, M.</a>, <a>Ankney, R.</a>, <a>Malpani, A.</a>, <a>Galperin, S.</a> and <a>C. Adams</a>, "<a href="https://tools.ietf.org/html/rfc6960">X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP</a>", RFC 6960, DOI 10.17487/RFC6960, June 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6961">[RFC6961]</b></td>
<td class="top">
<a>Pettersen, Y.</a>, "<a href="https://tools.ietf.org/html/rfc6961">The Transport Layer Security (TLS) Multiple Certificate Status Request Extension</a>", RFC 6961, DOI 10.17487/RFC6961, June 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7217">[RFC7217]</b></td>
<td class="top">
<a>Gont, F.</a>, "<a href="https://tools.ietf.org/html/rfc7217">A Method for Generating Semantically Opaque Interface Identifiers with IPv6 Stateless Address Autoconfiguration (SLAAC)</a>", RFC 7217, DOI 10.17487/RFC7217, April 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7228">[RFC7228]</b></td>
<td class="top">
<a>Bormann, C.</a>, <a>Ersue, M.</a> and <a>A. Keranen</a>, "<a href="https://tools.ietf.org/html/rfc7228">Terminology for Constrained-Node Networks</a>", RFC 7228, DOI 10.17487/RFC7228, May 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7258">[RFC7258]</b></td>
<td class="top">
<a>Farrell, S.</a> and <a>H. Tschofenig</a>, "<a href="https://tools.ietf.org/html/rfc7258">Pervasive Monitoring Is an Attack</a>", BCP 188, RFC 7258, DOI 10.17487/RFC7258, May 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7435">[RFC7435]</b></td>
<td class="top">
<a>Dukhovni, V.</a>, "<a href="https://tools.ietf.org/html/rfc7435">Opportunistic Security: Some Protection Most of the Time</a>", RFC 7435, DOI 10.17487/RFC7435, December 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7575">[RFC7575]</b></td>
<td class="top">
<a>Behringer, M.</a>, <a>Pritikin, M.</a>, <a>Bjarnason, S.</a>, <a>Clemm, A.</a>, <a>Carpenter, B.</a>, <a>Jiang, S.</a> and <a>L. Ciavaglia</a>, "<a href="https://tools.ietf.org/html/rfc7575">Autonomic Networking: Definitions and Design Goals</a>", RFC 7575, DOI 10.17487/RFC7575, June 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8340">[RFC8340]</b></td>
<td class="top">
<a>Bjorklund, M.</a> and <a>L. Berger</a>, "<a href="https://tools.ietf.org/html/rfc8340">YANG Tree Diagrams</a>", BCP 215, RFC 8340, DOI 10.17487/RFC8340, March 2018.</td>
</tr>
<tr>
<td class="reference"><b id="slowloris">[slowloris]</b></td>
<td class="top">
<a>Wikipedia</a>, "<a href="https://en.wikipedia.org/wiki/Slowloris_(computer_security)/">Slowloris (computer security)</a>", February 2019.</td>
</tr>
<tr>
<td class="reference"><b id="Stajano99theresurrecting">[Stajano99theresurrecting]</b></td>
<td class="top">
<a>Stajano, F.</a> and <a>R. Anderson</a>, "<a href="https://www.cl.cam.ac.uk/~fms27/papers/1999-StajanoAnd-duckling.pdf">The resurrecting duckling: security issues for ad-hoc wireless networks</a>", 1999.</td>
</tr>
<tr>
<td class="reference"><b id="TR069">[TR069]</b></td>
<td class="top">
<a>Broadband Forum</a>, "<a href="https://www.broadband-forum.org/standards-and-software/technical-specifications/tr-069-files-tools">TR-69: CPE WAN Management Protocol</a>", February 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#IPv4operations" id="IPv4operations">IPv4 and non-ANI operations</a>
</h1>
<p id="rfc.section.A.p.1">The secification of BRSKI in <a href="#proxydetails" class="xref">Section 4</a> intentionally only covers the mechanisms for an IPv6 pledge using Link-Local addresses.  This section describes non-normative extensions that can be used in other environments.  </p>
<h1 id="rfc.appendix.A.1">
<a href="#rfc.appendix.A.1">A.1.</a> IPv4 Link Local addresses</h1>
<p id="rfc.section.A.1.p.1">Instead of an IPv6 link-local address, an IPv4 address may be generated using <a href="#RFC3927" class="xref">[RFC3927]</a>  Dynamic Configuration of IPv4 Link-Local Addresses.  </p>
<p id="rfc.section.A.1.p.2">In the case that an IPv4 Link-Local address is formed, then the bootstrap process would continue as in the IPv6 case by looking for a (circuit) proxy.  </p>
<h1 id="rfc.appendix.A.2">
<a href="#rfc.appendix.A.2">A.2.</a> <a href="#IPv4dhcp" id="IPv4dhcp">Use of DHCPv4</a>
</h1>
<p id="rfc.section.A.2.p.1">The Plege MAY obtain an IP address via DHCP [RFC2131]. The DHCP provided parameters for the Domain Name System can be used to perform DNS operations if all local discovery attempts fail.  </p>
<h1 id="rfc.appendix.B">
<a href="#rfc.appendix.B">Appendix B.</a> <a href="#mdnsmethods" id="mdnsmethods">mDNS / DNSSD proxy discovery options</a>
</h1>
<p id="rfc.section.B.p.1">Pledge discovery of the proxy (<a href="#discovery" class="xref">Section 4.1</a>) MAY be performed with DNS-based Service Discovery <a href="#RFC6763" class="xref">[RFC6763]</a> over Multicast DNS <a href="#RFC6762" class="xref">[RFC6762]</a> to discover the proxy at "_brski-proxy._tcp.local.". </p>
<p id="rfc.section.B.p.2">Proxy discovery of the registrar (<a href="#JRCgrasp" class="xref">Section 4.3</a>) MAY be performed with DNS-based Service Discovery over Multicast DNS to discover registrars by searching for the service "_brski-registrar._tcp.local.".</p>
<p id="rfc.section.B.p.3">To prevent unaccceptable levels of network traffic, when using mDNS, the congestion avoidance mechanisms specified in <a href="#RFC6762" class="xref">[RFC6762]</a> section 7 MUST be followed. The pledge SHOULD listen for an unsolicited broadcast response as described in <a href="#RFC6762" class="xref">[RFC6762]</a>. This allows devices to avoid announcing their presence via mDNS broadcasts and instead silently join a network by watching for periodic unsolicited broadcast responses.  </p>
<p id="rfc.section.B.p.4">Discovery of registrar MAY also be performed with DNS-based service discovery by searching for the service "_brski-registrar._tcp.example.com".  In this case the domain "example.com" is discovered as described in <a href="#RFC6763" class="xref">[RFC6763]</a> section 11 (<a href="#IPv4dhcp" class="xref">Appendix A.2</a> suggests the use of DHCP parameters).  </p>
<p id="rfc.section.B.p.5">If no local proxy or registrar service is located using the GRASP mechanisms or the above mentioned DNS-based Service Discovery methods the pledge MAY contact a well known manufacturer provided bootstrapping server by performing a DNS lookup using a well known URI such as "brski-registrar.manufacturer.example.com". The details of the URI are manufacturer specific. Manufacturers that leverage this method on the pledge are responsible for providing the registrar service.  Also see <a href="#cloudregistrar" class="xref">Section 2.7</a>.  </p>
<p id="rfc.section.B.p.6">The current DNS services returned during each query are maintained until bootstrapping is completed. If bootstrapping fails and the pledge returns to the Discovery state, it picks up where it left off and continues attempting bootstrapping.  For example, if the first Multicast DNS _bootstrapks._tcp.local response doesn't work then the second and third responses are tried.  If these fail the pledge moves on to normal DNS-based Service Discovery.  </p>
<h1 id="rfc.appendix.C">
<a href="#rfc.appendix.C">Appendix C.</a> <a href="#mud-extension" id="mud-extension">MUD Extension</a>
</h1>
<pre>
module: ietf-mud-brski-masa
augment /ietf-mud:mud:
+--rw masa-server?   inet:uri
</pre>
<p id="rfc.section.C.p.1">The following extension augments the MUD model to include a single node, as described in <a href="#I-D.ietf-opsawg-mud" class="xref">[I-D.ietf-opsawg-mud]</a> section 3.6, using the following sample module that has the following tree structure: </p>
<pre>
&lt;CODE BEGINS&gt; file "ietf-mud-extension@2018-02-14.yang"
module ietf-mud-brski-masa {
  yang-version 1.1;
  namespace "urn:ietf:params:xml:ns:yang:ietf-mud-brski-masa";
  prefix ietf-mud-brski-masa;
  import ietf-mud {
    prefix ietf-mud;
  }
  import ietf-inet-types {
    prefix inet;
  }

  organization
    "IETF ANIMA (Autonomic Networking Integrated Model and
    Approach) Working Group";
    contact
    "WG Web: http://tools.ietf.org/wg/anima/
    WG List: anima@ietf.org
    ";
  description
    "BRSKI extension to a MUD file to indicate the
    MASA URL.";

  revision 2018-02-14 {
    description
    "Initial revision.";
    reference
    "RFC XXXX: Manufacturer Usage Description
    Specification";
  }

  augment "/ietf-mud:mud" {
    description
    "BRSKI extension to a MUD file to indicate the
    MASA URL.";
    leaf masa-server {
      type inet:uri;
      description
      "This value is the URI of the MASA server";
    }
  }
}
&lt;CODE ENDS&gt;
</pre>
<p id="rfc.section.C.p.2">The model is defined as follows: </p>
<p id="rfc.section.C.p.3">The MUD extensions string "masa" is defined, and MUST be included in the extensions array of the mud container of a MUD file when this extension is used.  </p>
<h1 id="rfc.appendix.D">
<a href="#rfc.appendix.D">Appendix D.</a> Example Vouchers</h1>
<p id="rfc.section.D.p.1">Three entities are involved in a voucher: the MASA issues (signs) it, the registrar's public key is mentioned in the voucher, and the pledge validates it.  In order to provide reproduceable examples the public and private keys for an example MASA and registrar are first listed.  </p>
<h1 id="rfc.appendix.D.1">
<a href="#rfc.appendix.D.1">D.1.</a> Keys involved</h1>
<p id="rfc.section.D.1.p.1">The Manufacturer has a Certificate Authority that signs the pledge's IDevID.  In addition the Manufacturer's signing authority (the MASA) signs the vouchers, and that certificate must distributed to the devices at manufacturing time so that vouchers can be validated.  </p>
<p></p>
<h1 id="rfc.appendix.D.1.1">
<a href="#rfc.appendix.D.1.1">D.1.1.</a> MASA key pair for voucher signatures</h1>
<pre>
-----BEGIN EC PRIVATE KEY-----
MIGkAgEBBDAgiRoYqKoEcfOfvRvmZ5P5Azn58tuI7nSnIy7OgFnCeiNo+BmbgMho
r6lcU60gwVagBwYFK4EEACKhZANiAATZAH3Rb2FvIJOnts+vXuWW35ofyNbCHzjA
zOi2kWZFE1ByurKImNcNMFGirGnRXIXGqWCfw5ICgJ8CuM3vV5ty9bf7KUlOkejz
Tvv+5PV++elkP9HQ83vqTAws2WwWTxI=
-----END EC PRIVATE KEY-----
</pre>
<pre>
-----BEGIN CERTIFICATE-----
MIIBzzCCAVagAwIBAgIBATAKBggqhkjOPQQDAjBNMRIwEAYKCZImiZPyLGQBGRYC
Y2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHDAaBgNVBAMME1Vuc3RydW5n
IEhpZ2h3YXkgQ0EwHhcNMTcwMzI2MTYxOTQwWhcNMTkwMzI2MTYxOTQwWjBHMRIw
EAYKCZImiZPyLGQBGRYCY2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xFjAU
BgNVBAMMDVVuc3RydW5nIE1BU0EwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAATZAH3R
b2FvIJOnts+vXuWW35ofyNbCHzjAzOi2kWZFE1ByurKImNcNMFGirGnRXIXGqWCf
w5ICgJ8CuM3vV5ty9bf7KUlOkejzTvv+5PV++elkP9HQ83vqTAws2WwWTxKjEDAO
MAwGA1UdEwEB/wQCMAAwCgYIKoZIzj0EAwIDZwAwZAIwGb0oyM0doP6t3/LSPL5O
DuatEwMYh7WGO+IYTHC8K7EyHBOmCYReKT2+GhV/CLWzAjBNy6UMJTt1tsxJsJqd
MPUIFj+4wZg1AOIb/JoA6M7r33pwLQTrHRxEzVMGfWOkYUw=
-----END CERTIFICATE-----
</pre>
<p id="rfc.section.D.1.1.p.1">This private key signs vouchers: </p>
<h1 id="rfc.appendix.D.1.2">
<a href="#rfc.appendix.D.1.2">D.1.2.</a> Manufacturer key pair for IDevID signatures</h1>
<pre>
-----BEGIN EC PRIVATE KEY-----
MIGkAgEBBDAgiRoYqKoEcfOfvRvmZ5P5Azn58tuI7nSnIy7OgFnCeiNo+BmbgMho
r6lcU60gwVagBwYFK4EEACKhZANiAATZAH3Rb2FvIJOnts+vXuWW35ofyNbCHzjA
zOi2kWZFE1ByurKImNcNMFGirGnRXIXGqWCfw5ICgJ8CuM3vV5ty9bf7KUlOkejz
Tvv+5PV++elkP9HQ83vqTAws2WwWTxI=
-----END EC PRIVATE KEY-----
</pre>
<pre>
-----BEGIN CERTIFICATE-----
MIIBzzCCAVagAwIBAgIBATAKBggqhkjOPQQDAjBNMRIwEAYKCZImiZPyLGQBGRYC
Y2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHDAaBgNVBAMME1Vuc3RydW5n
IEhpZ2h3YXkgQ0EwHhcNMTcwMzI2MTYxOTQwWhcNMTkwMzI2MTYxOTQwWjBHMRIw
EAYKCZImiZPyLGQBGRYCY2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xFjAU
BgNVBAMMDVVuc3RydW5nIE1BU0EwdjAQBgcqhkjOPQIBBgUrgQQAIgNiAATZAH3R
b2FvIJOnts+vXuWW35ofyNbCHzjAzOi2kWZFE1ByurKImNcNMFGirGnRXIXGqWCf
w5ICgJ8CuM3vV5ty9bf7KUlOkejzTvv+5PV++elkP9HQ83vqTAws2WwWTxKjEDAO
MAwGA1UdEwEB/wQCMAAwCgYIKoZIzj0EAwIDZwAwZAIwGb0oyM0doP6t3/LSPL5O
DuatEwMYh7WGO+IYTHC8K7EyHBOmCYReKT2+GhV/CLWzAjBNy6UMJTt1tsxJsJqd
MPUIFj+4wZg1AOIb/JoA6M7r33pwLQTrHRxEzVMGfWOkYUw=
-----END CERTIFICATE-----
</pre>
<p id="rfc.section.D.1.2.p.1">This private key signs IDevID certificates: </p>
<h1 id="rfc.appendix.D.1.3">
<a href="#rfc.appendix.D.1.3">D.1.3.</a> Registrar key pair</h1>
<pre>
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIF+obiToYYYeMifPsZvrjWJ0yFsCJwIFhpokmT/TULmXoAoGCCqGSM49
AwEHoUQDQgAENWQOzcNMUjP0NrtfeBc0DJLWfeMGgCFdIv6FUz4DifM1ujMBec/g
6W/P6boTmyTGdFOh/8HwKUerL5bpneK8sg==
-----END EC PRIVATE KEY-----
</pre>
<pre>
-----BEGIN CERTIFICATE-----
MIIBrjCCATOgAwIBAgIBAzAKBggqhkjOPQQDAzBOMRIwEAYKCZImiZPyLGQBGRYC
Y2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHTAbBgNVBAMMFFVuc3RydW5n
IEZvdW50YWluIENBMB4XDTE3MDkwNTAxMTI0NVoXDTE5MDkwNTAxMTI0NVowQzES
MBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJc2FuZGVsbWFuMRIw
EAYDVQQDDAlsb2NhbGhvc3QwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQ1ZA7N
w0xSM/Q2u194FzQMktZ94waAIV0i/oVTPgOJ8zW6MwF5z+Dpb8/puhObJMZ0U6H/
wfApR6svlumd4ryyow0wCzAJBgNVHRMEAjAAMAoGCCqGSM49BAMDA2kAMGYCMQC3
/iTQJ3evYYcgbXhbmzrp64t3QC6qjIeY2jkDx062nuNifVKtyaara3F30AIkKSEC
MQDi29efbTLbdtDk3tecY/rD7V77XaJ6nYCmdDCR54TrSFNLgxvt1lyFM+0fYpYR
c3o=
-----END CERTIFICATE-----
</pre>
<pre>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 3 (0x3)
    Signature Algorithm: ecdsa-with-SHA384
        Issuer: DC=ca, DC=sandelman, CN=Unstrung Fountain CA
        Validity
            Not Before: Sep  5 01:12:45 2017 GMT
            Not After : Sep  5 01:12:45 2019 GMT
        Subject: DC=ca, DC=sandelman, CN=localhost
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub: 
                    04:35:64:0e:cd:c3:4c:52:33:f4:36:bb:5f:7
8:17:
                    34:0c:92:d6:7d:e3:06:80:21:5d:22:fe:85:5
3:3e:
                    03:89:f3:35:ba:33:01:79:cf:e0:e9:6f:cf:e
9:ba:
                    13:9b:24:c6:74:53:a1:ff:c1:f0:29:47:ab:2
f:96:
                    e9:9d:e2:bc:b2
                ASN1 OID: prime256v1
        X509v3 extensions:
            X509v3 Basic Constraints: 
                CA:FALSE
    Signature Algorithm: ecdsa-with-SHA384
         30:66:02:31:00:b7:fe:24:d0:27:77:af:61:87:20:6d:78:
5b:
         9b:3a:e9:eb:8b:77:40:2e:aa:8c:87:98:da:39:03:c7:4e:
b6:
         9e:e3:62:7d:52:ad:c9:a6:ab:6b:71:77:d0:02:24:29:21:
02:
         31:00:e2:db:d7:9f:6d:32:db:76:d0:e4:de:d7:9c:63:fa:
c3:
         ed:5e:fb:5d:a2:7a:9d:80:a6:74:30:91:e7:84:eb:48:53:
4b:
         83:1b:ed:d6:5c:85:33:ed:1f:62:96:11:73:7a
</pre>
<p id="rfc.section.D.1.3.p.1">The registrar key (or chain) is the representative of the domain owner.  This key signs registrar voucher-requests: </p>
<h1 id="rfc.appendix.D.1.4">
<a href="#rfc.appendix.D.1.4">D.1.4.</a> Pledge key pair</h1>
<pre>
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIL+ue8PQcN+M7LFBGPsompYwobI/rsoHnTb2a+0hO+8joAoGCCqGSM49
AwEHoUQDQgAEumBVaDlX87WyME8CJToyt9NWy6sYw0DTbjjJIn79pgr7ALa//Y8p
r70WpK1SIaiUeeFw7e+lCzTp1Z+wJu14Bg==
-----END EC PRIVATE KEY-----
</pre>
<pre>
-----BEGIN CERTIFICATE-----
MIICMjCCAbegAwIBAgIBDDAKBggqhkjOPQQDAjBNMRIwEAYKCZImiZPyLGQBGRYC
Y2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHDAaBgNVBAMME1Vuc3RydW5n
IEhpZ2h3YXkgQ0EwIBcNMTcxMDEyMTM1MjUyWhgPMjk5OTEyMzEwMDAwMDBaMEsx
EjAQBgoJkiaJk/IsZAEZFgJjYTEZMBcGCgmSJomT8ixkARkWCXNhbmRlbG1hbjEa
MBgGA1UEAwwRMDAtRDAtRTUtRjItMDAtMDIwWTATBgcqhkjOPQIBBggqhkjOPQMB
BwNCAARJp5i0dU1aUnR2u8wMRwgkNupNbNM7m1n0mj+0KJZjcPIqID+trPjTSobt
uIdpRPfGZ8hU/nIUveqwyoYI8BPbo4GHMIGEMB0GA1UdDgQWBBQdMRZhthFQmzz6
E7YVXzkL7XZDKjAJBgNVHRMEAjAAMCsGA1UdEQQkMCKgIAYJKwYBBAGC7lIBoBMM
ETAwLUQwLUU1LUYyLTAwLTAyMCsGCSsGAQQBgu5SAgQeDBxodHRwczovL2hpZ2h3
YXkuc2FuZGVsbWFuLmNhMAoGCCqGSM49BAMCA2kAMGYCMQDhJ1N+eanW1U/e5qoM
SGvUvWHR7uic8cJbh7vXy580nBs8bpNn60k/+IzvEUetMzICMQCr1uxvdYeKq7mb
RXCR4ZCJsw67fJ7jyXZbCUSir+3wBT2+lWggzPDRgYB5ABb7sAw=
-----END CERTIFICATE-----
</pre>
<pre>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 12 (0xc)
    Signature Algorithm: ecdsa-with-SHA256
        Issuer: DC=ca, DC=sandelman, CN=Unstrung Highway CA
        Validity
            Not Before: Oct 12 13:52:52 2017 GMT
            Not After : Dec 31 00:00:00 2999 GMT
        Subject: DC=ca, DC=sandelman, CN=00-D0-E5-F2-00-02
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub: 
                    04:49:a7:98:b4:75:4d:5a:52:74:76:bb:cc:0
c:47:
                    08:24:36:ea:4d:6c:d3:3b:9b:59:f4:9a:3f:b
4:28:
                    96:63:70:f2:2a:20:3f:ad:ac:f8:d3:4a:86:e
d:b8:
                    87:69:44:f7:c6:67:c8:54:fe:72:14:bd:ea:b
0:ca:
                    86:08:f0:13:db
                ASN1 OID: prime256v1
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                1D:31:16:61:B6:11:50:9B:3C:FA:13:B6:15:5F:39
:0B:ED:76:43:2A
            X509v3 Basic Constraints: 
                CA:FALSE
            X509v3 Subject Alternative Name: 
                othername:&lt;unsupported&gt;
            1.3.6.1.4.1.46930.2: 
                ..https://highway.sandelman.ca
    Signature Algorithm: ecdsa-with-SHA256
         30:66:02:31:00:e1:27:53:7e:79:a9:d6:d5:4f:de:e6:aa:
0c:
         48:6b:d4:bd:61:d1:ee:e8:9c:f1:c2:5b:87:bb:d7:cb:9f:
34:
         9c:1b:3c:6e:93:67:eb:49:3f:f8:8c:ef:11:47:ad:33:32:
02:
         31:00:ab:d6:ec:6f:75:87:8a:ab:b9:9b:45:70:91:e1:90:
89:
         b3:0e:bb:7c:9e:e3:c9:76:5b:09:44:a2:af:ed:f0:05:3d:
be:
         95:68:20:cc:f0:d1:81:80:79:00:16:fb:b0:0c
</pre>
<p id="rfc.section.D.1.4.p.1">The pledge has an IDevID key pair built in at manufacturing time: <a href="#IDevIDextension" class="xref">Section 2.3</a>.  RFC-EDITOR: Note that these certificates are using a Private Enterprise Number for the not-yet-assigned by IANA MASA URL, and need to be replaced before AUTH48.  </p>
<h1 id="rfc.appendix.D.2">
<a href="#rfc.appendix.D.2">D.2.</a> <a href="#exampleprocess" id="exampleprocess">Example process</a>
</h1>
<p id="rfc.section.D.2.p.1">RFC-EDITOR: these examples will need to be replaced with CMS versions once IANA has assigned the eContentType in <a href="#RFC8366" class="xref">[RFC8366]</a>.  </p>
<h1 id="rfc.appendix.D.2.1">
<a href="#rfc.appendix.D.2.1">D.2.1.</a> Pledge to Registrar</h1>
<pre>
MIIHHAYJKoZIhvcNAQcCoIIHDTCCBwkCAQExDzANBglghkgBZQMEAgEFADCC
Aw4GCSqGSIb3DQEHAaCCAv8EggL7eyJpZXRmLXZvdWNoZXItcmVxdWVzdDp2
b3VjaGVyIjp7ImFzc2VydGlvbiI6InByb3hpbWl0eSIsImNyZWF0ZWQtb24i
OiIyMDE3LTA5LTAxIiwic2VyaWFsLW51bWJlciI6IjAwLUQwLUU1LUYyLTAw
LTAyIiwibm9uY2UiOiJEc3M5OXNCcjNwTk1PQUNlLUxZWTd3IiwicHJveGlt
aXR5LXJlZ2lzdHJhci1jZXJ0IjoiTUlJQnJqQ0NBVE9nQXdJQkFnSUJBekFL
QmdncWhrak9QUVFEQXpCT01SSXdFQVlLQ1pJbWlaUHlMR1FCR1JZQ1kyRXhH
VEFYQmdvSmtpYUprL0lzWkFFWkZnbHpZVzVrWld4dFlXNHhIVEFiQmdOVkJB
TU1GRlZ1YzNSeWRXNW5JRVp2ZFc1MFlXbHVJRU5CTUI0WERURTNNRGt3TlRB
eE1USTBOVm9YRFRFNU1Ea3dOVEF4TVRJME5Wb3dRekVTTUJBR0NnbVNKb21U
OGl4a0FSa1dBbU5oTVJrd0Z3WUtDWkltaVpQeUxHUUJHUllKYzJGdVpHVnNi
V0Z1TVJJd0VBWURWUVFEREFsc2IyTmhiR2h2YzNRd1dUQVRCZ2NxaGtqT1BR
SUJCZ2dxaGtqT1BRTUJCd05DQUFRMVpBN053MHhTTS9RMnUxOTRGelFNa3Ra
OTR3YUFJVjBpL29WVFBnT0o4elc2TXdGNXorRHBiOC9wdWhPYkpNWjBVNkgv
d2ZBcFI2c3ZsdW1kNHJ5eW93MHdDekFKQmdOVkhSTUVBakFBTUFvR0NDcUdT
TTQ5QkFNREEya0FNR1lDTVFDMy9pVFFKM2V2WVljZ2JYaGJtenJwNjR0M1FD
NnFqSWVZMmprRHgwNjJudU5pZlZLdHlhYXJhM0YzMEFJa0tTRUNNUURpMjll
ZmJUTGJkdERrM3RlY1kvckQ3Vjc3WGFKNm5ZQ21kRENSNTRUclNGTkxneHZ0
MWx5Rk0rMGZZcFlSYzNvPSJ9faCCAjYwggIyMIIBt6ADAgECAgEMMAoGCCqG
SM49BAMCME0xEjAQBgoJkiaJk/IsZAEZFgJjYTEZMBcGCgmSJomT8ixkARkW
CXNhbmRlbG1hbjEcMBoGA1UEAwwTVW5zdHJ1bmcgSGlnaHdheSBDQTAgFw0x
NzEwMTIxMzUyNTJaGA8yOTk5MTIzMTAwMDAwMFowSzESMBAGCgmSJomT8ixk
ARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJc2FuZGVsbWFuMRowGAYDVQQDDBEw
MC1EMC1FNS1GMi0wMC0wMjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEmn
mLR1TVpSdHa7zAxHCCQ26k1s0zubWfSaP7QolmNw8iogP62s+NNKhu24h2lE
98ZnyFT+chS96rDKhgjwE9ujgYcwgYQwHQYDVR0OBBYEFB0xFmG2EVCbPPoT
thVfOQvtdkMqMAkGA1UdEwQCMAAwKwYDVR0RBCQwIqAgBgkrBgEEAYLuUgGg
EwwRMDAtRDAtRTUtRjItMDAtMDIwKwYJKwYBBAGC7lICBB4MHGh0dHBzOi8v
aGlnaHdheS5zYW5kZWxtYW4uY2EwCgYIKoZIzj0EAwIDaQAwZgIxAOEnU355
qdbVT97mqgxIa9S9YdHu6JzxwluHu9fLnzScGzxuk2frST/4jO8RR60zMgIx
AKvW7G91h4qruZtFcJHhkImzDrt8nuPJdlsJRKKv7fAFPb6VaCDM8NGBgHkA
FvuwDDGCAaUwggGhAgEBMFIwTTESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYK
CZImiZPyLGQBGRYJc2FuZGVsbWFuMRwwGgYDVQQDDBNVbnN0cnVuZyBIaWdo
d2F5IENBAgEMMA0GCWCGSAFlAwQCAQUAoIHkMBgGCSqGSIb3DQEJAzELBgkq
hkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTE3MTAxMjE3NTQzMFowLwYJKoZI
hvcNAQkEMSIEIP59cuKVAPkKOOlQIaIV/W1AsWKbmVmBd9wFSuD5yLafMHkG
CSqGSIb3DQEJDzFsMGowCwYJYIZIAWUDBAEqMAsGCWCGSAFlAwQBFjALBglg
hkgBZQMEAQIwCgYIKoZIhvcNAwcwDgYIKoZIhvcNAwICAgCAMA0GCCqGSIb3
DQMCAgFAMAcGBSsOAwIHMA0GCCqGSIb3DQMCAgEoMAoGCCqGSM49BAMCBEYw
RAIgYUy0NTdP+xTkm/Et69eI++S/2z3dQwPKOwdL0cDCSvACIAh3jJbybMnK
cf7DKKnsn2G/O06HeB/8imMI+hnA7CfN
</pre>
<p id="rfc.section.D.2.1.p.1">As described in <a href="#RequestVoucherFromRegistrar" class="xref">Section 5.2</a>, the pledge will sign a pledge voucher-request containing the registrar's public key in the proximity-registrar-cert field.  The base64 has been wrapped at 60 characters for presentation reasons.  </p>

<p>file: examples/vr_00-D0-E5-F2-00-02.pkcs</p>
<pre>
    0:d=0  hl=4 l=1820 cons: SEQUENCE          
    4:d=1  hl=2 l=   9 prim: OBJECT            :pkcs7-signed
Data
   15:d=1  hl=4 l=1805 cons: cont [ 0 ]        
   19:d=2  hl=4 l=1801 cons: SEQUENCE          
   23:d=3  hl=2 l=   1 prim: INTEGER           :01
   26:d=3  hl=2 l=  15 cons: SET               
   28:d=4  hl=2 l=  13 cons: SEQUENCE          
   30:d=5  hl=2 l=   9 prim: OBJECT            :sha256
   41:d=5  hl=2 l=   0 prim: NULL              
   43:d=3  hl=4 l= 782 cons: SEQUENCE          
   47:d=4  hl=2 l=   9 prim: OBJECT            :pkcs7-data
   58:d=4  hl=4 l= 767 cons: cont [ 0 ]        
   62:d=5  hl=4 l= 763 prim: OCTET STRING      :{"ietf-vouch
er-request:voucher":{"assertion":"proximity","created-on":"2
017-09-01","serial-number":"00-D0-E5-F2-00-02","nonce":"Dss9
9sBr3pNMOACe-LYY7w","proximity-registrar-cert":"MIIBrjCCATOg
AwIBAgIBAzAKBggqhkjOPQQDAzBOMRIwEAYKCZImiZPyLGQBGRYCY2ExGTAX
BgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHTAbBgNVBAMMFFVuc3RydW5nIEZv
dW50YWluIENBMB4XDTE3MDkwNTAxMTI0NVoXDTE5MDkwNTAxMTI0NVowQzES
MBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJc2FuZGVsbWFu
MRIwEAYDVQQDDAlsb2NhbGhvc3QwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNC
AAQ1ZA7Nw0xSM/Q2u194FzQMktZ94waAIV0i/oVTPgOJ8zW6MwF5z+Dpb8/p
uhObJMZ0U6H/wfApR6svlumd4ryyow0wCzAJBgNVHRMEAjAAMAoGCCqGSM49
BAMDA2kAMGYCMQC3/iTQJ3evYYcgbXhbmzrp64t3QC6qjIeY2jkDx062nuNi
fVKtyaara3F30AIkKSECMQDi29efbTLbdtDk3tecY/rD7V77XaJ6nYCmdDCR
54TrSFNLgxvt1lyFM+0fYpYRc3o="}}
  829:d=3  hl=4 l= 566 cons: cont [ 0 ]        
  833:d=4  hl=4 l= 562 cons: SEQUENCE          
  837:d=5  hl=4 l= 439 cons: SEQUENCE          
  841:d=6  hl=2 l=   3 cons: cont [ 0 ]        
  843:d=7  hl=2 l=   1 prim: INTEGER           :02
  846:d=6  hl=2 l=   1 prim: INTEGER           :0C
  849:d=6  hl=2 l=  10 cons: SEQUENCE          
  851:d=7  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
  861:d=6  hl=2 l=  77 cons: SEQUENCE          
  863:d=7  hl=2 l=  18 cons: SET               
  865:d=8  hl=2 l=  16 cons: SEQUENCE          
  867:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  879:d=9  hl=2 l=   2 prim: IA5STRING         :ca
  883:d=7  hl=2 l=  25 cons: SET               
  885:d=8  hl=2 l=  23 cons: SEQUENCE          
  887:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  899:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
  910:d=7  hl=2 l=  28 cons: SET               
  912:d=8  hl=2 l=  26 cons: SEQUENCE          
  914:d=9  hl=2 l=   3 prim: OBJECT            :commonName
  919:d=9  hl=2 l=  19 prim: UTF8STRING        :Unstrung Hig
hway CA
  940:d=6  hl=2 l=  32 cons: SEQUENCE          
  942:d=7  hl=2 l=  13 prim: UTCTIME           :171012135252
Z
  957:d=7  hl=2 l=  15 prim: GENERALIZEDTIME   :299912310000
00Z
  974:d=6  hl=2 l=  75 cons: SEQUENCE          
  976:d=7  hl=2 l=  18 cons: SET               
  978:d=8  hl=2 l=  16 cons: SEQUENCE          
  980:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  992:d=9  hl=2 l=   2 prim: IA5STRING         :ca
  996:d=7  hl=2 l=  25 cons: SET               
  998:d=8  hl=2 l=  23 cons: SEQUENCE          
 1000:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1012:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 1023:d=7  hl=2 l=  26 cons: SET               
 1025:d=8  hl=2 l=  24 cons: SEQUENCE          
 1027:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 1032:d=9  hl=2 l=  17 prim: UTF8STRING        :00-D0-E5-F2-
00-02
 1051:d=6  hl=2 l=  89 cons: SEQUENCE          
 1053:d=7  hl=2 l=  19 cons: SEQUENCE          
 1055:d=8  hl=2 l=   7 prim: OBJECT            :id-ecPublicK
ey
 1064:d=8  hl=2 l=   8 prim: OBJECT            :prime256v1
 1074:d=7  hl=2 l=  66 prim: BIT STRING        
 1142:d=6  hl=3 l= 135 cons: cont [ 3 ]        
 1145:d=7  hl=3 l= 132 cons: SEQUENCE          
 1148:d=8  hl=2 l=  29 cons: SEQUENCE          
 1150:d=9  hl=2 l=   3 prim: OBJECT            :X509v3 Subje
ct Key Identifier
 1155:d=9  hl=2 l=  22 prim: OCTET STRING      [HEX DUMP]:04
141D311661B611509B3CFA13B6155F390BED76432A
 1179:d=8  hl=2 l=   9 cons: SEQUENCE          
 1181:d=9  hl=2 l=   3 prim: OBJECT            :X509v3 Basic
 Constraints
 1186:d=9  hl=2 l=   2 prim: OCTET STRING      [HEX DUMP]:30
00
 1190:d=8  hl=2 l=  43 cons: SEQUENCE          
 1192:d=9  hl=2 l=   3 prim: OBJECT            :X509v3 Subje
ct Alternative Name
 1197:d=9  hl=2 l=  36 prim: OCTET STRING      [HEX DUMP]:30
22A02006092B0601040182EE5201A0130C1130302D44302D45352D46322D
30302D3032
 1235:d=8  hl=2 l=  43 cons: SEQUENCE          
 1237:d=9  hl=2 l=   9 prim: OBJECT            :1.3.6.1.4.1.
46930.2
 1248:d=9  hl=2 l=  30 prim: OCTET STRING      [HEX DUMP]:0C
1C68747470733A2F2F686967687761792E73616E64656C6D616E2E6361
 1280:d=5  hl=2 l=  10 cons: SEQUENCE          
 1282:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
 1292:d=5  hl=2 l= 105 prim: BIT STRING        
 1399:d=3  hl=4 l= 421 cons: SET               
 1403:d=4  hl=4 l= 417 cons: SEQUENCE          
 1407:d=5  hl=2 l=   1 prim: INTEGER           :01
 1410:d=5  hl=2 l=  82 cons: SEQUENCE          
 1412:d=6  hl=2 l=  77 cons: SEQUENCE          
 1414:d=7  hl=2 l=  18 cons: SET               
 1416:d=8  hl=2 l=  16 cons: SEQUENCE          
 1418:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1430:d=9  hl=2 l=   2 prim: IA5STRING         :ca
 1434:d=7  hl=2 l=  25 cons: SET               
 1436:d=8  hl=2 l=  23 cons: SEQUENCE          
 1438:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1450:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 1461:d=7  hl=2 l=  28 cons: SET               
 1463:d=8  hl=2 l=  26 cons: SEQUENCE          
 1465:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 1470:d=9  hl=2 l=  19 prim: UTF8STRING        :Unstrung Hig
hway CA
 1491:d=6  hl=2 l=   1 prim: INTEGER           :0C
 1494:d=5  hl=2 l=  13 cons: SEQUENCE          
 1496:d=6  hl=2 l=   9 prim: OBJECT            :sha256
 1507:d=6  hl=2 l=   0 prim: NULL              
 1509:d=5  hl=3 l= 228 cons: cont [ 0 ]        
 1512:d=6  hl=2 l=  24 cons: SEQUENCE          
 1514:d=7  hl=2 l=   9 prim: OBJECT            :contentType
 1525:d=7  hl=2 l=  11 cons: SET               
 1527:d=8  hl=2 l=   9 prim: OBJECT            :pkcs7-data
 1538:d=6  hl=2 l=  28 cons: SEQUENCE          
 1540:d=7  hl=2 l=   9 prim: OBJECT            :signingTime
 1551:d=7  hl=2 l=  15 cons: SET               
 1553:d=8  hl=2 l=  13 prim: UTCTIME           :171012175430
Z
 1568:d=6  hl=2 l=  47 cons: SEQUENCE          
 1570:d=7  hl=2 l=   9 prim: OBJECT            :messageDiges
t
 1581:d=7  hl=2 l=  34 cons: SET               
 1583:d=8  hl=2 l=  32 prim: OCTET STRING      [HEX DUMP]:FE
7D72E29500F90A38E95021A215FD6D40B1629B99598177DC054AE0F9C8B6
9F
 1617:d=6  hl=2 l= 121 cons: SEQUENCE          
 1619:d=7  hl=2 l=   9 prim: OBJECT            :S&#8203;/&#8203;MIME Capab
ilities
 1630:d=7  hl=2 l= 108 cons: SET               
 1632:d=8  hl=2 l= 106 cons: SEQUENCE          
 1634:d=9  hl=2 l=  11 cons: SEQUENCE          
 1636:d=10 hl=2 l=   9 prim: OBJECT            :aes-256-cbc
 1647:d=9  hl=2 l=  11 cons: SEQUENCE          
 1649:d=10 hl=2 l=   9 prim: OBJECT            :aes-192-cbc
 1660:d=9  hl=2 l=  11 cons: SEQUENCE          
 1662:d=10 hl=2 l=   9 prim: OBJECT            :aes-128-cbc
 1673:d=9  hl=2 l=  10 cons: SEQUENCE          
 1675:d=10 hl=2 l=   8 prim: OBJECT            :des-ede3-cbc
 1685:d=9  hl=2 l=  14 cons: SEQUENCE          
 1687:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1697:d=10 hl=2 l=   2 prim: INTEGER           :80
 1701:d=9  hl=2 l=  13 cons: SEQUENCE          
 1703:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1713:d=10 hl=2 l=   1 prim: INTEGER           :40
 1716:d=9  hl=2 l=   7 cons: SEQUENCE          
 1718:d=10 hl=2 l=   5 prim: OBJECT            :des-cbc
 1725:d=9  hl=2 l=  13 cons: SEQUENCE          
 1727:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1737:d=10 hl=2 l=   1 prim: INTEGER           :28
 1740:d=5  hl=2 l=  10 cons: SEQUENCE          
 1742:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
 1752:d=5  hl=2 l=  70 prim: OCTET STRING      [HEX DUMP]:30
440220614CB435374FFB14E49BF12DEBD788FBE4BFDB3DDD4303CA3B074B
D1C0C24AF0022008778C96F26CC9CA71FEC328A9EC9F61BF3B4E87781FFC
8A6308FA19C0EC27CD
</pre>
<pre>
{"ietf-voucher-request:voucher":{"assertion":"proximity","cr
eated-on":"2017-09-01","serial-number":"00-D0-E5-F2-00-02","
nonce":"Dss99sBr3pNMOACe-LYY7w","proximity-registrar-cert":"
MIIBrjCCATOgAwIBAgIBAzAKBggqhkjOPQQDAzBOMRIwEAYKCZImiZPyLGQB
GRYCY2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHTAbBgNVBAMMFFVu
c3RydW5nIEZvdW50YWluIENBMB4XDTE3MDkwNTAxMTI0NVoXDTE5MDkwNTAx
MTI0NVowQzESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJ
c2FuZGVsbWFuMRIwEAYDVQQDDAlsb2NhbGhvc3QwWTATBgcqhkjOPQIBBggq
hkjOPQMBBwNCAAQ1ZA7Nw0xSM/Q2u194FzQMktZ94waAIV0i/oVTPgOJ8zW6
MwF5z+Dpb8/puhObJMZ0U6H/wfApR6svlumd4ryyow0wCzAJBgNVHRMEAjAA
MAoGCCqGSM49BAMDA2kAMGYCMQC3/iTQJ3evYYcgbXhbmzrp64t3QC6qjIeY
2jkDx062nuNifVKtyaara3F30AIkKSECMQDi29efbTLbdtDk3tecY/rD7V77
XaJ6nYCmdDCR54TrSFNLgxvt1lyFM+0fYpYRc3o="}}</pre>
<h1 id="rfc.appendix.D.2.2">
<a href="#rfc.appendix.D.2.2">D.2.2.</a> Registrar to MASA</h1>
<pre>
MIIN2gYJKoZIhvcNAQcCoIINyzCCDccCAQExDzANBglghkgBZQMEAgEFADCC
Ck4GCSqGSIb3DQEHAaCCCj8Eggo7eyJpZXRmLXZvdWNoZXItcmVxdWVzdDp2
b3VjaGVyIjp7ImFzc2VydGlvbiI6InByb3hpbWl0eSIsImNyZWF0ZWQtb24i
OiIyMDE3LTA5LTE1VDAwOjAwOjAwLjAwMFoiLCJzZXJpYWwtbnVtYmVyIjoi
SkFEQTEyMzQ1Njc4OSIsIm5vbmNlIjoiYWJjZDEyMzQiLCJwcmlvci1zaWdu
ZWQtdm91Y2hlci1yZXF1ZXN0IjoiTUlJSEhRWUpLb1pJaHZjTkFRY0NvSUlI
RGpDQ0J3b0NBUUV4RHpBTkJnbGdoa2dCWlFNRUFnRUZBRENDQXc0R0NTcUdT
SWIzRFFFSEFhQ0NBdjhFZ2dMN2V5SnBaWFJtTFhadmRXTm9aWEl0Y21WeGRX
VnpkRHAyYjNWamFHVnlJanA3SW1GemMyVnlkR2x2YmlJNkluQnliM2hwYlds
MGVTSXNJbU55WldGMFpXUXRiMjRpT2lJeU1ERTNMVEE1TFRBeElpd2ljMlZ5
YVdGc0xXNTFiV0psY2lJNklqQXdMVVF3TFVVMUxVWXlMVEF3TFRBeUlpd2li
bTl1WTJVaU9pSkVjM001T1hOQ2NqTndUazFQUVVObExVeFpXVGQzSWl3aWNI
SnZlR2x0YVhSNUxYSmxaMmx6ZEhKaGNpMWpaWEowSWpvaVRVbEpRbkpxUTBO
QlZFOW5RWGRKUWtGblNVSkJla0ZMUW1kbmNXaHJhazlRVVZGRVFYcENUMDFT
U1hkRlFWbExRMXBKYldsYVVIbE1SMUZDUjFKWlExa3lSWGhIVkVGWVFtZHZT
bXRwWVVwckwwbHpXa0ZGV2tabmJIcFpWelZyV2xkNGRGbFhOSGhJVkVGaVFt
ZE9Wa0pCVFUxR1JsWjFZek5TZVdSWE5XNUpSVnAyWkZjMU1GbFhiSFZKUlU1
Q1RVSTBXRVJVUlROTlJHdDNUbFJCZUUxVVNUQk9WbTlZUkZSRk5VMUVhM2RP
VkVGNFRWUkpNRTVXYjNkUmVrVlRUVUpCUjBObmJWTktiMjFVT0dsNGEwRlNh
MWRCYlU1b1RWSnJkMFozV1V0RFdrbHRhVnBRZVV4SFVVSkhVbGxLWXpKR2RW
cEhWbk5pVjBaMVRWSkpkMFZCV1VSV1VWRkVSRUZzYzJJeVRtaGlSMmgyWXpO
UmQxZFVRVlJDWjJOeGFHdHFUMUJSU1VKQ1oyZHhhR3RxVDFCUlRVSkNkMDVE
UVVGUk1WcEJOMDUzTUhoVFRTOVJNblV4T1RSR2VsRk5hM1JhT1RSM1lVRkpW
akJwTDI5V1ZGQm5UMG80ZWxjMlRYZEdOWG9yUkhCaU9DOXdkV2hQWWtwTldq
QlZOa2d2ZDJaQmNGSTJjM1pzZFcxa05ISjVlVzkzTUhkRGVrRktRbWRPVmto
U1RVVkJha0ZCVFVGdlIwTkRjVWRUVFRRNVFrRk5SRUV5YTBGTlIxbERUVkZE
TXk5cFZGRktNMlYyV1ZsaloySllhR0p0ZW5Kd05qUjBNMUZETm5GcVNXVlpN
bXByUkhnd05qSnVkVTVwWmxaTGRIbGhZWEpoTTBZek1FRkphMHRUUlVOTlVV
UnBNamxsWm1KVVRHSmtkRVJyTTNSbFkxa3Zja1EzVmpjM1dHRktObTVaUTIx
a1JFTlNOVFJVY2xOR1RreG5lSFowTVd4NVJrMHJNR1paY0ZsU1l6TnZQU0o5
ZmFDQ0FqWXdnZ0l5TUlJQnQ2QURBZ0VDQWdFTU1Bb0dDQ3FHU000OUJBTUNN
RTB4RWpBUUJnb0praWFKay9Jc1pBRVpGZ0pqWVRFWk1CY0dDZ21TSm9tVDhp
eGtBUmtXQ1hOaGJtUmxiRzFoYmpFY01Cb0dBMVVFQXd3VFZXNXpkSEoxYm1j
Z1NHbG5hSGRoZVNCRFFUQWdGdzB4TnpFd01USXhNelV5TlRKYUdBOHlPVGs1
TVRJek1UQXdNREF3TUZvd1N6RVNNQkFHQ2dtU0pvbVQ4aXhrQVJrV0FtTmhN
Umt3RndZS0NaSW1pWlB5TEdRQkdSWUpjMkZ1WkdWc2JXRnVNUm93R0FZRFZR
UUREQkV3TUMxRU1DMUZOUzFHTWkwd01DMHdNakJaTUJNR0J5cUdTTTQ5QWdF
R0NDcUdTTTQ5QXdFSEEwSUFCRW1ubUxSMVRWcFNkSGE3ekF4SENDUTI2azFz
MHp1YldmU2FQN1FvbG1Odzhpb2dQNjJzK05OS2h1MjRoMmxFOThabnlGVCtj
aFM5NnJES2hnandFOXVqZ1ljd2dZUXdIUVlEVlIwT0JCWUVGQjB4Rm1HMkVW
Q2JQUG9UdGhWZk9RdnRka01xTUFrR0ExVWRFd1FDTUFBd0t3WURWUjBSQkNR
d0lxQWdCZ2tyQmdFRUFZTHVVZ0dnRXd3Uk1EQXRSREF0UlRVdFJqSXRNREF0
TURJd0t3WUpLd1lCQkFHQzdsSUNCQjRNSEdoMGRIQnpPaTh2YUdsbmFIZGhl
UzV6WVc1a1pXeHRZVzR1WTJFd0NnWUlLb1pJemowRUF3SURhUUF3WmdJeEFP
RW5VMzU1cWRiVlQ5N21xZ3hJYTlTOVlkSHU2Snp4d2x1SHU5ZkxuelNjR3p4
dWsyZnJTVC80ak84UlI2MHpNZ0l4QUt2VzdHOTFoNHFydVp0RmNKSGhrSW16
RHJ0OG51UEpkbHNKUktLdjdmQUZQYjZWYUNETThOR0JnSGtBRnZ1d0RER0NB
YVl3Z2dHaUFnRUJNRkl3VFRFU01CQUdDZ21TSm9tVDhpeGtBUmtXQW1OaE1S
a3dGd1lLQ1pJbWlaUHlMR1FCR1JZSmMyRnVaR1ZzYldGdU1Sd3dHZ1lEVlFR
RERCTlZibk4wY25WdVp5QklhV2RvZDJGNUlFTkJBZ0VNTUEwR0NXQ0dTQUZs
QXdRQ0FRVUFvSUhrTUJnR0NTcUdTSWIzRFFFSkF6RUxCZ2txaGtpRzl3MEJC
d0V3SEFZSktvWklodmNOQVFrRk1ROFhEVEUzTVRBeE1qRXpOVGd5TTFvd0x3
WUpLb1pJaHZjTkFRa0VNU0lFSVA1OWN1S1ZBUGtLT09sUUlhSVYvVzFBc1dL
Ym1WbUJkOXdGU3VENXlMYWZNSGtHQ1NxR1NJYjNEUUVKRHpGc01Hb3dDd1lK
WUlaSUFXVURCQUVxTUFzR0NXQ0dTQUZsQXdRQkZqQUxCZ2xnaGtnQlpRTUVB
UUl3Q2dZSUtvWklodmNOQXdjd0RnWUlLb1pJaHZjTkF3SUNBZ0NBTUEwR0ND
cUdTSWIzRFFNQ0FnRkFNQWNHQlNzT0F3SUhNQTBHQ0NxR1NJYjNEUU1DQWdF
b01Bb0dDQ3FHU000OUJBTUNCRWN3UlFJZ0VNZzFkSkw3RmNkdHJWRHg4cUNh
em9lOSsyMk56NFp3UkI5Z0FUR0w3TU1DSVFEanNzVWxaekpxcDIva0NkNFdo
eFVoc2FDcFRGd1Bybk5ldzV3Q2tZVUY4UT09In19oIIBsjCCAa4wggEzoAMC
AQICAQMwCgYIKoZIzj0EAwMwTjESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYK
CZImiZPyLGQBGRYJc2FuZGVsbWFuMR0wGwYDVQQDDBRVbnN0cnVuZyBGb3Vu
dGFpbiBDQTAeFw0xNzA5MDUwMTEyNDVaFw0xOTA5MDUwMTEyNDVaMEMxEjAQ
BgoJkiaJk/IsZAEZFgJjYTEZMBcGCgmSJomT8ixkARkWCXNhbmRlbG1hbjES
MBAGA1UEAwwJbG9jYWxob3N0MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE
NWQOzcNMUjP0NrtfeBc0DJLWfeMGgCFdIv6FUz4DifM1ujMBec/g6W/P6boT
myTGdFOh/8HwKUerL5bpneK8sqMNMAswCQYDVR0TBAIwADAKBggqhkjOPQQD
AwNpADBmAjEAt/4k0Cd3r2GHIG14W5s66euLd0AuqoyHmNo5A8dOtp7jYn1S
rcmmq2txd9ACJCkhAjEA4tvXn20y23bQ5N7XnGP6w+1e+12iep2ApnQwkeeE
60hTS4Mb7dZchTPtH2KWEXN6MYIBpzCCAaMCAQEwUzBOMRIwEAYKCZImiZPy
LGQBGRYCY2ExGTAXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHTAbBgNVBAMM
FFVuc3RydW5nIEZvdW50YWluIENBAgEDMA0GCWCGSAFlAwQCAQUAoIHkMBgG
CSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTE3MTAy
NjAxMzYxOFowLwYJKoZIhvcNAQkEMSIEIEQBM73PZzPo7tE9Mj8gQvaaYeMQ
OsxlACaW/HenAqNwMHkGCSqGSIb3DQEJDzFsMGowCwYJYIZIAWUDBAEqMAsG
CWCGSAFlAwQBFjALBglghkgBZQMEAQIwCgYIKoZIhvcNAwcwDgYIKoZIhvcN
AwICAgCAMA0GCCqGSIb3DQMCAgFAMAcGBSsOAwIHMA0GCCqGSIb3DQMCAgEo
MAoGCCqGSM49BAMCBEcwRQIgDdp5uPUlMKp7GFQAD7ypAgqFv8q+KkJt6c3O
7iVpVI8CIQCD1u8BkxipvigwvIDmWfjlYdJxcvozNjffq5j3UHg7Rg==
</pre>
<p id="rfc.section.D.2.2.p.1">As described in <a href="#RequestVoucherFromMASA" class="xref">Section 5.5</a> the registrar will sign a registrar voucher-request, and will include pledge's voucher request in the prior-signed-voucher-request.  </p>

<p>file: examples/parboiled_vr_00-D0-E5-F2-00-02.pkcs</p>
<pre>
    0:d=0  hl=4 l=3546 cons: SEQUENCE          
    4:d=1  hl=2 l=   9 prim: OBJECT            :pkcs7-signed
Data
   15:d=1  hl=4 l=3531 cons: cont [ 0 ]        
   19:d=2  hl=4 l=3527 cons: SEQUENCE          
   23:d=3  hl=2 l=   1 prim: INTEGER           :01
   26:d=3  hl=2 l=  15 cons: SET               
   28:d=4  hl=2 l=  13 cons: SEQUENCE          
   30:d=5  hl=2 l=   9 prim: OBJECT            :sha256
   41:d=5  hl=2 l=   0 prim: NULL              
   43:d=3  hl=4 l=2638 cons: SEQUENCE          
   47:d=4  hl=2 l=   9 prim: OBJECT            :pkcs7-data
   58:d=4  hl=4 l=2623 cons: cont [ 0 ]        
   62:d=5  hl=4 l=2619 prim: OCTET STRING      :{"ietf-vouch
er-request:voucher":{"assertion":"proximity","created-on":"2
017-09-15T00:00:00.000Z","serial-number":"JADA123456789","no
nce":"abcd1234","prior-signed-voucher-request":"MIIHHQYJKoZI
hvcNAQcCoIIHDjCCBwoCAQExDzANBglghkgBZQMEAgEFADCCAw4GCSqGSIb3
DQEHAaCCAv8EggL7eyJpZXRmLXZvdWNoZXItcmVxdWVzdDp2b3VjaGVyIjp7
ImFzc2VydGlvbiI6InByb3hpbWl0eSIsImNyZWF0ZWQtb24iOiIyMDE3LTA5
LTAxIiwic2VyaWFsLW51bWJlciI6IjAwLUQwLUU1LUYyLTAwLTAyIiwibm9u
Y2UiOiJEc3M5OXNCcjNwTk1PQUNlLUxZWTd3IiwicHJveGltaXR5LXJlZ2lz
dHJhci1jZXJ0IjoiTUlJQnJqQ0NBVE9nQXdJQkFnSUJBekFLQmdncWhrak9Q
UVFEQXpCT01SSXdFQVlLQ1pJbWlaUHlMR1FCR1JZQ1kyRXhHVEFYQmdvSmtp
YUprL0lzWkFFWkZnbHpZVzVrWld4dFlXNHhIVEFiQmdOVkJBTU1GRlZ1YzNS
eWRXNW5JRVp2ZFc1MFlXbHVJRU5CTUI0WERURTNNRGt3TlRBeE1USTBOVm9Y
RFRFNU1Ea3dOVEF4TVRJME5Wb3dRekVTTUJBR0NnbVNKb21UOGl4a0FSa1dB
bU5oTVJrd0Z3WUtDWkltaVpQeUxHUUJHUllKYzJGdVpHVnNiV0Z1TVJJd0VB
WURWUVFEREFsc2IyTmhiR2h2YzNRd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtq
T1BRTUJCd05DQUFRMVpBN053MHhTTS9RMnUxOTRGelFNa3RaOTR3YUFJVjBp
L29WVFBnT0o4elc2TXdGNXorRHBiOC9wdWhPYkpNWjBVNkgvd2ZBcFI2c3Zs
dW1kNHJ5eW93MHdDekFKQmdOVkhSTUVBakFBTUFvR0NDcUdTTTQ5QkFNREEy
a0FNR1lDTVFDMy9pVFFKM2V2WVljZ2JYaGJtenJwNjR0M1FDNnFqSWVZMmpr
RHgwNjJudU5pZlZLdHlhYXJhM0YzMEFJa0tTRUNNUURpMjllZmJUTGJkdERr
M3RlY1kvckQ3Vjc3WGFKNm5ZQ21kRENSNTRUclNGTkxneHZ0MWx5Rk0rMGZZ
cFlSYzNvPSJ9faCCAjYwggIyMIIBt6ADAgECAgEMMAoGCCqGSM49BAMCME0x
EjAQBgoJkiaJk/IsZAEZFgJjYTEZMBcGCgmSJomT8ixkARkWCXNhbmRlbG1h
bjEcMBoGA1UEAwwTVW5zdHJ1bmcgSGlnaHdheSBDQTAgFw0xNzEwMTIxMzUy
NTJaGA8yOTk5MTIzMTAwMDAwMFowSzESMBAGCgmSJomT8ixkARkWAmNhMRkw
FwYKCZImiZPyLGQBGRYJc2FuZGVsbWFuMRowGAYDVQQDDBEwMC1EMC1FNS1G
Mi0wMC0wMjBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEmnmLR1TVpSdHa7
zAxHCCQ26k1s0zubWfSaP7QolmNw8iogP62s+NNKhu24h2lE98ZnyFT+chS9
6rDKhgjwE9ujgYcwgYQwHQYDVR0OBBYEFB0xFmG2EVCbPPoTthVfOQvtdkMq
MAkGA1UdEwQCMAAwKwYDVR0RBCQwIqAgBgkrBgEEAYLuUgGgEwwRMDAtRDAt
RTUtRjItMDAtMDIwKwYJKwYBBAGC7lICBB4MHGh0dHBzOi8vaGlnaHdheS5z
YW5kZWxtYW4uY2EwCgYIKoZIzj0EAwIDaQAwZgIxAOEnU355qdbVT97mqgxI
a9S9YdHu6JzxwluHu9fLnzScGzxuk2frST/4jO8RR60zMgIxAKvW7G91h4qr
uZtFcJHhkImzDrt8nuPJdlsJRKKv7fAFPb6VaCDM8NGBgHkAFvuwDDGCAaYw
ggGiAgEBMFIwTTESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQB
GRYJc2FuZGVsbWFuMRwwGgYDVQQDDBNVbnN0cnVuZyBIaWdod2F5IENBAgEM
MA0GCWCGSAFlAwQCAQUAoIHkMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEw
HAYJKoZIhvcNAQkFMQ8XDTE3MTAxMjEzNTgyM1owLwYJKoZIhvcNAQkEMSIE
IP59cuKVAPkKOOlQIaIV/W1AsWKbmVmBd9wFSuD5yLafMHkGCSqGSIb3DQEJ
DzFsMGowCwYJYIZIAWUDBAEqMAsGCWCGSAFlAwQBFjALBglghkgBZQMEAQIw
CgYIKoZIhvcNAwcwDgYIKoZIhvcNAwICAgCAMA0GCCqGSIb3DQMCAgFAMAcG
BSsOAwIHMA0GCCqGSIb3DQMCAgEoMAoGCCqGSM49BAMCBEcwRQIgEMg1dJL7
FcdtrVDx8qCazoe9+22Nz4ZwRB9gATGL7MMCIQDjssUlZzJqp2/kCd4WhxUh
saCpTFwPrnNew5wCkYUF8Q=="}}
 2685:d=3  hl=4 l= 434 cons: cont [ 0 ]        
 2689:d=4  hl=4 l= 430 cons: SEQUENCE          
 2693:d=5  hl=4 l= 307 cons: SEQUENCE          
 2697:d=6  hl=2 l=   3 cons: cont [ 0 ]        
 2699:d=7  hl=2 l=   1 prim: INTEGER           :02
 2702:d=6  hl=2 l=   1 prim: INTEGER           :03
 2705:d=6  hl=2 l=  10 cons: SEQUENCE          
 2707:d=7  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA384
 2717:d=6  hl=2 l=  78 cons: SEQUENCE          
 2719:d=7  hl=2 l=  18 cons: SET               
 2721:d=8  hl=2 l=  16 cons: SEQUENCE          
 2723:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 2735:d=9  hl=2 l=   2 prim: IA5STRING         :ca
 2739:d=7  hl=2 l=  25 cons: SET               
 2741:d=8  hl=2 l=  23 cons: SEQUENCE          
 2743:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 2755:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 2766:d=7  hl=2 l=  29 cons: SET               
 2768:d=8  hl=2 l=  27 cons: SEQUENCE          
 2770:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 2775:d=9  hl=2 l=  20 prim: UTF8STRING        :Unstrung Fou
ntain CA
 2797:d=6  hl=2 l=  30 cons: SEQUENCE          
 2799:d=7  hl=2 l=  13 prim: UTCTIME           :170905011245
Z
 2814:d=7  hl=2 l=  13 prim: UTCTIME           :190905011245
Z
 2829:d=6  hl=2 l=  67 cons: SEQUENCE          
 2831:d=7  hl=2 l=  18 cons: SET               
 2833:d=8  hl=2 l=  16 cons: SEQUENCE          
 2835:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 2847:d=9  hl=2 l=   2 prim: IA5STRING         :ca
 2851:d=7  hl=2 l=  25 cons: SET               
 2853:d=8  hl=2 l=  23 cons: SEQUENCE          
 2855:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 2867:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 2878:d=7  hl=2 l=  18 cons: SET               
 2880:d=8  hl=2 l=  16 cons: SEQUENCE          
 2882:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 2887:d=9  hl=2 l=   9 prim: UTF8STRING        :localhost
 2898:d=6  hl=2 l=  89 cons: SEQUENCE          
 2900:d=7  hl=2 l=  19 cons: SEQUENCE          
 2902:d=8  hl=2 l=   7 prim: OBJECT            :id-ecPublicK
ey
 2911:d=8  hl=2 l=   8 prim: OBJECT            :prime256v1
 2921:d=7  hl=2 l=  66 prim: BIT STRING        
 2989:d=6  hl=2 l=  13 cons: cont [ 3 ]        
 2991:d=7  hl=2 l=  11 cons: SEQUENCE          
 2993:d=8  hl=2 l=   9 cons: SEQUENCE          
 2995:d=9  hl=2 l=   3 prim: OBJECT            :X509v3 Basic
 Constraints
 3000:d=9  hl=2 l=   2 prim: OCTET STRING      [HEX DUMP]:30
00
 3004:d=5  hl=2 l=  10 cons: SEQUENCE          
 3006:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA384
 3016:d=5  hl=2 l= 105 prim: BIT STRING        
 3123:d=3  hl=4 l= 423 cons: SET               
 3127:d=4  hl=4 l= 419 cons: SEQUENCE          
 3131:d=5  hl=2 l=   1 prim: INTEGER           :01
 3134:d=5  hl=2 l=  83 cons: SEQUENCE          
 3136:d=6  hl=2 l=  78 cons: SEQUENCE          
 3138:d=7  hl=2 l=  18 cons: SET               
 3140:d=8  hl=2 l=  16 cons: SEQUENCE          
 3142:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 3154:d=9  hl=2 l=   2 prim: IA5STRING         :ca
 3158:d=7  hl=2 l=  25 cons: SET               
 3160:d=8  hl=2 l=  23 cons: SEQUENCE          
 3162:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 3174:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 3185:d=7  hl=2 l=  29 cons: SET               
 3187:d=8  hl=2 l=  27 cons: SEQUENCE          
 3189:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 3194:d=9  hl=2 l=  20 prim: UTF8STRING        :Unstrung Fou
ntain CA
 3216:d=6  hl=2 l=   1 prim: INTEGER           :03
 3219:d=5  hl=2 l=  13 cons: SEQUENCE          
 3221:d=6  hl=2 l=   9 prim: OBJECT            :sha256
 3232:d=6  hl=2 l=   0 prim: NULL              
 3234:d=5  hl=3 l= 228 cons: cont [ 0 ]        
 3237:d=6  hl=2 l=  24 cons: SEQUENCE          
 3239:d=7  hl=2 l=   9 prim: OBJECT            :contentType
 3250:d=7  hl=2 l=  11 cons: SET               
 3252:d=8  hl=2 l=   9 prim: OBJECT            :pkcs7-data
 3263:d=6  hl=2 l=  28 cons: SEQUENCE          
 3265:d=7  hl=2 l=   9 prim: OBJECT            :signingTime
 3276:d=7  hl=2 l=  15 cons: SET               
 3278:d=8  hl=2 l=  13 prim: UTCTIME           :171026013618
Z
 3293:d=6  hl=2 l=  47 cons: SEQUENCE          
 3295:d=7  hl=2 l=   9 prim: OBJECT            :messageDiges
t
 3306:d=7  hl=2 l=  34 cons: SET               
 3308:d=8  hl=2 l=  32 prim: OCTET STRING      [HEX DUMP]:44
0133BDCF6733E8EED13D323F2042F69A61E3103ACC65002696FC77A702A3
70
 3342:d=6  hl=2 l= 121 cons: SEQUENCE          
 3344:d=7  hl=2 l=   9 prim: OBJECT            :S&#8203;/&#8203;MIME Capab
ilities
 3355:d=7  hl=2 l= 108 cons: SET               
 3357:d=8  hl=2 l= 106 cons: SEQUENCE          
 3359:d=9  hl=2 l=  11 cons: SEQUENCE          
 3361:d=10 hl=2 l=   9 prim: OBJECT            :aes-256-cbc
 3372:d=9  hl=2 l=  11 cons: SEQUENCE          
 3374:d=10 hl=2 l=   9 prim: OBJECT            :aes-192-cbc
 3385:d=9  hl=2 l=  11 cons: SEQUENCE          
 3387:d=10 hl=2 l=   9 prim: OBJECT            :aes-128-cbc
 3398:d=9  hl=2 l=  10 cons: SEQUENCE          
 3400:d=10 hl=2 l=   8 prim: OBJECT            :des-ede3-cbc
 3410:d=9  hl=2 l=  14 cons: SEQUENCE          
 3412:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 3422:d=10 hl=2 l=   2 prim: INTEGER           :80
 3426:d=9  hl=2 l=  13 cons: SEQUENCE          
 3428:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 3438:d=10 hl=2 l=   1 prim: INTEGER           :40
 3441:d=9  hl=2 l=   7 cons: SEQUENCE          
 3443:d=10 hl=2 l=   5 prim: OBJECT            :des-cbc
 3450:d=9  hl=2 l=  13 cons: SEQUENCE          
 3452:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 3462:d=10 hl=2 l=   1 prim: INTEGER           :28
 3465:d=5  hl=2 l=  10 cons: SEQUENCE          
 3467:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
 3477:d=5  hl=2 l=  71 prim: OCTET STRING      [HEX DUMP]:30
4502200DDA79B8F52530AA7B1854000FBCA9020A85BFCABE2A426DE9CDCE
EE2569548F02210083D6EF019318A9BE2830BC80E659F8E561D27172FA33
3637DFAB98F750783B46
</pre>
<h1 id="rfc.appendix.D.2.3">
<a href="#rfc.appendix.D.2.3">D.2.3.</a> MASA to Registrar</h1>
<pre>
MIIG3AYJKoZIhvcNAQcCoIIGzTCCBskCAQExDzANBglghkgBZQMEAgEFADCC
AxAGCSqGSIb3DQEHAaCCAwEEggL9eyJpZXRmLXZvdWNoZXI6dm91Y2hlciI6
eyJhc3NlcnRpb24iOiJsb2dnZWQiLCJjcmVhdGVkLW9uIjoiMjAxNy0xMC0x
MlQxMzo1NDozMS40MzktMDQ6MDAiLCJzZXJpYWwtbnVtYmVyIjoiMDAtRDAt
RTUtRjItMDAtMDIiLCJub25jZSI6IkRzczk5c0JyM3BOTU9BQ2UtTFlZN3ci
LCJwaW5uZWQtZG9tYWluLWNlcnQiOiJNSUlCcmpDQ0FUT2dBd0lCQWdJQkF6
QUtCZ2dxaGtqT1BRUURBekJPTVJJd0VBWUtDWkltaVpQeUxHUUJHUllDWTJF
eEdUQVhCZ29Ka2lhSmsvSXNaQUVaRmdsellXNWtaV3h0WVc0eEhUQWJCZ05W
QkFNTUZGVnVjM1J5ZFc1bklFWnZkVzUwWVdsdUlFTkJNQjRYRFRFM01Ea3dO
VEF4TVRJME5Wb1hEVEU1TURrd05UQXhNVEkwTlZvd1F6RVNNQkFHQ2dtU0pv
bVQ4aXhrQVJrV0FtTmhNUmt3RndZS0NaSW1pWlB5TEdRQkdSWUpjMkZ1WkdW
c2JXRnVNUkl3RUFZRFZRUUREQWxzYjJOaGJHaHZjM1F3V1RBVEJnY3Foa2pP
UFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVExWkE3TncweFNNL1EydTE5NEZ6UU1r
dFo5NHdhQUlWMGkvb1ZUUGdPSjh6VzZNd0Y1eitEcGI4L3B1aE9iSk1aMFU2
SC93ZkFwUjZzdmx1bWQ0cnl5b3cwd0N6QUpCZ05WSFJNRUFqQUFNQW9HQ0Nx
R1NNNDlCQU1EQTJrQU1HWUNNUUMzL2lUUUozZXZZWWNnYlhoYm16cnA2NHQz
UUM2cWpJZVkyamtEeDA2Mm51TmlmVkt0eWFhcmEzRjMwQUlrS1NFQ01RRGky
OWVmYlRMYmR0RGszdGVjWS9yRDdWNzdYYUo2bllDbWREQ1I1NFRyU0ZOTGd4
dnQxbHlGTSswZllwWVJjM289In19oIIB0zCCAc8wggFWoAMCAQICAQEwCgYI
KoZIzj0EAwIwTTESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQB
GRYJc2FuZGVsbWFuMRwwGgYDVQQDDBNVbnN0cnVuZyBIaWdod2F5IENBMB4X
DTE3MDMyNjE2MTk0MFoXDTE5MDMyNjE2MTk0MFowRzESMBAGCgmSJomT8ixk
ARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJc2FuZGVsbWFuMRYwFAYDVQQDDA1V
bnN0cnVuZyBNQVNBMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAE2QB90W9hbyCT
p7bPr17llt+aH8jWwh84wMzotpFmRRNQcrqyiJjXDTBRoqxp0VyFxqlgn8OS
AoCfArjN71ebcvW3+ylJTpHo8077/uT1fvnpZD/R0PN76kwMLNlsFk8SoxAw
DjAMBgNVHRMBAf8EAjAAMAoGCCqGSM49BAMCA2cAMGQCMBm9KMjNHaD+rd/y
0jy+Tg7mrRMDGIe1hjviGExwvCuxMhwTpgmEXik9vhoVfwi1swIwTculDCU7
dbbMSbCanTD1CBY/uMGYNQDiG/yaAOjO6996cC0E6x0cRM1TBn1jpGFMMYIB
xjCCAcICAQEwUjBNMRIwEAYKCZImiZPyLGQBGRYCY2ExGTAXBgoJkiaJk/Is
ZAEZFglzYW5kZWxtYW4xHDAaBgNVBAMME1Vuc3RydW5nIEhpZ2h3YXkgQ0EC
AQEwDQYJYIZIAWUDBAIBBQCggeQwGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEH
ATAcBgkqhkiG9w0BCQUxDxcNMTcxMDEyMTc1NDMxWjAvBgkqhkiG9w0BCQQx
IgQgQXnG628cIW8MoYfB1ljDDlLlJQlxED2tnjcvkLEfix0weQYJKoZIhvcN
AQkPMWwwajALBglghkgBZQMEASowCwYJYIZIAWUDBAEWMAsGCWCGSAFlAwQB
AjAKBggqhkiG9w0DBzAOBggqhkiG9w0DAgICAIAwDQYIKoZIhvcNAwICAUAw
BwYFKw4DAgcwDQYIKoZIhvcNAwICASgwCgYIKoZIzj0EAwIEZzBlAjEAhzid
/AkNjttpSP1rflNppdHsi324Z2+TXJxueewnJ8z/2NXb+Tf3DsThv7du00Oz
AjBjyOnmkkSKHsPR2JluA5c6wovuPEnNKP32daGGeFKGEHMkTInbrqipC881
/5K9Q+k=
</pre>
<p id="rfc.section.D.2.3.p.1">The MASA will return a voucher to the registrar, to be relayed to the pledge.  </p>

<p>file: examples/voucher_00-D0-E5-F2-00-02.pkcs</p>
<pre>
    0:d=0  hl=4 l=1756 cons: SEQUENCE          
    4:d=1  hl=2 l=   9 prim: OBJECT            :pkcs7-signed
Data
   15:d=1  hl=4 l=1741 cons: cont [ 0 ]        
   19:d=2  hl=4 l=1737 cons: SEQUENCE          
   23:d=3  hl=2 l=   1 prim: INTEGER           :01
   26:d=3  hl=2 l=  15 cons: SET               
   28:d=4  hl=2 l=  13 cons: SEQUENCE          
   30:d=5  hl=2 l=   9 prim: OBJECT            :sha256
   41:d=5  hl=2 l=   0 prim: NULL              
   43:d=3  hl=4 l= 784 cons: SEQUENCE          
   47:d=4  hl=2 l=   9 prim: OBJECT            :pkcs7-data
   58:d=4  hl=4 l= 769 cons: cont [ 0 ]        
   62:d=5  hl=4 l= 765 prim: OCTET STRING      :{"ietf-vouch
er:voucher":{"assertion":"logged","created-on":"2017-10-12T1
3:54:31.439-04:00","serial-number":"00-D0-E5-F2-00-02","nonc
e":"Dss99sBr3pNMOACe-LYY7w","pinned-domain-cert":"MIIBrjCCAT
OgAwIBAgIBAzAKBggqhkjOPQQDAzBOMRIwEAYKCZImiZPyLGQBGRYCY2ExGT
AXBgoJkiaJk/IsZAEZFglzYW5kZWxtYW4xHTAbBgNVBAMMFFVuc3RydW5nIE
ZvdW50YWluIENBMB4XDTE3MDkwNTAxMTI0NVoXDTE5MDkwNTAxMTI0NVowQz
ESMBAGCgmSJomT8ixkARkWAmNhMRkwFwYKCZImiZPyLGQBGRYJc2FuZGVsbW
FuMRIwEAYDVQQDDAlsb2NhbGhvc3QwWTATBgcqhkjOPQIBBggqhkjOPQMBBw
NCAAQ1ZA7Nw0xSM/Q2u194FzQMktZ94waAIV0i/oVTPgOJ8zW6MwF5z+Dpb8
/puhObJMZ0U6H/wfApR6svlumd4ryyow0wCzAJBgNVHRMEAjAAMAoGCCqGSM
49BAMDA2kAMGYCMQC3/iTQJ3evYYcgbXhbmzrp64t3QC6qjIeY2jkDx062nu
NifVKtyaara3F30AIkKSECMQDi29efbTLbdtDk3tecY/rD7V77XaJ6nYCmdD
CR54TrSFNLgxvt1lyFM+0fYpYRc3o="}}
  831:d=3  hl=4 l= 467 cons: cont [ 0 ]        
  835:d=4  hl=4 l= 463 cons: SEQUENCE          
  839:d=5  hl=4 l= 342 cons: SEQUENCE          
  843:d=6  hl=2 l=   3 cons: cont [ 0 ]        
  845:d=7  hl=2 l=   1 prim: INTEGER           :02
  848:d=6  hl=2 l=   1 prim: INTEGER           :01
  851:d=6  hl=2 l=  10 cons: SEQUENCE          
  853:d=7  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
  863:d=6  hl=2 l=  77 cons: SEQUENCE          
  865:d=7  hl=2 l=  18 cons: SET               
  867:d=8  hl=2 l=  16 cons: SEQUENCE          
  869:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  881:d=9  hl=2 l=   2 prim: IA5STRING         :ca
  885:d=7  hl=2 l=  25 cons: SET               
  887:d=8  hl=2 l=  23 cons: SEQUENCE          
  889:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  901:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
  912:d=7  hl=2 l=  28 cons: SET               
  914:d=8  hl=2 l=  26 cons: SEQUENCE          
  916:d=9  hl=2 l=   3 prim: OBJECT            :commonName
  921:d=9  hl=2 l=  19 prim: UTF8STRING        :Unstrung Hig
hway CA
  942:d=6  hl=2 l=  30 cons: SEQUENCE          
  944:d=7  hl=2 l=  13 prim: UTCTIME           :170326161940
Z
  959:d=7  hl=2 l=  13 prim: UTCTIME           :190326161940
Z
  974:d=6  hl=2 l=  71 cons: SEQUENCE          
  976:d=7  hl=2 l=  18 cons: SET               
  978:d=8  hl=2 l=  16 cons: SEQUENCE          
  980:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
  992:d=9  hl=2 l=   2 prim: IA5STRING         :ca
  996:d=7  hl=2 l=  25 cons: SET               
  998:d=8  hl=2 l=  23 cons: SEQUENCE          
 1000:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1012:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 1023:d=7  hl=2 l=  22 cons: SET               
 1025:d=8  hl=2 l=  20 cons: SEQUENCE          
 1027:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 1032:d=9  hl=2 l=  13 prim: UTF8STRING        :Unstrung MAS
A
 1047:d=6  hl=2 l= 118 cons: SEQUENCE          
 1049:d=7  hl=2 l=  16 cons: SEQUENCE          
 1051:d=8  hl=2 l=   7 prim: OBJECT            :id-ecPublicK
ey
 1060:d=8  hl=2 l=   5 prim: OBJECT            :secp384r1
 1067:d=7  hl=2 l=  98 prim: BIT STRING        
 1167:d=6  hl=2 l=  16 cons: cont [ 3 ]        
 1169:d=7  hl=2 l=  14 cons: SEQUENCE          
 1171:d=8  hl=2 l=  12 cons: SEQUENCE          
 1173:d=9  hl=2 l=   3 prim: OBJECT            :X509v3 Basic
 Constraints
 1178:d=9  hl=2 l=   1 prim: BOOLEAN           :255
 1181:d=9  hl=2 l=   2 prim: OCTET STRING      [HEX DUMP]:30
00
 1185:d=5  hl=2 l=  10 cons: SEQUENCE          
 1187:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
 1197:d=5  hl=2 l= 103 prim: BIT STRING        
 1302:d=3  hl=4 l= 454 cons: SET               
 1306:d=4  hl=4 l= 450 cons: SEQUENCE          
 1310:d=5  hl=2 l=   1 prim: INTEGER           :01
 1313:d=5  hl=2 l=  82 cons: SEQUENCE          
 1315:d=6  hl=2 l=  77 cons: SEQUENCE          
 1317:d=7  hl=2 l=  18 cons: SET               
 1319:d=8  hl=2 l=  16 cons: SEQUENCE          
 1321:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1333:d=9  hl=2 l=   2 prim: IA5STRING         :ca
 1337:d=7  hl=2 l=  25 cons: SET               
 1339:d=8  hl=2 l=  23 cons: SEQUENCE          
 1341:d=9  hl=2 l=  10 prim: OBJECT            :domainCompon
ent
 1353:d=9  hl=2 l=   9 prim: IA5STRING         :sandelman
 1364:d=7  hl=2 l=  28 cons: SET               
 1366:d=8  hl=2 l=  26 cons: SEQUENCE          
 1368:d=9  hl=2 l=   3 prim: OBJECT            :commonName
 1373:d=9  hl=2 l=  19 prim: UTF8STRING        :Unstrung Hig
hway CA
 1394:d=6  hl=2 l=   1 prim: INTEGER           :01
 1397:d=5  hl=2 l=  13 cons: SEQUENCE          
 1399:d=6  hl=2 l=   9 prim: OBJECT            :sha256
 1410:d=6  hl=2 l=   0 prim: NULL              
 1412:d=5  hl=3 l= 228 cons: cont [ 0 ]        
 1415:d=6  hl=2 l=  24 cons: SEQUENCE          
 1417:d=7  hl=2 l=   9 prim: OBJECT            :contentType
 1428:d=7  hl=2 l=  11 cons: SET               
 1430:d=8  hl=2 l=   9 prim: OBJECT            :pkcs7-data
 1441:d=6  hl=2 l=  28 cons: SEQUENCE          
 1443:d=7  hl=2 l=   9 prim: OBJECT            :signingTime
 1454:d=7  hl=2 l=  15 cons: SET               
 1456:d=8  hl=2 l=  13 prim: UTCTIME           :171012175431
Z
 1471:d=6  hl=2 l=  47 cons: SEQUENCE          
 1473:d=7  hl=2 l=   9 prim: OBJECT            :messageDiges
t
 1484:d=7  hl=2 l=  34 cons: SET               
 1486:d=8  hl=2 l=  32 prim: OCTET STRING      [HEX DUMP]:41
79C6EB6F1C216F0CA187C1D658C30E52E5250971103DAD9E372F90B11F8B
1D
 1520:d=6  hl=2 l= 121 cons: SEQUENCE          
 1522:d=7  hl=2 l=   9 prim: OBJECT            :S&#8203;/&#8203;MIME Capab
ilities
 1533:d=7  hl=2 l= 108 cons: SET               
 1535:d=8  hl=2 l= 106 cons: SEQUENCE          
 1537:d=9  hl=2 l=  11 cons: SEQUENCE          
 1539:d=10 hl=2 l=   9 prim: OBJECT            :aes-256-cbc
 1550:d=9  hl=2 l=  11 cons: SEQUENCE          
 1552:d=10 hl=2 l=   9 prim: OBJECT            :aes-192-cbc
 1563:d=9  hl=2 l=  11 cons: SEQUENCE          
 1565:d=10 hl=2 l=   9 prim: OBJECT            :aes-128-cbc
 1576:d=9  hl=2 l=  10 cons: SEQUENCE          
 1578:d=10 hl=2 l=   8 prim: OBJECT            :des-ede3-cbc
 1588:d=9  hl=2 l=  14 cons: SEQUENCE          
 1590:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1600:d=10 hl=2 l=   2 prim: INTEGER           :80
 1604:d=9  hl=2 l=  13 cons: SEQUENCE          
 1606:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1616:d=10 hl=2 l=   1 prim: INTEGER           :40
 1619:d=9  hl=2 l=   7 cons: SEQUENCE          
 1621:d=10 hl=2 l=   5 prim: OBJECT            :des-cbc
 1628:d=9  hl=2 l=  13 cons: SEQUENCE          
 1630:d=10 hl=2 l=   8 prim: OBJECT            :rc2-cbc
 1640:d=10 hl=2 l=   1 prim: INTEGER           :28
 1643:d=5  hl=2 l=  10 cons: SEQUENCE          
 1645:d=6  hl=2 l=   8 prim: OBJECT            :ecdsa-with-S
HA256
 1655:d=5  hl=2 l= 103 prim: OCTET STRING      [HEX DUMP]:30
6502310087389DFC090D8EDB6948FD6B7E5369A5D1EC8B7DB8676F935C9C
6E79EC2727CCFFD8D5DBF937F70EC4E1BFB76ED343B3023063C8E9E69244
8A1EC3D1D8996E03973AC28BEE3C49CD28FDF675A1867852861073244C89
DBAEA8A90BCF35FF92BD43E9
</pre>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Max Pritikin</span> 
	  <span class="n hidden">
		<span class="family-name">Pritikin</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pritikin@cisco.com">pritikin@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael C. Richardson</span> 
	  <span class="n hidden">
		<span class="family-name">Richardson</span>
	  </span>
	</span>
	<span class="org vcardline">Sandelman Software Works</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mcr+ietf@sandelman.ca">mcr+ietf@sandelman.ca</a></span>

<span class="vcardline">URI: <a href="http://www.sandelman.ca/">http://www.sandelman.ca/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael H. Behringer</span> 
	  <span class="n hidden">
		<span class="family-name">Behringer</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Michael.H.Behringer@gmail.com">Michael.H.Behringer@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Steinthor Bjarnason</span> 
	  <span class="n hidden">
		<span class="family-name">Bjarnason</span>
	  </span>
	</span>
	<span class="org vcardline">Arbor Networks</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sbjarnason@arbor.net">sbjarnason@arbor.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kent Watsen</span> 
	  <span class="n hidden">
		<span class="family-name">Watsen</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:kwatsen@juniper.net">kwatsen@juniper.net</a></span>

  </address>
</div>

</body>
</html>
